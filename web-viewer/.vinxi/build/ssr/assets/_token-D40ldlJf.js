import{jsx as i,jsxs as a}from"react/jsx-runtime";import{useState as l,useEffect as h}from"react";import{R as u}from"./ssr-BvwCsXc8.js";import"h3";import"unctx";import"node:async_hooks";import"@tanstack/react-router";import"jsesc";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";import"@tanstack/react-cross-context";function g(e){if(!e||e.length===0)return null;try{const n=atob(e),r=JSON.parse(n);return typeof r.familyMemberId!="string"||typeof r.permissionLevel!="string"||typeof r.childId!="string"||typeof r.createdAt!="number"||typeof r.expiresAt!="number"||typeof r.version!="number"||r.permissionLevel!=="view_only"&&r.permissionLevel!=="view_interact"?null:{familyMemberId:r.familyMemberId,permissionLevel:r.permissionLevel,childId:r.childId,createdAt:r.createdAt,expiresAt:r.expiresAt,version:r.version}}catch{return null}}function f(e){return Date.now()>e.expiresAt}const y={id:"child-1",name:"Baby Emma",nickname:"Em",dateOfBirth:"2025-01-15"},b=[{id:"entry-1",type:"photo",mediaUris:["https://images.unsplash.com/photo-1519689680058-324335c77eba?w=800"],caption:"First smile captured! Such a precious moment.",date:"2025-02-15",tags:["milestone","smile"],createdAt:"2025-02-15T10:30:00Z",updatedAt:"2025-02-15T10:30:00Z",createdByName:"Mum"},{id:"entry-2",type:"photo",mediaUris:["https://images.unsplash.com/photo-1503454537195-1dcabb73ffb9?w=800","https://images.unsplash.com/photo-1519689680058-324335c77eba?w=800"],caption:"æ»¡æœˆ celebration with grandparents!",date:"2025-02-14",tags:["æ»¡æœˆ","family"],createdAt:"2025-02-14T14:00:00Z",updatedAt:"2025-02-14T14:00:00Z",createdByName:"Dad"},{id:"entry-3",type:"text",caption:"Emma slept through the night for the first time! We are so happy and relieved. She's growing so fast.",date:"2025-02-10",createdAt:"2025-02-10T08:00:00Z",updatedAt:"2025-02-10T08:00:00Z",createdByName:"Mum"},{id:"entry-4",type:"video",mediaUris:["https://example.com/video.mp4"],thumbnailUrl:"https://images.unsplash.com/photo-1492725764893-90b379c2b6e7?w=800",caption:"Tummy time practice - getting stronger every day!",date:"2025-02-08",tags:["development"],createdAt:"2025-02-08T16:30:00Z",updatedAt:"2025-02-08T16:30:00Z",createdByName:"Dad"}];async function x(e,n){return await c(300),y}async function v(e,n){return await c(500),b}function c(e){return new Promise(n=>setTimeout(n,e))}function w(){return a("div",{style:t.container,children:[i("div",{style:t.loadingSpinner}),i("p",{style:t.loadingText,children:"Loading memories..."})]})}function I({message:e}){return a("div",{style:t.container,children:[i("div",{style:t.errorIcon,children:"!"}),i("h1",{style:t.errorTitle,children:"Oops!"}),i("p",{style:t.errorMessage,children:e}),i("p",{style:t.errorHint,children:"Please check the link you received or ask the parent to resend it."})]})}function S(){return a("div",{style:t.container,children:[i("div",{style:t.expiredIcon,children:"â°"}),i("h1",{style:t.expiredTitle,children:"Link Expired"}),a("p",{style:t.expiredMessage,children:["This link has expired due to inactivity.",i("br",{}),"Please ask the parent to resend the magic link."]})]})}function k({child:e,entries:n}){const r=e.nickname||e.name;return a("div",{style:t.feedContainer,children:[a("header",{style:t.header,children:[a("h1",{style:t.headerTitle,children:[r,"'s Journey"]}),i("p",{style:t.headerSubtitle,children:"Little Journey"})]}),i("main",{style:t.feed,children:n.length===0?i("div",{style:t.emptyState,children:i("p",{children:"No memories yet. Check back soon!"})}):n.map(d=>i(C,{entry:d},d.id))})]})}function C({entry:e}){const[n,r]=l(0),d=e.mediaUris&&e.mediaUris.length>1,s=new Date(e.date).toLocaleDateString("en-SG",{year:"numeric",month:"short",day:"numeric"});return a("article",{style:t.card,children:[e.type==="photo"&&e.mediaUris&&e.mediaUris.length>0&&a("div",{style:t.mediaContainer,children:[i("img",{src:e.mediaUris[n],alt:e.caption||"Photo",style:t.media}),d&&a("div",{style:t.carouselControls,children:[i("button",{onClick:()=>r(o=>o>0?o-1:e.mediaUris.length-1),style:t.carouselButton,"aria-label":"Previous photo",children:"â€¹"}),a("span",{style:t.carouselIndicator,children:[n+1," / ",e.mediaUris.length]}),i("button",{onClick:()=>r(o=>o<e.mediaUris.length-1?o+1:0),style:t.carouselButton,"aria-label":"Next photo",children:"â€º"})]})]}),e.type==="video"&&i("div",{style:t.mediaContainer,children:e.thumbnailUrl?a("div",{style:t.videoThumbnail,children:[i("img",{src:e.thumbnailUrl,alt:"Video thumbnail",style:t.media}),i("div",{style:t.playIcon,children:"â–¶"})]}):i("div",{style:t.videoPlaceholder,children:"ðŸŽ¬ Video"})}),a("div",{style:t.cardContent,children:[e.caption&&i("p",{style:t.caption,children:e.caption}),e.tags&&e.tags.length>0&&i("div",{style:t.tags,children:e.tags.map(o=>a("span",{style:t.tag,children:["#",o]},o))}),a("div",{style:t.meta,children:[i("span",{style:t.date,children:s}),e.createdByName&&a("span",{style:t.author,children:["Posted by ",e.createdByName]})]})]})]})}const t={container:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f5f7fa",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',padding:"2rem",textAlign:"center"},feedContainer:{minHeight:"100vh",background:"#f5f7fa",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},loadingSpinner:{width:"48px",height:"48px",border:"4px solid #e9ecef",borderTopColor:"#0a7ea4",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"1rem"},loadingText:{color:"#6c757d",fontSize:"1rem"},errorIcon:{width:"64px",height:"64px",background:"#dc3545",color:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",fontWeight:"bold",marginBottom:"1rem"},errorTitle:{fontSize:"1.5rem",color:"#1a1a2e",margin:"0 0 0.5rem 0"},errorMessage:{color:"#495057",margin:"0 0 1rem 0"},errorHint:{color:"#6c757d",fontSize:"0.875rem"},expiredIcon:{fontSize:"4rem",marginBottom:"1rem"},expiredTitle:{fontSize:"1.5rem",color:"#1a1a2e",margin:"0 0 1rem 0"},expiredMessage:{color:"#495057",lineHeight:1.6},header:{background:"#0a7ea4",color:"white",padding:"1.5rem 1rem",textAlign:"center",position:"sticky",top:0,zIndex:100},headerTitle:{margin:0,fontSize:"1.5rem",fontWeight:600},headerSubtitle:{margin:"0.25rem 0 0 0",fontSize:"0.875rem",opacity:.8},feed:{maxWidth:"600px",margin:"0 auto",padding:"1rem"},emptyState:{padding:"3rem 1rem",textAlign:"center",color:"#6c757d"},card:{background:"white",borderRadius:"12px",overflow:"hidden",marginBottom:"1rem",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},mediaContainer:{position:"relative",width:"100%",aspectRatio:"1",background:"#f0f0f0"},media:{width:"100%",height:"100%",objectFit:"cover"},carouselControls:{position:"absolute",bottom:"1rem",left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:"0.5rem",background:"rgba(0,0,0,0.6)",borderRadius:"20px",padding:"0.25rem 0.75rem"},carouselButton:{background:"none",border:"none",color:"white",fontSize:"1.5rem",cursor:"pointer",padding:"0 0.25rem"},carouselIndicator:{color:"white",fontSize:"0.875rem"},videoThumbnail:{position:"relative",width:"100%",height:"100%"},playIcon:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"60px",height:"60px",background:"rgba(0,0,0,0.6)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"1.5rem"},videoPlaceholder:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#e9ecef",fontSize:"1.5rem"},cardContent:{padding:"1rem"},caption:{margin:"0 0 0.75rem 0",fontSize:"1rem",lineHeight:1.5,color:"#1a1a2e"},tags:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginBottom:"0.75rem"},tag:{background:"#e9ecef",color:"#495057",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem"},meta:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.875rem",color:"#6c757d"},date:{},author:{}},F=function(){const{token:n}=u.useParams(),[r,d]=l({status:"loading"});return h(()=>{async function s(){const o=g(n);if(!o){d({status:"error",message:"Invalid link"});return}if(f(o)){d({status:"expired"});return}try{const[m,p]=await Promise.all([x(n,o.childId),v(n,o.childId)]);d({status:"ready",payload:o,child:m,entries:p})}catch{d({status:"error",message:"Failed to load data"})}}s()},[n]),r.status==="loading"?i(w,{}):r.status==="error"?i(I,{message:r.message}):r.status==="expired"?i(S,{}):i(k,{child:r.child,entries:r.entries})};export{F as component};
