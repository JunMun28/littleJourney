import{R as h,r as d,j as e}from"./client-BXl7ZxVm.js";function p(t){if(!t||t.length===0)return null;try{const n=atob(t),r=JSON.parse(n);return typeof r.familyMemberId!="string"||typeof r.permissionLevel!="string"||typeof r.childId!="string"||typeof r.createdAt!="number"||typeof r.expiresAt!="number"||typeof r.version!="number"||r.permissionLevel!=="view_only"&&r.permissionLevel!=="view_interact"?null:{familyMemberId:r.familyMemberId,permissionLevel:r.permissionLevel,childId:r.childId,createdAt:r.createdAt,expiresAt:r.expiresAt,version:r.version}}catch{return null}}function u(t){return Date.now()>t.expiresAt}const g={id:"child-1",name:"Baby Emma",nickname:"Em",dateOfBirth:"2025-01-15"},f=[{id:"entry-1",type:"photo",mediaUris:["https://images.unsplash.com/photo-1519689680058-324335c77eba?w=800"],caption:"First smile captured! Such a precious moment.",date:"2025-02-15",tags:["milestone","smile"],createdAt:"2025-02-15T10:30:00Z",updatedAt:"2025-02-15T10:30:00Z",createdByName:"Mum"},{id:"entry-2",type:"photo",mediaUris:["https://images.unsplash.com/photo-1503454537195-1dcabb73ffb9?w=800","https://images.unsplash.com/photo-1519689680058-324335c77eba?w=800"],caption:"æ»¡æœˆ celebration with grandparents!",date:"2025-02-14",tags:["æ»¡æœˆ","family"],createdAt:"2025-02-14T14:00:00Z",updatedAt:"2025-02-14T14:00:00Z",createdByName:"Dad"},{id:"entry-3",type:"text",caption:"Emma slept through the night for the first time! We are so happy and relieved. She's growing so fast.",date:"2025-02-10",createdAt:"2025-02-10T08:00:00Z",updatedAt:"2025-02-10T08:00:00Z",createdByName:"Mum"},{id:"entry-4",type:"video",mediaUris:["https://example.com/video.mp4"],thumbnailUrl:"https://images.unsplash.com/photo-1492725764893-90b379c2b6e7?w=800",caption:"Tummy time practice - getting stronger every day!",date:"2025-02-08",tags:["development"],createdAt:"2025-02-08T16:30:00Z",updatedAt:"2025-02-08T16:30:00Z",createdByName:"Dad"}];async function x(t,n){return await l(300),g}async function y(t,n){return await l(500),f}function l(t){return new Promise(n=>setTimeout(n,t))}function b(){return e.jsxs("div",{style:i.container,children:[e.jsx("div",{style:i.loadingSpinner}),e.jsx("p",{style:i.loadingText,children:"Loading memories..."})]})}function j({message:t}){return e.jsxs("div",{style:i.container,children:[e.jsx("div",{style:i.errorIcon,children:"!"}),e.jsx("h1",{style:i.errorTitle,children:"Oops!"}),e.jsx("p",{style:i.errorMessage,children:t}),e.jsx("p",{style:i.errorHint,children:"Please check the link you received or ask the parent to resend it."})]})}function v(){return e.jsxs("div",{style:i.container,children:[e.jsx("div",{style:i.expiredIcon,children:"â°"}),e.jsx("h1",{style:i.expiredTitle,children:"Link Expired"}),e.jsxs("p",{style:i.expiredMessage,children:["This link has expired due to inactivity.",e.jsx("br",{}),"Please ask the parent to resend the magic link."]})]})}function w({child:t,entries:n}){const r=t.nickname||t.name;return e.jsxs("div",{style:i.feedContainer,children:[e.jsxs("header",{style:i.header,children:[e.jsxs("h1",{style:i.headerTitle,children:[r,"'s Journey"]}),e.jsx("p",{style:i.headerSubtitle,children:"Little Journey"})]}),e.jsx("main",{style:i.feed,children:n.length===0?e.jsx("div",{style:i.emptyState,children:e.jsx("p",{children:"No memories yet. Check back soon!"})}):n.map(o=>e.jsx(I,{entry:o},o.id))})]})}function I({entry:t}){const[n,r]=d.useState(0),o=t.mediaUris&&t.mediaUris.length>1,s=new Date(t.date).toLocaleDateString("en-SG",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("article",{style:i.card,children:[t.type==="photo"&&t.mediaUris&&t.mediaUris.length>0&&e.jsxs("div",{style:i.mediaContainer,children:[e.jsx("img",{src:t.mediaUris[n],alt:t.caption||"Photo",style:i.media}),o&&e.jsxs("div",{style:i.carouselControls,children:[e.jsx("button",{onClick:()=>r(a=>a>0?a-1:t.mediaUris.length-1),style:i.carouselButton,"aria-label":"Previous photo",children:"â€¹"}),e.jsxs("span",{style:i.carouselIndicator,children:[n+1," / ",t.mediaUris.length]}),e.jsx("button",{onClick:()=>r(a=>a<t.mediaUris.length-1?a+1:0),style:i.carouselButton,"aria-label":"Next photo",children:"â€º"})]})]}),t.type==="video"&&e.jsx("div",{style:i.mediaContainer,children:t.thumbnailUrl?e.jsxs("div",{style:i.videoThumbnail,children:[e.jsx("img",{src:t.thumbnailUrl,alt:"Video thumbnail",style:i.media}),e.jsx("div",{style:i.playIcon,children:"â–¶"})]}):e.jsx("div",{style:i.videoPlaceholder,children:"ðŸŽ¬ Video"})}),e.jsxs("div",{style:i.cardContent,children:[t.caption&&e.jsx("p",{style:i.caption,children:t.caption}),t.tags&&t.tags.length>0&&e.jsx("div",{style:i.tags,children:t.tags.map(a=>e.jsxs("span",{style:i.tag,children:["#",a]},a))}),e.jsxs("div",{style:i.meta,children:[e.jsx("span",{style:i.date,children:s}),t.createdByName&&e.jsxs("span",{style:i.author,children:["Posted by ",t.createdByName]})]})]})]})}const i={container:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f5f7fa",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',padding:"2rem",textAlign:"center"},feedContainer:{minHeight:"100vh",background:"#f5f7fa",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},loadingSpinner:{width:"48px",height:"48px",border:"4px solid #e9ecef",borderTopColor:"#0a7ea4",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"1rem"},loadingText:{color:"#6c757d",fontSize:"1rem"},errorIcon:{width:"64px",height:"64px",background:"#dc3545",color:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",fontWeight:"bold",marginBottom:"1rem"},errorTitle:{fontSize:"1.5rem",color:"#1a1a2e",margin:"0 0 0.5rem 0"},errorMessage:{color:"#495057",margin:"0 0 1rem 0"},errorHint:{color:"#6c757d",fontSize:"0.875rem"},expiredIcon:{fontSize:"4rem",marginBottom:"1rem"},expiredTitle:{fontSize:"1.5rem",color:"#1a1a2e",margin:"0 0 1rem 0"},expiredMessage:{color:"#495057",lineHeight:1.6},header:{background:"#0a7ea4",color:"white",padding:"1.5rem 1rem",textAlign:"center",position:"sticky",top:0,zIndex:100},headerTitle:{margin:0,fontSize:"1.5rem",fontWeight:600},headerSubtitle:{margin:"0.25rem 0 0 0",fontSize:"0.875rem",opacity:.8},feed:{maxWidth:"600px",margin:"0 auto",padding:"1rem"},emptyState:{padding:"3rem 1rem",textAlign:"center",color:"#6c757d"},card:{background:"white",borderRadius:"12px",overflow:"hidden",marginBottom:"1rem",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},mediaContainer:{position:"relative",width:"100%",aspectRatio:"1",background:"#f0f0f0"},media:{width:"100%",height:"100%",objectFit:"cover"},carouselControls:{position:"absolute",bottom:"1rem",left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:"0.5rem",background:"rgba(0,0,0,0.6)",borderRadius:"20px",padding:"0.25rem 0.75rem"},carouselButton:{background:"none",border:"none",color:"white",fontSize:"1.5rem",cursor:"pointer",padding:"0 0.25rem"},carouselIndicator:{color:"white",fontSize:"0.875rem"},videoThumbnail:{position:"relative",width:"100%",height:"100%"},playIcon:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"60px",height:"60px",background:"rgba(0,0,0,0.6)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"1.5rem"},videoPlaceholder:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#e9ecef",fontSize:"1.5rem"},cardContent:{padding:"1rem"},caption:{margin:"0 0 0.75rem 0",fontSize:"1rem",lineHeight:1.5,color:"#1a1a2e"},tags:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginBottom:"0.75rem"},tag:{background:"#e9ecef",color:"#495057",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem"},meta:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.875rem",color:"#6c757d"},date:{},author:{}},k=function(){const{token:n}=h.useParams(),[r,o]=d.useState({status:"loading"});return d.useEffect(()=>{async function s(){const a=p(n);if(!a){o({status:"error",message:"Invalid link"});return}if(u(a)){o({status:"expired"});return}try{const[c,m]=await Promise.all([x(n,a.childId),y(n,a.childId)]);o({status:"ready",payload:a,child:c,entries:m})}catch{o({status:"error",message:"Failed to load data"})}}s()},[n]),r.status==="loading"?e.jsx(b,{}):r.status==="error"?e.jsx(j,{message:r.message}):r.status==="expired"?e.jsx(v,{}):e.jsx(w,{child:r.child,entries:r.entries})};export{k as component};
