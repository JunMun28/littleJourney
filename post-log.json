{
  "session_id": "4eb010bc-f584-4856-9d11-0ded2805a8b5",
  "transcript_path": "/Users/wongjunmun/.claude/projects/-Users-wongjunmun-Developer-expo-projects-littleJourney/4eb010bc-f584-4856-9d11-0ded2805a8b5.jsonl",
  "cwd": "/Users/wongjunmun/Developer/expo_projects/littleJourney",
  "permission_mode": "bypassPermissions",
  "hook_event_name": "PostToolUse",
  "tool_name": "Edit",
  "tool_input": {
    "file_path": "/Users/wongjunmun/Developer/expo_projects/littleJourney/progress.txt",
    "old_string": "**Verification:** tsc, lint, test (328 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)",
    "new_string": "**Verification:** tsc, lint, test (328 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n\n## 2026-01-15: Upload Rate Limiting\n\n**PRD ref:** Phase 1 Weeks 12-13, Section 13.2 (Rate Limiting)\n\n**Task:** Implement client-side upload rate limiting per PRD requirement (50/hour, 200/day)\n\n**Decisions:**\n- Created useRateLimit hook using AsyncStorage for persistence\n- UploadRecord type with timestamp for tracking upload history\n- HOURLY_LIMIT = 50, DAILY_LIMIT = 200 per PRD Section 13.2\n- canUpload boolean computed from current counts vs limits\n- rateLimitMessage returns user-friendly message when limit reached\n- recordUpload() adds timestamp and auto-cleans entries >24h old\n- Integrated into Feed screen: blocks photo/video at type selection step\n- Records upload on successful entry creation (media uploads only)\n- TDD approach: 9 hook tests + 3 integration tests\n\n**Files changed:**\n- hooks/use-rate-limit.ts - New: useRateLimit hook with canUpload, recordUpload, rateLimitMessage\n- app/(tabs)/index.tsx - Integrated rate limit check in handleTypeSelect, recordUpload in handleSubmit\n- __tests__/hooks/use-rate-limit.test.ts - New: 9 TDD tests for hook\n- __tests__/app/tabs/feed.test.tsx - Added 3 integration tests for rate limiting\n\n**Verification:** tsc, lint, test (340 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)",
    "replace_all": false
  },
  "tool_response": {
    "filePath": "/Users/wongjunmun/Developer/expo_projects/littleJourney/progress.txt",
    "oldString": "**Verification:** tsc, lint, test (328 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)",
    "newString": "**Verification:** tsc, lint, test (328 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n\n## 2026-01-15: Upload Rate Limiting\n\n**PRD ref:** Phase 1 Weeks 12-13, Section 13.2 (Rate Limiting)\n\n**Task:** Implement client-side upload rate limiting per PRD requirement (50/hour, 200/day)\n\n**Decisions:**\n- Created useRateLimit hook using AsyncStorage for persistence\n- UploadRecord type with timestamp for tracking upload history\n- HOURLY_LIMIT = 50, DAILY_LIMIT = 200 per PRD Section 13.2\n- canUpload boolean computed from current counts vs limits\n- rateLimitMessage returns user-friendly message when limit reached\n- recordUpload() adds timestamp and auto-cleans entries >24h old\n- Integrated into Feed screen: blocks photo/video at type selection step\n- Records upload on successful entry creation (media uploads only)\n- TDD approach: 9 hook tests + 3 integration tests\n\n**Files changed:**\n- hooks/use-rate-limit.ts - New: useRateLimit hook with canUpload, recordUpload, rateLimitMessage\n- app/(tabs)/index.tsx - Integrated rate limit check in handleTypeSelect, recordUpload in handleSubmit\n- __tests__/hooks/use-rate-limit.test.ts - New: 9 TDD tests for hook\n- __tests__/app/tabs/feed.test.tsx - Added 3 integration tests for rate limiting\n\n**Verification:** tsc, lint, test (340 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)",
    "originalFile": "# Little Journey - Development Progress\n\n## 2026-01-14: Core Tab Navigation Setup\n\n**PRD ref:** Phase 1 Weeks 1-2 Foundation, Section 4.1 Primary View\n\n**Task:** Set up 4-tab navigation structure (Feed, Milestones, Search, Settings)\n\n**Decisions:**\n- Used index.tsx as Feed tab (Expo Router convention for default route)\n- Removed template explore.tsx\n- Icons: house.fill (Feed), star.fill (Milestones), magnifyingglass (Search), gearshape.fill (Settings)\n- headerShown: true for proper screen titles\n\n**Files changed:**\n- app/(tabs)/_layout.tsx - Updated with 4 tabs\n- app/(tabs)/index.tsx - Feed screen (renamed from feed.tsx)\n- app/(tabs)/milestones.tsx - New placeholder\n- app/(tabs)/search.tsx - New placeholder\n- app/(tabs)/settings.tsx - New placeholder\n- Deleted: app/(tabs)/explore.tsx\n\n**Verification:** tsc, lint, test, build all pass\n\n**Next:** Authentication flow or onboarding screens per PRD Phase 1 Weeks 3-4\n\n## 2026-01-15: Auth Context and Route Protection\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 1 (Auth & Onboarding)\n\n**Task:** Set up auth architecture - context, hooks, route protection, sign-in screen\n\n**Decisions:**\n- Created AuthProvider + useAuth hook with mock signIn/signOut (ready for backend integration)\n- Used Slot-based routing with useSegments for auth gating (Expo Router pattern)\n- Auth screens in (auth) route group, tabs in (tabs) group\n- Sign-in screen is placeholder with demo flow - will add magic link/OAuth later\n- Primary button color hardcoded (#0a7ea4) to work in light/dark mode\n\n**Files changed:**\n- contexts/auth-context.tsx - New: AuthProvider, useAuth hook, User type\n- app/_layout.tsx - Wrap with AuthProvider, add RootLayoutNav for auth routing\n- app/(auth)/_layout.tsx - New: Auth route group layout\n- app/(auth)/sign-in.tsx - New: Sign-in placeholder screen\n- __tests__/contexts/auth-context.test.tsx - New: TDD tests for auth context\n\n**Verification:** tsc, lint, test (9 passed), build all pass. UI verified via Chrome MCP.\n\n**Next:** Guided onboarding flow (PRD Section 1.3) or child profile creation\n\n## 2026-01-15: Onboarding Route Group and Flow\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 (Guided Onboarding Flow)\n\n**Task:** Set up onboarding architecture - route group, routing logic, placeholder add-child screen\n\n**Decisions:**\n- Added hasCompletedOnboarding + completeOnboarding to auth context (mock, ready for backend)\n- 3-way routing in root layout: auth -> onboarding -> tabs\n- Onboarding screens in (onboarding) route group with Stack navigator\n- headerBackVisible: false, gestureEnabled: false to prevent back navigation during onboarding\n- add-child is first onboarding step (step 2 per PRD, step 1 sign-up already done)\n\n**Files changed:**\n- contexts/auth-context.tsx - Added hasCompletedOnboarding, completeOnboarding\n- app/_layout.tsx - Updated RootLayoutNav with 3-way routing logic\n- app/(onboarding)/_layout.tsx - New: Onboarding route group layout\n- app/(onboarding)/add-child.tsx - New: Add child placeholder screen\n- app/(auth)/sign-in.tsx - Removed manual router.replace (handled by root layout)\n- __tests__/contexts/auth-context.test.tsx - Added 3 tests for onboarding state\n\n**Verification:** tsc, lint, test (12 passed), build all pass. UI verified via Chrome MCP.\n\n**Next:** Child form fields (name, DOB, photo) or remaining onboarding steps (culture, prompt time, invite)\n\n## 2026-01-15: Add Child Form Implementation\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 2.1 (Child Profile)\n\n**Task:** Implement Add Child form with name, DOB, nickname fields and validation\n\n**Decisions:**\n- Created ChildContext + useChild hook for child state management (TDD approach)\n- Child type: name (required), dateOfBirth (ISO string, required), nickname (optional), photoUri (optional)\n- Form validation: name required, DOB required, DOB cannot be future\n- Used @react-native-community/datetimepicker for native date picking\n- Continue button disabled until form valid (visual feedback via gray color)\n- Date displayed in Singapore locale format (en-SG)\n- KeyboardAvoidingView + ScrollView for proper keyboard handling\n\n**Files changed:**\n- contexts/child-context.tsx - New: ChildProvider, useChild hook, Child type\n- app/_layout.tsx - Added ChildProvider wrapper\n- app/(onboarding)/add-child.tsx - Full form implementation with validation\n- __tests__/contexts/child-context.test.tsx - New: 5 TDD tests for child context\n\n**Verification:** tsc, lint, test (17 passed), build all pass. UI verified via Chrome MCP.\n\n**Next:** Remaining onboarding steps (culture selection, prompt time, invite family) or photo picker for child\n\n## 2026-01-15: Cultural Tradition Selection Screen\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 3 (Select cultural tradition)\n\n**Task:** Implement cultural tradition selection as step 3 of onboarding flow\n\n**Decisions:**\n- Added CulturalTradition type: \"chinese\" | \"malay\" | \"indian\" | \"none\"\n- Added culturalTradition optional field to Child interface\n- Added updateChild method to ChildContext for partial updates\n- Created select-culture.tsx with radio button selection UI\n- add-child now navigates to select-culture instead of completing onboarding\n- select-culture completes onboarding after selection\n- Culture options show milestone examples (Full Month, Aqiqah, Annaprashan, etc.)\n\n**Files changed:**\n- contexts/child-context.tsx - Added CulturalTradition type, culturalTradition field, updateChild method\n- app/(onboarding)/select-culture.tsx - New: Culture selection screen with radio options\n- app/(onboarding)/_layout.tsx - Added select-culture Stack.Screen\n- app/(onboarding)/add-child.tsx - Navigate to select-culture instead of completeOnboarding\n- __tests__/contexts/child-context.test.tsx - Added 2 tests for culturalTradition and updateChild\n\n**Verification:** tsc, lint, test (19 passed), build all pass. UI verified via Chrome MCP.\n\n**Next:** Daily prompt time selection (step 4) or invite family member (step 5)\n\n## 2026-01-15: Daily Prompt Time Selection Screen\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 4 (Set daily prompt time)\n\n**Task:** Implement daily prompt time selection as step 4 of onboarding flow\n\n**Decisions:**\n- Created UserPreferencesContext + useUserPreferences hook for user settings (TDD approach)\n- dailyPromptTime stored as 24-hour string \"HH:mm\" (e.g., \"20:00\")\n- Default time: 8:00 PM SGT per PRD\n- Used @react-native-community/datetimepicker with 5-minute intervals\n- Platform-specific display: iOS spinner, Android default picker\n- Skip option available (completes onboarding without setting time)\n- Continue saves time and completes onboarding\n- select-culture now navigates to set-prompt-time instead of completing onboarding\n\n**Files changed:**\n- contexts/user-preferences-context.tsx - New: UserPreferencesProvider, useUserPreferences hook\n- app/_layout.tsx - Added UserPreferencesProvider wrapper\n- app/(onboarding)/set-prompt-time.tsx - New: Time picker screen with skip option\n- app/(onboarding)/_layout.tsx - Added set-prompt-time Stack.Screen\n- app/(onboarding)/select-culture.tsx - Navigate to set-prompt-time instead of completeOnboarding\n- __tests__/contexts/user-preferences-context.test.tsx - New: 5 TDD tests for user preferences\n\n**Verification:** tsc, lint, test (24 passed), build all pass. Route protection verified via Chrome MCP.\n\n**Next:** Invite family member (step 5) or first entry prompt (step 6)\n\n## 2026-01-15: Invite Family Member Screen\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 5 (Invite first family member)\n\n**Task:** Implement invite family member as step 5 of onboarding flow\n\n**Decisions:**\n- Created FamilyContext + useFamily hook for family member management (TDD approach)\n- FamilyMember type: id, email, relationship, permissionLevel, status, invitedAt\n- PermissionLevel: \"view_only\" | \"view_interact\" per PRD Section 6.3\n- InviteStatus: \"pending\" | \"accepted\" | \"expired\"\n- Form validation: valid email required, relationship required\n- Permission defaults to \"view_interact\" (most useful for grandparents)\n- Skip option completes onboarding without inviting\n- set-prompt-time now navigates to invite-family instead of completing onboarding\n\n**Files changed:**\n- contexts/family-context.tsx - New: FamilyProvider, useFamily hook, types\n- app/_layout.tsx - Added FamilyProvider wrapper\n- app/(onboarding)/invite-family.tsx - New: Invite form with email, relationship, permission\n- app/(onboarding)/_layout.tsx - Added invite-family Stack.Screen\n- app/(onboarding)/set-prompt-time.tsx - Navigate to invite-family instead of completeOnboarding\n- __tests__/contexts/family-context.test.tsx - New: 6 TDD tests for family context\n\n**Verification:** tsc, lint, test (30 passed), build all pass.\n\n**Next:** First entry prompt (step 6) or core Feed features (entries, photos)\n\n## 2026-01-15: First Entry Prompt Screen\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 6 (First entry prompt)\n\n**Task:** Implement first entry prompt as final onboarding step (step 6)\n\n**Decisions:**\n- Installed expo-image-picker for gallery/camera access\n- Screen prompts \"Add your first moment!\" with camera emoji icon\n- \"Choose from Gallery\" button requests media library permission then launches picker\n- Skip option (\"I'll do this later\") completes onboarding without adding photo\n- If user selects photo, completes onboarding (entry creation deferred to Feed feature)\n- invite-family now navigates to first-entry instead of completing onboarding\n\n**Files changed:**\n- app/(onboarding)/first-entry.tsx - New: First entry prompt with image picker\n- app/(onboarding)/_layout.tsx - Added first-entry Stack.Screen\n- app/(onboarding)/invite-family.tsx - Navigate to first-entry, removed useAuth import\n- __tests__/app/onboarding/first-entry.test.tsx - New: 5 TDD tests for first-entry screen\n- package.json - Added expo-image-picker dependency\n\n**Verification:** tsc, lint, test (35 passed), build all pass.\n\n**Next:** Core Feed features (entry creation, photo upload) per PRD Phase 1 Weeks 5-7\n\n## 2026-01-15: Entry Context and Feed UI\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 3 (Entry Creation), Section 4 (Timeline & Feed)\n\n**Task:** Implement entry types, context, and feed UI with entry creation modal\n\n**Decisions:**\n- Created EntryContext + useEntries hook for entry state management (TDD approach)\n- Entry type: id, type (photo/video/text), mediaUris (carousel), caption, date, tags, timestamps\n- Entries stored reverse chronological (newest first) per PRD Section 4.1\n- Feed shows FlatList with EntryCard components, EmptyState when no entries\n- Floating action button (+) opens entry creation modal\n- 2-step creation flow: type selection -> caption/media\n- Photo/video picker reuses expo-image-picker from onboarding\n- Multiple photo selection supported for carousel entries\n- Entry card shows image, video placeholder, caption, date, carousel indicator\n\n**Files changed:**\n- contexts/entry-context.tsx - New: EntryProvider, useEntries hook, Entry/EntryType types\n- app/_layout.tsx - Added EntryProvider wrapper\n- app/(tabs)/index.tsx - Full feed UI with entry cards, FAB, creation modal\n- __tests__/contexts/entry-context.test.tsx - New: 8 TDD tests for entry context\n\n**Verification:** tsc, lint, test (43 passed), build all pass.\n\n**Next:** Pull-to-refresh, entry detail view, or photo carousel swipe per PRD Section 4\n\n## 2026-01-15: Pull-to-Refresh for Feed\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 4.1 (Primary View: Feed - Pull-to-refresh)\n\n**Task:** Add pull-to-refresh to Feed FlatList\n\n**Decisions:**\n- Used RefreshControl component with FlatList's refreshControl prop\n- Added refreshing state + onRefresh callback with useCallback\n- Simulated 1s refresh delay (placeholder for TanStack Query invalidation)\n- tintColor/colors set to PRIMARY_COLOR for consistent branding\n\n**Files changed:**\n- app/(tabs)/index.tsx - Added RefreshControl, refreshing state, onRefresh handler\n\n**Verification:** tsc, lint, test (43 passed), build all pass.\n\n**Next:** Entry detail view, photo carousel swipe, or edit/delete entries per PRD Section 4\n\n## 2026-01-15: Photo Carousel Component\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 4.3 (Photo Carousel)\n\n**Task:** Implement swipeable photo carousel for multi-photo entries with dot indicators\n\n**Decisions:**\n- Created PhotoCarousel component with horizontal ScrollView + pagingEnabled\n- Dot indicators shown only when images.length > 1\n- Active dot opacity 1, inactive 0.4 for visual feedback\n- onImagePress callback for future full-screen view integration\n- Configurable aspectRatio prop (default 1:1 square)\n- Used onScroll with scrollEventThrottle to track active index\n- Removed old carouselIndicator text (\"1/N\") in favor of dots\n\n**Files changed:**\n- components/photo-carousel.tsx - New: PhotoCarousel with swipe + dots\n- __tests__/components/photo-carousel.test.tsx - New: 5 TDD tests\n- app/(tabs)/index.tsx - Integrated PhotoCarousel, removed cardImage/carouselIndicator styles\n\n**Verification:** tsc, lint, test (48 passed), build all pass.\n\n**Next:** Entry detail view (full-screen on tap) or edit/delete entries per PRD Section 3.6\n\n## 2026-01-15: Entry Detail Screen (Full-Screen View)\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 4.3 (Photo Carousel - Full-screen view on tap)\n\n**Task:** Implement full-screen entry detail view when tapping an entry in Feed\n\n**Decisions:**\n- Created dynamic route app/entry/[id].tsx for entry detail\n- Full-screen black background with photo carousel for multi-photo entries\n- Header overlay with back button (‚Üê) and image counter (1/N)\n- Caption + date shown in semi-transparent overlay at bottom\n- Used router.push for navigation, router.back for returning\n- EntryCard now accepts onPress prop and is wrapped in Pressable\n- PhotoCarousel onImagePress also triggers navigation to detail view\n\n**Files changed:**\n- app/entry/[id].tsx - New: Full-screen entry detail with image carousel\n- app/(tabs)/index.tsx - Added router import, onPress to EntryCard\n- __tests__/app/entry/entry-detail.test.tsx - New: 5 TDD tests for detail screen\n\n**Verification:** tsc, lint, test (53 passed), build all pass.\n\n**Next:** Edit/delete entries (PRD Section 3.6) or video playback (PRD Section 9.3)\n\n## 2026-01-15: Entry Edit/Delete UI\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 3.6 (Entry Ownership & Editing)\n\n**Task:** Add edit/delete actions to entry detail screen\n\n**Decisions:**\n- EntryContext already had updateEntry/deleteEntry methods (implemented earlier)\n- Added options button (‚ãÆ) to entry detail header next to back button\n- Used Modal with two states: \"options\" menu and \"confirmDelete\" confirmation\n- iOS-style dark menu with Edit and Delete options\n- Delete shows confirmation dialog with red \"Delete Entry\" button\n- On delete: calls deleteEntry(id) then router.back()\n- Edit is placeholder (TODO: implement edit modal/screen)\n\n**Files changed:**\n- app/entry/[id].tsx - Added options button, modal with edit/delete, delete confirmation\n- __tests__/app/entry/entry-detail.test.tsx - Added 4 tests for options menu and delete flow\n\n**Verification:** tsc, lint, test (57 passed), build all pass.\n\n**Next:** Entry edit modal/screen or video playback (PRD Section 9.3)\n\n## 2026-01-15: Entry Edit Modal\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 3.6 (Entry Ownership & Editing)\n\n**Task:** Implement edit modal for editing entry caption\n\n**Decisions:**\n- Added \"edit\" state to MenuState type (was: closed/options/confirmDelete)\n- Edit modal slides up from bottom (iOS sheet pattern)\n- Pre-fills caption from current entry on open\n- Save button calls updateEntry(id, { caption }) and closes modal\n- Cancel button closes modal without saving\n- KeyboardAvoidingView handles keyboard on iOS/Android\n- Multiline TextInput with 500 char limit for caption\n\n**Files changed:**\n- app/entry/[id].tsx - Added edit modal UI, editCaption state, save/cancel handlers\n- __tests__/app/entry/entry-detail.test.tsx - Added 4 tests for edit modal flow\n\n**Verification:** tsc, lint, test (61 passed), build all pass.\n\n**Next:** Video playback (PRD Section 9.3) or search/milestones features\n\n## 2026-01-15: Milestones Feature - Context and Tab UI\n\n**PRD ref:** Phase 1 Weeks 8-9, Section 5 (Milestones)\n\n**Task:** Implement MilestoneContext and Milestones tab with templates and UI\n\n**Decisions:**\n- Created MilestoneContext + useMilestones hook for milestone state management (TDD approach)\n- Milestone type: id, templateId, childId, milestoneDate, celebrationDate, customTitle/Description, isCompleted\n- MILESTONE_TEMPLATES constant with PRD Section 5.1 cultural milestones:\n  - Chinese: Full Month (Êª°Êúà), 100 Days (ÁôæÊó•), Zhua Zhou (ÊäìÂë®), First Lunar New Year\n  - Malay: Aqiqah, Cukur Jambul, First Hari Raya\n  - Indian: Naming Ceremony, Annaprashan, First Deepavali\n  - Universal: First smile/laugh/steps/words/tooth/haircut/school\n- Templates filtered by child's cultural tradition + universal\n- daysFromBirth auto-calculates milestone date from child DOB\n- Milestones tab: empty state, upcoming/completed sections, FAB\n- Two modals: template selection (bottom sheet), custom milestone (full screen)\n- Custom milestone form: title, description, date picker\n\n**Files changed:**\n- contexts/milestone-context.tsx - New: MilestoneProvider, useMilestones, types, MILESTONE_TEMPLATES\n- app/_layout.tsx - Added MilestoneProvider wrapper\n- app/(tabs)/milestones.tsx - Full milestone UI with sections, modals, template list\n- __tests__/contexts/milestone-context.test.tsx - New: 7 TDD tests for milestone context\n\n**Verification:** tsc, lint, test (68 passed), build all pass.\n\n**Next:** Milestone completion flow, milestone detail view, or PRD Section 8 (Search)\n\n## 2026-01-15: Milestone Completion Flow\n\n**PRD ref:** Phase 1 Weeks 8-9, Section 5.2 (Dual Date System), Section 5.3 (Milestone UI)\n\n**Task:** Implement milestone completion modal - mark milestones as completed with celebration date and notes\n\n**Decisions:**\n- Added \"complete\" to ModalState type for completion modal\n- Milestone cards now tappable (wrapped in Pressable) to open completion modal\n- Completion modal shows: milestone title, celebration date picker, notes input\n- completeMilestone and deleteMilestone from context now used in UI\n- Delete option available in completion modal (red outline button)\n- Celebration date defaults to today (can be changed)\n- Notes are optional\n\n**Files changed:**\n- app/(tabs)/milestones.tsx - Added completion modal, tappable cards, completion/delete handlers, new styles\n- __tests__/app/tabs/milestones.test.tsx - New: 5 TDD tests for milestone screen + completion flow\n\n**Verification:** tsc, lint, test (73 passed), build all pass.\n\n**Next:** Search feature (PRD Section 8) or video playback (PRD Section 9.3)\n\n## 2026-01-15: Search Feature - UI and Local Filtering\n\n**PRD ref:** Phase 1 Weeks 8-9, Section 8 (Search & Discovery)\n\n**Task:** Implement Search tab UI with text search and type filtering\n\n**Decisions:**\n- Search filters entries by caption text and tags (local filtering, AI/Vectorize deferred)\n- Filter chips: All, Photos, Videos, Text (type-based filtering)\n- Empty state with search icon when no query entered\n- \"No Results\" state when search has no matches\n- SearchResultCard shows thumbnail, caption, date, tags (max 3)\n- Tapping result navigates to entry detail view (/entry/[id])\n- useMemo for filtered entries to optimize re-renders\n\n**Files changed:**\n- app/(tabs)/search.tsx - Full search UI with input, filter chips, results list\n- __tests__/app/tabs/search.test.tsx - New: 6 TDD tests for search functionality\n\n**Verification:** tsc, lint, test (79 passed), build all pass.\n\n**Next:** Video playback (PRD Section 9.3) or push notifications (PRD Section 7)\n\n## 2026-01-15: Video Playback with expo-av\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 9.3 (Video Playback)\n\n**Task:** Implement video playback for video entries using expo-av\n\n**Decisions:**\n- Installed expo-av for Video component (note: deprecated in SDK 54, will migrate to expo-video later)\n- Created VideoPlayer component with play/pause overlay controls\n- VideoPlayer replaces placeholder üé¨ emoji in Feed EntryCard\n- Entry Detail shows full-screen video player for video entries\n- Auto-loops videos, tap to toggle play/pause\n- ResizeMode.CONTAIN for proper aspect ratio\n- TDD approach: wrote tests first with expo-av mocks\n\n**Files changed:**\n- components/video-player.tsx - New: VideoPlayer with expo-av Video, play/pause controls\n- app/(tabs)/index.tsx - Integrated VideoPlayer in EntryCard, removed videoPlaceholder styles\n- app/entry/[id].tsx - Added VideoPlayer for video entries, conditional rendering photo vs video\n- __tests__/components/video-player.test.tsx - New: 5 TDD tests for VideoPlayer\n- __tests__/app/entry/entry-detail.test.tsx - Added expo-av mock\n- package.json - Added expo-av dependency\n\n**Verification:** tsc, lint, test (84 passed), build all pass.\n\n**Next:** Push notifications (PRD Section 7) or Settings screen UI\n\n## 2026-01-15: Push Notifications Context\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 7 (Notifications)\n\n**Task:** Implement NotificationContext for push notification settings and scheduling\n\n**Decisions:**\n- Created NotificationContext + useNotifications hook (TDD approach)\n- NotificationSettings type with 5 toggles per PRD Section 7.1: dailyPrompt, memories, milestoneReminder, familyActivity, storageWarning\n- All default to true (on) per PRD\n- Permission status: granted/denied/undetermined\n- requestPermissions() gets expo push token and sets up Android channel\n- scheduleDailyPrompt(time) cancels existing then schedules daily notification at specified time\n- cancelDailyPrompt() cancels all scheduled notifications\n- Uses Notifications.SchedulableTriggerInputTypes.DAILY for repeating daily trigger\n- Listeners set up for notification received and response handling\n\n**Files changed:**\n- contexts/notification-context.tsx - New: NotificationProvider, useNotifications, NotificationSettings type\n- app/_layout.tsx - Added NotificationProvider wrapper\n- __tests__/contexts/notification-context.test.tsx - New: 7 TDD tests for notification context\n- package.json - Added expo-notifications, expo-device dependencies\n\n**Verification:** tsc, lint, test (91 passed), build all pass.\n\n**Next:** Settings screen UI with notification toggles or family invitation flow\n\n## 2026-01-15: Settings Screen UI\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 7.4 (Notification Settings), Section 6.1 (Invitation Flow)\n\n**Task:** Implement Settings screen with notification toggles, family member management, sign-out\n\n**Decisions:**\n- 3 sections: Notifications, Family, Account (iOS Settings app pattern)\n- Notification toggles: Daily Prompts, On This Day Memories, Milestone Reminders, Family Activity\n- Permission banner shown when notifications not granted (tappable to request)\n- Invite Family modal: email, relationship, permission level (view_interact/view_only)\n- Family members displayed in list with Remove option\n- Sign Out with Alert confirmation (destructive style)\n- ScrollView for content, KeyboardAvoidingView in modal\n\n**Files changed:**\n- app/(tabs)/settings.tsx - Full settings UI with toggles, family list, invite modal, sign out\n- __tests__/app/tabs/settings.test.tsx - New: 5 TDD tests for settings screen\n\n**Verification:** tsc, lint, test (96 passed), build all pass.\n\n**Next:** Remaining Phase 1 Week 12-13 items (Stripe payments, storage limits, polish) or Week 10-11 daily prompt scheduling integration\n\n## 2026-01-15: Daily Prompt Notification Integration\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 7.2 (Implementation), Section 7.3 (Smart Frequency)\n\n**Task:** Integrate daily prompt scheduling with user preferences and notification toggle\n\n**Decisions:**\n- Settings screen now shows \"Reminder Time\" row with current time or \"Not set\"\n- Time picker modal for changing prompt time (reuses DateTimePicker from onboarding)\n- When dailyPrompt toggle changes: schedules notification if ON + time set, cancels if OFF\n- Onboarding set-prompt-time now requests permissions and schedules notification on Continue\n- formatDisplayTime, timeStringToDate, dateToTimeString helpers for time conversion\n- Schedule only when permissions granted (handles denied gracefully)\n\n**Files changed:**\n- app/(tabs)/settings.tsx - Added time picker modal, Reminder Time row, toggle schedules/cancels\n- app/(onboarding)/set-prompt-time.tsx - Integrated requestPermissions + scheduleDailyPrompt\n- __tests__/app/tabs/settings.test.tsx - Added 2 TDD tests for Reminder Time display\n\n**Verification:** tsc, lint, test (98 passed), build all pass.\n\n**Next:** Remaining Phase 1 Week 12-13 items (Stripe payments, storage limits, polish) or Photo for child profile\n\n## 2026-01-15: Storage Context and Tier Limits\n\n**PRD ref:** Phase 1 Weeks 12-13, Section 9.1 (Video Tier Limits), Section 12.1 (Tier Structure)\n\n**Task:** Implement StorageContext for tracking storage usage and enforcing tier limits\n\n**Decisions:**\n- Created StorageContext + useStorage hook for storage management (TDD approach)\n- SubscriptionTier type: \"free\" | \"standard\" | \"premium\"\n- TIER_LIMITS constant: free=500MB, standard=10GB, premium=50GB per PRD\n- VIDEO_DURATION_LIMITS: free=0, standard=2min, premium=10min per PRD Section 9.1\n- usagePercent calculated as Math.round((usedBytes/limitBytes)*100)\n- canUpload(bytes) checks if addition would exceed limit\n- canUploadVideo(seconds) checks tier video permissions\n- addUsage/removeUsage for tracking media uploads/deletes\n\n**Files changed:**\n- contexts/storage-context.tsx - New: StorageProvider, useStorage, TIER_LIMITS, VIDEO_DURATION_LIMITS\n- app/_layout.tsx - Added StorageProvider wrapper\n- __tests__/contexts/storage-context.test.tsx - New: 7 TDD tests for storage context\n\n**Verification:** tsc, lint, test (105 passed), build all pass.\n\n**Next:** Integrate storage tracking with entry creation or Settings screen storage display\n\n## 2026-01-15: Storage Integration with Entry Creation + Settings Display\n\n**PRD ref:** Phase 1 Weeks 12-13, Section 9.1 (Video Tier Limits), Section 12.1 (Tier Structure)\n\n**Task:** Integrate storage limits with entry creation flow and display storage in Settings\n\n**Decisions:**\n- Feed screen now checks storage limits before allowing photo/video uploads\n- Video button shows \"Video Not Available\" alert on free tier (no video allowed)\n- Video uploads check duration limit: standard=2min, premium=10min\n- Photo/video uploads check total file size against storage limit\n- File sizes tracked from ImagePicker assets and added to storage usage on submit\n- Settings screen shows new Storage section with:\n  - Plan name (Free/Standard/Premium)\n  - Usage bar with color: green (<80%), yellow (80-90%), red (>90%)\n  - Usage text: \"X B of Y MB\" and \"N% used\"\n  - Upgrade prompt on free tier\n\n**Files changed:**\n- app/(tabs)/index.tsx - Added useStorage hook, storage/video checks in handleTypeSelect, track usage in handleSubmit\n- app/(tabs)/settings.tsx - Added Storage section with progress bar, tier display, upgrade prompt\n- __tests__/app/tabs/feed.test.tsx - New: 6 TDD tests for storage validation\n- __tests__/app/tabs/settings.test.tsx - Added StorageProvider, 2 tests for storage section\n\n**Verification:** tsc, lint, test (113 passed), build all pass.\n\n**Next:** Stripe payments integration (PRD Section 12.2) or UI polish\n\n## 2026-01-15: Data Export Feature\n\n**PRD ref:** Phase 1 Weeks 12-13, Section 11.1 (Data Export)\n\n**Task:** Implement data export functionality - \"Download all memories\" per PRD\n\n**Decisions:**\n- Created ExportContext + useExport hook for export functionality (TDD approach)\n- ExportData type contains: exportDate, version, child, entries, milestones\n- Uses expo-file-system new File API (Paths.document, File.write)\n- Uses expo-sharing for native share sheet integration\n- Export generates JSON file named little-journey-export-{date}.json\n- Added \"Data & Privacy\" section to Settings per PRD Section 11\n- Button shows \"Exporting...\" with disabled state during export\n- lastExportDate displayed after successful export\n\n**Files changed:**\n- contexts/export-context.tsx - New: ExportProvider, useExport, ExportData type\n- app/_layout.tsx - Added ExportProvider wrapper\n- app/(tabs)/settings.tsx - Added Data & Privacy section with export button\n- __tests__/contexts/export-context.test.tsx - New: 6 TDD tests for export context\n- __tests__/app/tabs/settings.test.tsx - Added ExportProvider, 2 tests for export UI\n- package.json - Added expo-file-system, expo-sharing dependencies\n\n**Verification:** tsc, lint, test (121 passed), build all pass.\n\n**Next:** Account deletion (PRD Section 11.2) or Stripe payments (PRD Section 12.2)\n\n## 2026-01-15: Account Deletion Feature\n\n**PRD ref:** Phase 1 Weeks 12-13, Section 11.2 (Account Deletion)\n\n**Task:** Implement account deletion with 30-day grace period per PRD\n\n**Decisions:**\n- Added deletionScheduledAt, requestAccountDeletion, cancelAccountDeletion to AuthContext\n- requestAccountDeletion sets deletion date 30 days in future (grace period per PRD)\n- cancelAccountDeletion clears scheduled deletion\n- signOut clears deletion state\n- Settings shows \"Delete Account\" button opening modal with confirmation\n- User must type \"DELETE\" to confirm (PRD requirement)\n- Modal shows warning list of data to be deleted and 30-day grace period info\n- When deletion scheduled: shows yellow banner with date and \"Cancel Deletion\" button\n- Delete button hidden when deletion already scheduled (replaced by cancel banner)\n\n**Files changed:**\n- contexts/auth-context.tsx - Added deletionScheduledAt state, requestAccountDeletion/cancelAccountDeletion methods\n- app/(tabs)/settings.tsx - Added delete account modal, confirmation flow, scheduled deletion UI\n- __tests__/contexts/auth-context.test.tsx - Added 4 TDD tests for deletion state\n- __tests__/app/tabs/settings.test.tsx - Added 2 tests for delete account UI\n\n**Verification:** tsc, lint, test (127 passed), build all pass.\n\n**Next:** Stripe payments integration (PRD Section 12.2) or UI polish\n\n## 2026-01-15: Subscription Context and Upgrade Flow\n\n**PRD ref:** Phase 1 Weeks 12-13, Section 12 (Monetization)\n\n**Task:** Implement subscription/payment infrastructure and upgrade UI per PRD 12.1-12.3\n\n**Decisions:**\n- Created SubscriptionContext + useSubscription hook for subscription state management (TDD approach)\n- PLAN_DETAILS constant with PRD prices: Standard $4.99/mo ($39.99/yr), Premium $9.99/mo ($79.99/yr)\n- BillingCycle type: \"monthly\" | \"yearly\"\n- subscribe() method handles plan subscription (mock, ready for Stripe integration)\n- cancelSubscription() marks subscription for cancellation (access until period ends per PRD 12.3)\n- restoreSubscription() unmarks cancelled subscription\n- Added Subscription section to Settings with plan display, cancel/restore buttons\n- Subscription modal: billing cycle toggle, plan cards with features, subscribe button\n- Storage context setTier synced with subscription changes\n- Upgrade prompt in Storage section now opens subscription modal\n\n**Files changed:**\n- contexts/subscription-context.tsx - New: SubscriptionProvider, useSubscription, PLAN_DETAILS, types\n- app/_layout.tsx - Added SubscriptionProvider wrapper\n- app/(tabs)/settings.tsx - Added subscription section, upgrade modal, cancel/restore flow\n- __tests__/contexts/subscription-context.test.tsx - New: 10 TDD tests for subscription context\n- __tests__/app/tabs/settings.test.tsx - Added SubscriptionProvider, updated tests\n\n**Verification:** tsc, lint, test (136 passed), build all pass.\n\n**Next:** UI polish or integrate with actual Stripe SDK\n\n## 2026-01-15: \"On This Day\" Memories Feature\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 4.5 (\"On This Day\" Memories)\n\n**Task:** Implement \"On This Day\" memory card in Feed showing entries from same day in previous years\n\n**Decisions:**\n- Added getOnThisDayEntries() to EntryContext - filters entries by same month/day in previous years\n- OnThisDayCard component shows golden-bordered card with sparkle icon\n- Displays up to 3 memory thumbnails horizontally\n- Each thumbnail shows \"X years ago\" label\n- Tapping memory navigates to entry detail view\n- Card only renders when memories exist (returns null otherwise)\n- FlatList uses ListHeaderComponent for card (shows above Feed entries)\n- Empty state logic updated: shows empty state only when no entries AND no memories\n\n**Files changed:**\n- contexts/entry-context.tsx - Added getOnThisDayEntries() method to context\n- app/(tabs)/index.tsx - Added OnThisDayCard component, integrated in Feed, added styles\n- __tests__/app/tabs/feed.test.tsx - Added 4 TDD tests for \"On This Day\" logic\n\n**Verification:** tsc, lint, test (140 passed), build all pass.\n\n**Next:** Photo book export (PRD Section 10) or UI polish\n\n## 2026-01-15: Child Profile Photo Picker\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 2.1 (Child Profile - Photo optional field)\n\n**Task:** Add photo picker to add-child onboarding screen for child profile photo\n\n**Decisions:**\n- Reused expo-image-picker pattern from first-entry.tsx\n- Circular photo button (100x100) with dashed border, centered above form fields\n- allowsEditing: true with 1:1 aspect ratio for profile-appropriate cropping\n- Placeholder shows camera emoji + \"Add Photo\" text\n- photoUri stored in child context and passed to setChild on Continue\n- TDD approach: wrote 5 tests before implementation\n\n**Files changed:**\n- app/(onboarding)/add-child.tsx - Added photo picker UI, handlePickPhoto, photoUri state\n- __tests__/app/onboarding/add-child.test.tsx - New: 5 TDD tests for photo picker\n\n**Verification:** tsc, lint, test (145 passed), build all pass.\n\n**Next:** Photo book export (PRD Section 10) or Settings child profile edit\n\n## 2026-01-15: Child Profile Edit in Settings\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish), Section 2.1 (Child Profile)\n\n**Task:** Add child profile display and edit capability to Settings screen\n\n**Decisions:**\n- Added Child Profile section between Notifications and Family sections\n- Profile shows: photo (or placeholder), name, nickname, DOB, cultural tradition\n- Edit button opens modal with full profile editing (reuses onboarding patterns)\n- Edit modal includes: photo picker, name, nickname, DOB picker, cultural tradition selector\n- Used updateChild from ChildContext for partial updates\n- Empty state shows \"No child profile added\" when no child exists\n- TDD approach: 5 new tests added to existing settings.test.tsx\n\n**Files changed:**\n- app/(tabs)/settings.tsx - Added child profile section, edit modal, handlers, styles\n- __tests__/app/tabs/settings.test.tsx - Added 5 TDD tests for child profile, plus test helpers\n\n**Verification:** tsc, lint, test (150 passed), build all pass.\n\n**Next:** Photo book export (PRD Section 10) or UI polish\n\n## 2026-01-15: Photo Book Export Feature\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish), Section 10 (Photo Book Export)\n\n**Task:** Implement photo book generation and PDF export (premium feature)\n\n**Decisions:**\n- Created PhotoBookContext + usePhotoBook hook for photo book state management (TDD approach)\n- PhotoBookPage type: title, photo, milestone, blank page types\n- Auto-generates pages from milestone entries + regular photo entries\n- Milestones within 3 days of entry date get associated as milestone pages\n- Title page auto-generated with child name and birth date\n- Pages can be reordered, removed, and captions edited\n- canExportPdf checks subscription tier (premium/standard only per PRD 10.3)\n- Photo Book screen: preview with page cards, edit/remove actions, regenerate option\n- PageCard component shows page number, image, caption, milestone badge\n- Export button shows \"Premium\" badge if user on free tier\n- Photo Book section added to Settings with \"Create Photo Book\" button\n\n**Files changed:**\n- contexts/photo-book-context.tsx - New: PhotoBookProvider, usePhotoBook, types\n- app/_layout.tsx - Added PhotoBookProvider wrapper\n- app/photo-book.tsx - New: Full photo book preview with page list, edit modal\n- app/(tabs)/settings.tsx - Added Photo Book section with navigation button\n- __tests__/contexts/photo-book-context.test.tsx - New: 7 TDD tests for photo book context\n\n**Verification:** tsc, lint, test (157 passed), build all pass.\n\n**Next:** UI polish, dark mode improvements, or actual PDF generation implementation\n\n## 2026-01-15: UI Polish - Theme System Extension\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish)\n\n**Task:** Extend theme system with comprehensive colors, update Feed screen to use theme colors\n\n**Decisions:**\n- Extended constants/theme.ts with comprehensive color palette:\n  - PRIMARY_COLOR exported constant (replaces local definitions)\n  - Colors.light/dark: textSecondary, textMuted, backgroundSecondary, backgroundTertiary, border, borderLight, inputBorder, placeholder, card, cardBorder, overlay, overlayLight\n  - SemanticColors: success, warning, error, info, gold (and light variants)\n  - Spacing scale: xs(4), sm(8), md(12), lg(16), xl(24), xxl(32)\n  - Shadows presets: small, medium, large\n- Feed screen (index.tsx) updated to use theme colors:\n  - Import PRIMARY_COLOR, Colors, SemanticColors, Shadows from theme\n  - Modal, header, type options now use colors.background/border/backgroundSecondary\n  - Caption input uses colors.inputBorder, colors.placeholder, colors.text\n  - EntryCard uses colors.backgroundSecondary\n  - OnThisDayCard uses SemanticColors.goldLight, colors.backgroundTertiary\n  - FAB uses Shadows.large instead of inline shadow styles\n- Removed hardcoded colors: #fff, #ccc, #ddd, #999, rgba(128,128,128,0.1), etc.\n\n**Files changed:**\n- constants/theme.ts - Extended with PRIMARY_COLOR, textSecondary/muted, backgroundSecondary/tertiary, border colors, SemanticColors, Spacing, Shadows\n- app/(tabs)/index.tsx - Updated to use theme imports and theme-aware styles\n\n**Verification:** tsc, lint, test (157 passed), build all pass.\n\n**Next:** Continue UI polish for other screens (milestones, search, settings, entry detail)\n\n## 2026-01-15: UI Polish - Milestones Screen Theme Integration\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish)\n\n**Task:** Apply theme system to milestones.tsx screen\n\n**Decisions:**\n- Added useColorScheme hook + Colors/SemanticColors/Shadows/Spacing imports\n- Dynamic colors via colors = Colors[colorScheme] pattern\n- Milestone cards: dynamic card/cardBorder colors, Shadows.small\n- Completed badge: SemanticColors.success for green\n- Modal overlays: colors.overlay, colors.background, colors.border\n- Template items: colors.backgroundSecondary\n- Form inputs: colors.inputBorder, colors.placeholder, colors.text\n- Section titles, descriptions: colors.textSecondary, colors.textMuted\n- Delete button: SemanticColors.error for red\n- FAB: Shadows.large instead of inline shadow\n- Replaced hardcoded padding/margin with Spacing constants\n- submitButtonDisabled: opacity: 0.5 instead of hardcoded #ccc\n\n**Files changed:**\n- app/(tabs)/milestones.tsx - Full theme integration with dynamic colors and Spacing\n\n**Verification:** tsc, lint, test (157 passed), build all pass.\n\n**Next:** Continue UI polish for search.tsx, settings.tsx, entry detail screens\n\n## 2026-01-15: UI Polish - Search Screen Theme Integration\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish)\n\n**Task:** Apply theme system to search.tsx screen\n\n**Decisions:**\n- Added useColorScheme hook + Colors/Spacing/Shadows imports from theme\n- Removed local PRIMARY_COLOR definition, use imported constant\n- Dynamic colors via colors = Colors[colorScheme] pattern\n- FilterChip: dynamic backgroundColor (backgroundTertiary), textSecondary color\n- SearchResultCard: dynamic backgroundSecondary, Shadows.small for elevation\n- Video/text placeholders: dynamic backgroundTertiary\n- Search input: colors.background, colors.text, colors.inputBorder, colors.placeholder\n- Result date: colors.textSecondary instead of opacity hack\n- Empty state text: colors.textMuted\n- Replaced hardcoded padding/margin with Spacing constants\n\n**Files changed:**\n- app/(tabs)/search.tsx - Full theme integration with dynamic colors and Spacing\n\n**Verification:** tsc, lint, test (157 passed), build all pass.\n\n**Next:** Continue UI polish for settings.tsx, entry detail screens\n\n## 2026-01-15: UI Polish - Settings Screen Theme Integration\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish)\n\n**Task:** Apply theme system to settings.tsx screen\n\n**Decisions:**\n- Added useColorScheme hook + Colors/SemanticColors imports from theme\n- Removed local PRIMARY_COLOR definition, use imported constant\n- Dynamic colors via colors = Colors[colorScheme] pattern\n- All sections: dynamic card/backgroundSecondary for light/dark mode\n- Notification toggles: colors.border for track off color\n- Setting rows: dynamic text/textSecondary colors\n- Permission banners: SemanticColors.warningLight/warningText\n- Family members: dynamic border/text colors, SemanticColors.error for remove\n- Storage progress bar: SemanticColors.error/warning for threshold colors\n- Account section: SemanticColors.error for sign out and delete buttons\n- All modals: dynamic backgroundSecondary/card/border colors\n- Form inputs: dynamic backgroundColor/color/borderColor/placeholderTextColor\n- Subscription modal: dynamic billing toggle, plan cards with theme colors\n- Edit child modal: dynamic photo placeholder, form inputs, culture options\n\n**Files changed:**\n- app/(tabs)/settings.tsx - Full theme integration with dynamic colors\n\n**Verification:** tsc, lint, test (157 passed), build all pass.\n\n**Next:** Continue UI polish for entry detail screens\n\n## 2026-01-15: UI Polish - Entry Detail Screen Theme Integration\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish)\n\n**Task:** Apply theme system to entry detail screen (entry/[id].tsx)\n\n**Decisions:**\n- Added ViewerColors to theme.ts for full-screen media viewer context\n- ViewerColors intentionally dark (black bg for media viewing) - not light/dark mode dependent\n- ViewerColors includes: background, overlay, overlayStrong, text, textMuted, textSubtle, textPlaceholder, modalBackground, modalBorder, inputBackground, buttonBackground\n- Entry detail uses ViewerColors, PRIMARY_COLOR, SemanticColors, Spacing from theme\n- All hardcoded colors replaced: #000, #fff, rgba values, #1c1c1e, #ff453a\n- Modals (options, delete confirm, edit): ViewerColors.modalBackground/modalBorder\n- Delete button: SemanticColors.error\n- Edit modal: PRIMARY_COLOR for cancel/save buttons, ViewerColors for inputs\n- Spacing constants for padding/margins throughout\n\n**Files changed:**\n- constants/theme.ts - Added ViewerColors export for full-screen viewer context\n- app/entry/[id].tsx - Full theme integration with ViewerColors and Spacing\n\n**Verification:** tsc, lint, test (157 passed), build all pass.\n\n**Next:** UI polish for onboarding screens or photo book screen\n\n## 2026-01-15: UI Polish - Onboarding Screens Theme Integration\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish)\n\n**Task:** Apply theme system to all 5 onboarding screens\n\n**Decisions:**\n- All screens now use useColorScheme hook + Colors/Spacing imports from theme\n- Removed local PRIMARY_COLOR definitions, use imported constant\n- Dynamic colors via colors = Colors[colorScheme] pattern for light/dark support\n- add-child.tsx: inputs use colors.background/inputBorder/text/placeholder, photo placeholder uses backgroundSecondary, errors use SemanticColors.error\n- select-culture.tsx: option cards use colors.border/background, descriptions use colors.textSecondary\n- set-prompt-time.tsx: info box uses colors.backgroundSecondary, info text uses colors.textSecondary\n- invite-family.tsx: inputs/permission options use dynamic colors, info box themed\n- first-entry.tsx: uses Spacing constants, buttonDisabled uses opacity:0.5\n- All hardcoded colors replaced: #ccc, #999, #fff, #000, rgba(128,128,128,0.1), #dc2626, #f5f5f5, #666\n- Spacing constants replace hardcoded padding/margin values throughout\n\n**Files changed:**\n- app/(onboarding)/add-child.tsx - Full theme integration\n- app/(onboarding)/select-culture.tsx - Full theme integration\n- app/(onboarding)/set-prompt-time.tsx - Full theme integration\n- app/(onboarding)/invite-family.tsx - Full theme integration\n- app/(onboarding)/first-entry.tsx - Full theme integration\n\n**Verification:** tsc, lint, test (157 passed), build all pass.\n\n**Next:** UI polish for photo book screen or sign-in screen\n\n## 2026-01-15: UI Polish - Sign-in and Photo Book Screen Theme Integration\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish)\n\n**Task:** Apply theme system to sign-in and photo-book screens\n\n**Decisions:**\n- sign-in.tsx: Removed local PRIMARY_COLOR, use imported constant from theme\n- sign-in.tsx: Added useColorScheme hook for dynamic colors\n- sign-in.tsx: Subtitle uses colors.textSecondary, hint uses colors.textMuted\n- sign-in.tsx: Replaced opacity hacks with semantic color tokens\n- sign-in.tsx: Used Spacing constants for padding/margins\n- photo-book.tsx: Added useColorScheme hook + Colors/SemanticColors/Shadows/Spacing imports\n- photo-book.tsx: PageCard component now accepts colors prop for dynamic theming\n- photo-book.tsx: All containers/modals use dynamic colors.background/backgroundSecondary\n- photo-book.tsx: PageCard uses Shadows.medium instead of inline shadow styles\n- photo-book.tsx: Milestone badge uses SemanticColors.gold, remove button uses SemanticColors.error\n- photo-book.tsx: Export button disabled state uses opacity:0.5 instead of hardcoded #ccc\n- photo-book.tsx: All inputs use colors.inputBorder/placeholder/text\n- photo-book.tsx: Replaced all hardcoded padding/margin with Spacing constants\n\n**Files changed:**\n- app/(auth)/sign-in.tsx - Full theme integration\n- app/photo-book.tsx - Full theme integration with dynamic colors and Spacing\n\n**Verification:** tsc, lint, test (157 passed), build all pass.\n\n**Next:** All UI screens themed. Remaining items: actual Stripe SDK integration, PDF generation, or backend API integration.\n\n## 2026-01-15: EXIF Date Extraction for Photo Entries\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 3.4 (EXIF Date Detection)\n\n**Task:** Implement EXIF date extraction to auto-fill entry date from photo metadata\n\n**Decisions:**\n- Created utils/exif-date.ts with extractDateFromExif() function\n- ExifData type supports DateTimeOriginal, DateTimeDigitized, DateTime fields\n- Priority order: DateTimeOriginal > DateTimeDigitized > DateTime (per EXIF spec)\n- Handles both EXIF format \"YYYY:MM:DD HH:mm:ss\" and ISO format\n- Returns null for invalid/missing dates (graceful fallback to today)\n- Added exif: true option to ImagePicker.launchImageLibraryAsync for photos\n- Entry creation now extracts date from first selected photo's EXIF\n- Added date picker row to caption step so user can override date\n- Date picker limits maximumDate to today (no future dates)\n- TDD approach: 10 unit tests for EXIF parsing\n\n**Files changed:**\n- utils/exif-date.ts - New: extractDateFromExif function, ExifData type\n- app/(tabs)/index.tsx - Added EXIF extraction, entryDate state, date picker UI\n- __tests__/utils/exif-date.test.ts - New: 10 TDD tests for EXIF date parsing\n\n**Verification:** tsc, lint, test (167 passed), build all pass.\n\n**Next:** Backend API integration, Stripe SDK, or PDF generation\n\n## 2026-01-15: Draft Auto-Save Feature\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 3.5 (Draft Auto-Save)\n\n**Task:** Implement draft auto-save for incomplete entry creation\n\n**Decisions:**\n- Created useDraft hook using @react-native-async-storage/async-storage for persistence\n- Draft type: type, mediaUris, mediaSizes, caption, date, savedAt timestamp\n- Single draft per user stored at key \"@littlejourney:draft\"\n- Auto-saves when modal open AND type selected (prevents saving empty drafts)\n- Resume prompt shown on app open when draft exists (Alert with Resume/Discard)\n- Draft cleared on successful entry post\n- Used useRef to prevent multiple prompts during same session\n- TDD approach: 8 tests for hook + 3 integration tests for Feed\n\n**Files changed:**\n- hooks/use-draft.ts - New: useDraft hook with save/load/clear, Draft type\n- app/(tabs)/index.tsx - Integrated useDraft, auto-save effect, resume prompt effect\n- __tests__/hooks/use-draft.test.ts - New: 8 TDD tests for hook\n- __tests__/app/tabs/feed.test.tsx - Added 3 integration tests for draft feature\n- package.json - Added @react-native-async-storage/async-storage dependency\n\n**Verification:** tsc, lint, test (178 passed), build all pass.\n\n**Next:** Backend API integration, Stripe SDK, or PDF generation\n\n## 2026-01-15: Entry Tags Feature\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 3.1 (Custom tags optional), Section 3.2 step 6 (Add tags)\n\n**Task:** Implement tag input UI for entry creation per PRD\n\n**Decisions:**\n- Tags stored as string[] in Entry (already supported by context)\n- Tag input appears between date picker and Post button in caption step\n- Tags displayed as removable chips with √ó button\n- Tag input field: type tag and press Enter to add\n- Tags auto-lowercase, duplicates prevented\n- Tags included in draft auto-save (added tags field to Draft interface)\n- Tags restored when resuming draft\n- TDD approach: 3 tests for tag CRUD in entry context\n\n**Files changed:**\n- hooks/use-draft.ts - Added tags?: string[] field to Draft interface\n- app/(tabs)/index.tsx - Added tags/tagInput state, tag input UI, updated draft save/resume, updated handleSubmit\n- __tests__/app/tabs/feed.test.tsx - Added 3 TDD tests for entry tags\n\n**Verification:** tsc, lint, test (181 passed), build all pass.\n\n**Next:** Backend API integration, Stripe SDK, or PDF generation\n\n## 2026-01-15: Photo Book PDF Export\n\n**PRD ref:** Phase 1 Weeks 12-13, Section 10.3 (Export - PDF download)\n\n**Task:** Implement actual PDF generation for photo book export (was placeholder)\n\n**Decisions:**\n- Installed expo-print for HTML-to-PDF conversion\n- Generated HTML includes: title page, milestone pages, photo pages\n- Each page styled with CSS: title with gradient, photos with shadows, milestone badges\n- escapeHtml() prevents XSS in user content (captions, titles)\n- formatDate() displays dates in Singapore locale (en-SG)\n- PDF shared via expo-sharing with mimeType: application/pdf\n- Premium check (canExportPdf) enforced before generation\n- Empty pages check added (no export if pages.length === 0)\n- TDD approach: 5 tests for PDF export flow\n\n**Files changed:**\n- contexts/photo-book-context.tsx - Added expo-print/sharing imports, generatePhotoBookHtml helper, updated exportPdf with actual implementation\n- __tests__/contexts/photo-book-context.test.tsx - Added 5 TDD tests for PDF export\n- package.json - Added expo-print dependency\n\n**Verification:** tsc, lint, test (186 passed), build all pass.\n\n**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)\n\n## 2026-01-15: Smart Notification Frequency\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 7.3 (Smart Frequency)\n\n**Task:** Implement smart notification frequency that adapts based on user engagement\n\n**Decisions:**\n- PromptFrequency type: \"daily\" | \"every_2_days\" | \"weekly\"\n- Default frequency is \"daily\" per PRD\n- Tracks consecutiveIgnoredDays counter\n- recordIgnoredPrompt(): increments counter, updates frequency\n- recordEntryPosted(): resets counter to 0, frequency to \"daily\"\n- Frequency thresholds per PRD: 3+ days ‚Üí every_2_days, 7+ days ‚Üí weekly\n- getScheduleInterval(): returns 1 (daily), 2 (every_2_days), or 7 (weekly)\n- Helper functions calculateFrequency() and getIntervalFromFrequency()\n- TDD approach: 5 new tests for smart frequency logic\n\n**Files changed:**\n- contexts/notification-context.tsx - Added PromptFrequency type, state, methods\n- __tests__/contexts/notification-context.test.tsx - Added 5 TDD tests for smart frequency\n\n**Verification:** tsc, lint, test (191 passed), build all pass.\n\n**Next:** Integrate smart frequency with notification scheduling, Backend API, Stripe SDK, or Web Viewer (Phase 2)\n\n## 2026-01-15: Smart Notification Frequency Integration\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 7.3 (Smart Frequency)\n\n**Task:** Integrate smart frequency with notification scheduling and entry creation\n\n**Decisions:**\n- scheduleDailyPrompt now uses promptFrequency to determine interval\n- DAILY trigger used when frequency=daily (interval=1)\n- TIME_INTERVAL trigger with repeats:true for every_2_days (2 days) and weekly (7 days)\n- TIME_INTERVAL doesn't support specific time of day - fires at interval after scheduling\n- recordEntryPosted() called in Feed handleSubmit after entry added\n- Resets frequency to daily when user posts entry (per PRD: \"Resets to daily after user posts\")\n\n**Files changed:**\n- contexts/notification-context.tsx - Updated scheduleDailyPrompt to use frequency interval, added promptFrequency dependency\n- app/(tabs)/index.tsx - Added useNotifications import, call recordEntryPosted in handleSubmit\n- __tests__/contexts/notification-context.test.tsx - Added test for interval-based scheduling, updated mock with TIME_INTERVAL\n- __tests__/app/tabs/feed.test.tsx - Added mocks for expo-notifications/device, test for smart frequency integration\n\n**Verification:** tsc, lint, test (193 passed), build all pass.\n\n**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)\n\n## 2026-01-15: On This Day Memories Push Notification\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 4.5 (On This Day - Push notification when memories exist)\n\n**Task:** Implement push notification for \"On This Day\" memories per PRD requirement\n\n**Decisions:**\n- Added sendMemoriesNotification(count) method to NotificationContext\n- Sends immediate notification (trigger: null) when memories exist\n- Respects settings.memories toggle - no notification if disabled\n- Uses singular/plural forms: \"1 memory from previous year\" vs \"N memories from previous years\"\n- Notification data type: \"memories\" for future tap handling\n- Feed screen sends notification once per session using hasSentMemoriesNotification ref\n- Notification sent when onThisDayMemories.length > 0 and setting enabled\n- TDD approach: 5 new tests for notification sending logic\n\n**Files changed:**\n- contexts/notification-context.tsx - Added sendMemoriesNotification method to interface and implementation\n- app/(tabs)/index.tsx - Added effect to send memories notification on Feed mount\n- __tests__/contexts/notification-context.test.tsx - Added 5 TDD tests for memories notification\n\n**Verification:** tsc, lint, test (198 passed), build all pass.\n\n**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)\n\n## 2026-01-15: Milestone Reminder Push Notifications\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 7.1 (Notification Types - Milestone Reminder)\n\n**Task:** Implement milestone reminder push notifications that fire X days before milestone date\n\n**Decisions:**\n- Added scheduleMilestoneReminder(milestoneId, title, milestoneDate, daysBefore) to NotificationContext\n- Uses TIME_INTERVAL trigger with calculated seconds until reminder date\n- Notification identifier: \"milestone-reminder-{milestoneId}\" for targeted cancellation\n- cancelMilestoneReminder(milestoneId) cancels specific milestone notification\n- Respects settings.milestoneReminder toggle - skips if disabled\n- Does not schedule if trigger date (milestoneDate - daysBefore) is in past\n- Message: \"üéâ {title} is coming up!\" + \"{N} day(s) until this special milestone\"\n- Notification data includes type: \"milestone_reminder\" and milestoneId for tap handling\n- TDD approach: 5 new tests for milestone reminder logic\n\n**Files changed:**\n- contexts/notification-context.tsx - Added scheduleMilestoneReminder, cancelMilestoneReminder methods\n- __tests__/contexts/notification-context.test.tsx - Added 5 TDD tests, added cancelScheduledNotificationAsync mock\n\n**Verification:** tsc, lint, test (203 passed), build all pass.\n\n**Next:** Integrate milestone reminder with MilestoneContext addMilestone, Backend API, or Web Viewer (Phase 2)\n\n## 2026-01-15: Milestone Reminder Notification Integration\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 7.1 (Milestone Reminder integration with MilestoneContext)\n\n**Task:** Integrate milestone reminder scheduling with milestone add/complete/delete in milestones.tsx\n\n**Decisions:**\n- Integration happens at UI level (milestones.tsx) where both contexts are available\n- MilestoneContext.addMilestone now returns the created Milestone (was void)\n- handleAddFromTemplate: calls scheduleMilestoneReminder after addMilestone\n- handleAddCustom: calls scheduleMilestoneReminder with custom title after addMilestone\n- handleCompleteMilestone: calls cancelMilestoneReminder when milestone completed\n- handleDeleteMilestone: calls cancelMilestoneReminder when milestone deleted\n- Default REMINDER_DAYS_BEFORE = 7 (reminder 7 days before milestone)\n- Handlers now async to await notification scheduling\n\n**Files changed:**\n- contexts/milestone-context.tsx - addMilestone now returns Milestone instead of void\n- app/(tabs)/milestones.tsx - Added useNotifications, integrated schedule/cancel reminders in handlers\n- __tests__/app/tabs/milestones.test.tsx - Added 4 TDD tests for reminder integration, added notification mocks\n\n**Verification:** tsc, lint, test (207 passed), build all pass.\n\n**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)\n\n## 2026-01-15: Storage Warning Push Notifications\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 7.1 (Notification Types - Storage Warning at 80%, 90%, 100%)\n\n**Task:** Implement storage warning push notifications that trigger when crossing storage thresholds\n\n**Decisions:**\n- Added sendStorageWarningNotification(usagePercent) to NotificationContext\n- Thresholds: 80% (warning), 90% (critical), 100% (full) per PRD Section 7.1\n- Storage warning is \"locked on\" per PRD - ignores storageWarning setting (always sends)\n- Different messages for each threshold: 80%/90% = filling up, 100% = full + upgrade prompt\n- Notification data type: \"storage_warning\" with threshold for tap handling\n- Integration in Feed handleSubmit: calculates before/after percentages, sends notification on threshold crossing\n- Only first threshold crossed triggers notification (prevents multiple for single upload)\n- TDD approach: 6 context tests + 3 integration tests\n\n**Files changed:**\n- contexts/notification-context.tsx - Added sendStorageWarningNotification method\n- app/(tabs)/index.tsx - Added threshold crossing detection in handleSubmit after addUsage\n- __tests__/contexts/notification-context.test.tsx - Added 6 TDD tests for storage warning\n- __tests__/app/tabs/feed.test.tsx - Added 3 integration tests for storage warning notifications\n\n**Verification:** tsc, lint, test (216 passed), build all pass.\n\n**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)\n\n## 2026-01-15: Photo Book PDF Export Integration\n\n**PRD ref:** Phase 1 Weeks 12-13, Section 10.3 (Export - PDF download)\n\n**Task:** Connect photo-book.tsx export button to context's exportPdf method (was TODO placeholder)\n\n**Decisions:**\n- Photo-book context already had full exportPdf implementation (expo-print + expo-sharing)\n- photo-book.tsx screen was not using context's exportPdf - had TODO placeholder showing \"Coming Soon\"\n- Added exportPdf to usePhotoBook destructure\n- Updated handleExport to call context's exportPdf() instead of showing placeholder alert\n- TDD approach: wrote screen tests first to verify integration\n\n**Files changed:**\n- app/photo-book.tsx - Added exportPdf to destructure, updated handleExport to call it\n- __tests__/app/photo-book.test.tsx - New: 4 TDD tests for photo-book screen\n\n**Verification:** tsc, lint, test (220 passed), build all pass.\n\n**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)\n\n## 2026-01-15: TanStack Query Foundation + API Client Abstraction\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state), API Layer preparation\n\n**Task:** Set up TanStack Query infrastructure and API client abstraction layer\n\n**Decisions:**\n- Installed @tanstack/react-query for server state management per PRD tech stack\n- Created QueryProvider wrapping entire app with configured QueryClient\n- QueryClient defaults: 5min staleTime, 30min gcTime, 1 retry, refetchOnWindowFocus disabled (mobile)\n- Created services/api-client.ts with typed API abstractions for all domain entities\n- API client supports mock mode (default) and real backend mode via EXPO_PUBLIC_USE_MOCK_API env\n- Mock implementations use in-memory storage with simulated network delay\n- Four API modules: entryApi, childApi, familyApi, milestoneApi\n- Generic ApiResult<T> union type for typed success/error handling\n- PaginatedResponse<T> with cursor-based pagination support\n- isApiError() type guard for result discrimination\n- clearAllMockData() helper for test isolation\n- TDD approach: 4 provider tests + 17 API client tests\n\n**Files changed:**\n- package.json - Added @tanstack/react-query dependency\n- providers/query-provider.tsx - New: QueryProvider with configured QueryClient\n- services/api-client.ts - New: Typed API client with mock/real implementations\n- app/_layout.tsx - Added QueryProvider wrapper (outermost provider)\n- __tests__/providers/query-provider.test.tsx - New: 4 TDD tests\n- __tests__/services/api-client.test.ts - New: 17 TDD tests for all API operations\n\n**Verification:** tsc, lint, test (241 passed), build all pass.\n\n**Next:** Migrate contexts to use TanStack Query hooks, actual Stripe SDK integration, or Cloudflare Workers backend\n\n## 2026-01-15: TanStack Query Hooks for Entries\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Create TanStack Query hooks to wrap entryApi, first step in migrating from context-based state\n\n**Decisions:**\n- Created use-entries.ts with 5 hooks: useEntries, useEntry, useCreateEntry, useUpdateEntry, useDeleteEntry\n- entryKeys factory for consistent cache key management (all, lists, list, details, detail)\n- useEntries supports GetEntriesParams for pagination\n- useEntry has enabled: !!id to skip fetch when ID undefined\n- Mutations invalidate relevant queries for automatic cache sync\n- useUpdateEntry also sets detail cache directly for instant UI update\n- useDeleteEntry removes detail from cache on success\n- TDD approach: 7 tests covering all hooks\n\n**Files changed:**\n- hooks/use-entries.ts - New: TanStack Query hooks for entry CRUD operations\n- __tests__/hooks/use-entries.test.ts - New: 7 TDD tests for all entry hooks\n\n**Verification:** tsc, lint, test (248 passed), build all pass.\n\n**Next:** Create similar hooks for child/family/milestone APIs, or integrate hooks with Feed screen to replace EntryContext usage\n\n## 2026-01-15: TanStack Query Hooks for Child, Family, Milestone APIs\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Complete TanStack Query hook layer for remaining domain entities\n\n**Decisions:**\n- Created use-children.ts with 3 hooks: useChildren, useCreateChild, useUpdateChild\n- Created use-family.ts with 3 hooks: useFamilyMembers, useInviteFamilyMember, useRemoveFamilyMember\n- Created use-milestones.ts with 4 hooks: useMilestones, useCreateMilestone, useCompleteMilestone, useDeleteMilestone\n- Same pattern as use-entries.ts: queryKeys factory, cache invalidation on mutations\n- useMilestones doesn't need pagination (milestones per child are limited)\n- useUpdateChild handles optional ID field from API (id?: string)\n- useCompleteMilestone updates detail cache + invalidates list for instant UI\n- TDD approach: 14 tests total (3 child + 3 family + 8 milestone)\n\n**Files changed:**\n- hooks/use-children.ts - New: TanStack Query hooks for child CRUD\n- hooks/use-family.ts - New: TanStack Query hooks for family invites/removal\n- hooks/use-milestones.ts - New: TanStack Query hooks for milestone CRUD\n- __tests__/hooks/use-children.test.ts - New: 3 TDD tests\n- __tests__/hooks/use-family.test.ts - New: 3 TDD tests\n- __tests__/hooks/use-milestones.test.ts - New: 8 TDD tests\n\n**Verification:** tsc, lint, test (262 passed), build all pass.\n\n**Next:** Integrate hooks with screens to replace context usage, or Cloudflare Workers backend setup\n\n## 2026-01-15: Camera Capture for Entry Creation\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 3.2 step 3 (Select from gallery or capture new), Section 3.3 (Secondary: Camera capture)\n\n**Task:** Add camera capture option as secondary source for photo/video entries\n\n**Decisions:**\n- Added \"source\" step between type selection and caption in creation flow\n- MediaSource type: \"gallery\" | \"camera\" for source selection\n- Source step shows two options: Gallery (primary per PRD) and Camera (secondary)\n- Uses ImagePicker.launchCameraAsync for camera capture\n- Uses ImagePicker.requestCameraPermissionsAsync for camera permission\n- Refactored handleTypeSelect to set step to \"source\" for photo/video (text skips to caption)\n- Created separate handlers: handleSourceSelect, handleVideoSource, handlePhotoSource\n- Created reusable asset processors: processVideoAsset, processPhotoAssets\n- Camera capture also supports EXIF extraction for photos\n- TDD approach: 3 tests for camera mock setup\n\n**Files changed:**\n- app/(tabs)/index.tsx - Added source selection step, refactored media flow handlers, added sourceOptions styles\n- __tests__/app/tabs/feed.test.tsx - Added 3 camera tests, added expo-image-picker mock with camera support\n\n**Verification:** tsc, lint, test (265 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, or additional UI polish\n\n## 2026-01-15: TanStack Query useEntriesFlat Hook\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Add useEntriesFlat hook to enable Feed screen migration from EntryContext\n\n**Decisions:**\n- Created useEntriesFlat hook that wraps useEntries with convenience features\n- Flattens paginated API response to simple Entry[] array\n- Includes getOnThisDayEntries() computed from entries (same logic as EntryContext)\n- Returns loading/error/success states + refetch capability\n- Maintains same API shape as EntryContext for easy migration\n- TDD approach: 3 new tests for flat hook (total 10 use-entries tests)\n\n**Files changed:**\n- hooks/use-entries.ts - Added useEntriesFlat hook with entries array + getOnThisDayEntries\n- __tests__/hooks/use-entries.test.ts - Added 3 TDD tests for useEntriesFlat\n\n**Verification:** tsc, lint, test (268 passed), build all pass.\n\n**Next:** Integrate useEntriesFlat + useCreateEntry with Feed screen to replace EntryContext usage\n\n## 2026-01-15: Feed Screen TanStack Query Migration\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Migrate Feed screen from EntryContext to TanStack Query hooks\n\n**Decisions:**\n- Replaced useEntries (context) with useEntriesFlat + useCreateEntry (TanStack Query hooks)\n- useEntriesFlat provides: entries array, getOnThisDayEntries(), refetch, isFetching\n- useCreateEntry.mutate() replaces addEntry() with onSuccess callback for side effects\n- Removed local refreshing state - now uses isFetching from TanStack Query\n- Pull-to-refresh now calls refetch() which invalidates and refetches from API\n- Storage tracking, notification frequency reset, draft clear moved to onSuccess callback\n- EntryContext still exists for type exports (Entry, EntryType, NewEntry)\n\n**Files changed:**\n- app/(tabs)/index.tsx - Replaced context with TanStack Query hooks, updated handlers\n- __tests__/app/tabs/feed.test.tsx - Added 3 TDD integration tests for TanStack Query\n\n**Verification:** tsc, lint, test (271 passed), build all pass.\n\n**Next:** Continue backend API integration, remaining screens migration, or Cloudflare Workers setup\n\n## 2026-01-15: Milestones Screen TanStack Query Migration\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Migrate Milestones screen from MilestoneContext to TanStack Query hooks\n\n**Decisions:**\n- Created useMilestonesFlat hook similar to useEntriesFlat for easier consumption\n- useMilestonesFlat provides: milestones, upcomingMilestones, completedMilestones, refetch, loading states\n- Replaced useMilestones (context) with useMilestonesFlat + useCreateMilestone + useCompleteMilestone + useDeleteMilestone\n- Mutation handlers use onSuccess callbacks for notification scheduling/cancellation (PRD 7.1)\n- Updated test wrapper from MilestoneProvider to QueryClientProvider\n- Tests use milestoneApi.createMilestone() directly instead of WithMilestone helper component\n- MilestoneContext still exists for type exports (Milestone, MilestoneTemplate, MILESTONE_TEMPLATES)\n\n**Files changed:**\n- hooks/use-milestones.ts - Added useMilestonesFlat hook\n- app/(tabs)/milestones.tsx - Replaced context with TanStack Query hooks, updated handlers\n- __tests__/hooks/use-milestones.test.ts - Added 3 TDD tests for useMilestonesFlat\n- __tests__/app/tabs/milestones.test.tsx - Updated to use QueryClientProvider, use addTestMilestone helper\n\n**Verification:** tsc, lint, test (274 passed), build all pass.\n\n**Next:** Continue remaining screens migration (Search, Settings) or Cloudflare Workers backend setup\n\n## 2026-01-15: Search Screen TanStack Query Migration\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Migrate Search screen from EntryContext to TanStack Query hooks\n\n**Decisions:**\n- Replaced useEntries (context) with useEntriesFlat (TanStack Query hook)\n- useEntriesFlat provides entries array for client-side filtering\n- Search filtering logic unchanged (caption + tags text search)\n- Type filter logic unchanged (all/photo/video/text)\n- Tests updated from EntryProvider to QueryClientProvider wrapper\n- Tests use entryApi.createEntry() directly for setup instead of context helper\n- Added 2 new tests: loading state, tag search\n\n**Files changed:**\n- app/(tabs)/search.tsx - Replaced context with useEntriesFlat hook\n- __tests__/app/tabs/search.test.tsx - Updated to use QueryClientProvider, added 2 tests\n\n**Verification:** tsc, lint, test (276 passed), build all pass.\n\n**Next:** Settings screen TanStack Query migration (family, child hooks) or Cloudflare Workers backend setup\n\n## 2026-01-15: Settings Screen TanStack Query Migration\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Migrate Settings screen from context-based state to TanStack Query hooks\n\n**Decisions:**\n- Created useChildFlat hook wrapping useChildren + useUpdateChild with convenience features\n- useChildFlat returns first child (MVP single-child support) or null if none exists\n- Created useFamilyMembersFlat hook wrapping useFamilyMembers + mutations\n- useFamilyMembersFlat returns familyMembers array with inviteFamilyMember/removeFamilyMember helpers\n- Settings screen now uses useChildFlat and useFamilyMembersFlat from hooks instead of contexts\n- ChildContext and FamilyContext still exist for type exports (backward compatibility)\n- Tests updated to use QueryClientProvider wrapper and childApi.createChild for setup\n- TDD approach: 6 new tests for flat hooks + 2 new tests for settings\n\n**Files changed:**\n- hooks/use-children.ts - Added useChildFlat hook\n- hooks/use-family.ts - Added useFamilyMembersFlat hook\n- app/(tabs)/settings.tsx - Replaced context imports with TanStack Query hooks\n- __tests__/hooks/use-children.test.ts - Added 3 tests for useChildFlat\n- __tests__/hooks/use-family.test.ts - Added 3 tests for useFamilyMembersFlat\n- __tests__/app/tabs/settings.test.tsx - Updated to QueryClientProvider, use API for test data\n\n**Verification:** tsc, lint, test (284 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup or additional screens migration (onboarding screens)\n\n## 2026-01-15: Onboarding Screens TanStack Query Migration\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Migrate onboarding screens from context-based state to TanStack Query hooks\n\n**Decisions:**\n- add-child.tsx: replaced useChild().setChild with useCreateChild mutation\n- select-culture.tsx: replaced useChild().updateChild with useChildFlat + useUpdateChild mutation\n- invite-family.tsx: replaced useFamily().inviteFamilyMember with useInviteFamilyMember mutation\n- All mutations use onSuccess callback for navigation after successful API call\n- Tests updated to use QueryClientProvider wrapper and callback-style router mocks\n- Type exports still come from contexts (backward compatibility)\n\n**Files changed:**\n- app/(onboarding)/add-child.tsx - useCreateChild mutation replaces context setChild\n- app/(onboarding)/select-culture.tsx - useChildFlat + useUpdateChild replaces context updateChild\n- app/(onboarding)/invite-family.tsx - useInviteFamilyMember replaces context inviteFamilyMember\n- __tests__/app/onboarding/add-child.test.tsx - Updated with QueryClientProvider, 3 new TanStack Query tests\n\n**Verification:** tsc, lint, test (287 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup or Stripe SDK integration\n\n## 2026-01-15: Milestones Screen TanStack Query Child Hook Fix\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Fix milestones.tsx to use useChildFlat hook from TanStack Query instead of useChild context, and use actual child.id instead of hardcoded \"child-1\"\n\n**Decisions:**\n- Replaced useChild (context) import with useChildFlat (TanStack Query hook)\n- Changed child guard from `if (!child)` to `if (!child?.id)` for API requirement\n- Removed hardcoded \"child-1\" values, now uses child.id from API response\n- Updated test wrapper to remove ChildProvider, use QueryClientProvider only\n- Tests now create child via childApi.createChild before rendering\n- Test helper createTestChild returns `{ id: string }` for guaranteed ID type\n- Tests wait for cultural templates (e.g., \"Full Month\" for Chinese) to confirm child loaded\n\n**Files changed:**\n- app/(tabs)/milestones.tsx - useChildFlat replaces useChild, child.id replaces \"child-1\"\n- __tests__/app/tabs/milestones.test.tsx - Updated test wrapper, createTestChild helper, all tests use API child\n\n**Verification:** tsc, lint, test (288 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup or Stripe SDK integration\n\n## 2026-01-15: Entry Detail Screen TanStack Query Migration\n\n**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)\n\n**Task:** Migrate entry detail screen from EntryContext to TanStack Query hooks\n\n**Decisions:**\n- Replaced useEntries (context) with useEntry, useUpdateEntry, useDeleteEntry (TanStack Query hooks)\n- useEntry provides: data (entry), isLoading, isError states\n- Added loading state with ActivityIndicator while fetching\n- Mutations use onSuccess callbacks for navigation/modal state changes\n- useEffect syncs editCaption state with entry when entry loads\n- EntryContext no longer imported - types still available from contexts\n- Tests updated to use QueryClientProvider wrapper and entryApi for setup\n- Added 2 new TanStack Query integration tests\n\n**Files changed:**\n- app/entry/[id].tsx - Replaced context with TanStack Query hooks, added loading state\n- __tests__/app/entry/entry-detail.test.tsx - Updated to QueryClientProvider, createTestEntry helper\n\n**Verification:** tsc, lint, test (290 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup or Stripe SDK integration\n\n## 2026-01-15: Feed Infinite Scroll Implementation\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 4.1 (Infinite scroll with pagination)\n\n**Task:** Implement infinite scroll for Feed using TanStack Query's useInfiniteQuery\n\n**Decisions:**\n- Created useInfiniteEntries hook using TanStack Query's useInfiniteQuery\n- Uses cursor-based pagination from API client (cursor, hasMore fields)\n- getNextPageParam returns cursor when hasMore=true, undefined otherwise\n- Flattens all pages into single entries array via flatMap\n- Feed screen updated: useEntriesFlat -> useInfiniteEntries\n- FlatList onEndReached triggers fetchNextPage when hasNextPage && !isFetchingNextPage\n- onEndReachedThreshold=0.5 (fetch when 50% from bottom)\n- LoadingFooter component shows ActivityIndicator during page load\n- RefreshControl refreshing excludes isFetchingNextPage to avoid spinner during pagination\n- Default page limit: 20 entries per page\n\n**Files changed:**\n- hooks/use-entries.ts - Added useInfiniteEntries hook with useInfiniteQuery\n- app/(tabs)/index.tsx - Updated to useInfiniteEntries, added onEndReached/ListFooterComponent/loadingFooter styles\n- __tests__/hooks/use-entries.test.ts - Added 4 TDD tests for useInfiniteEntries\n- __tests__/app/tabs/feed.test.tsx - Added 3 TDD tests for infinite scroll integration\n\n**Verification:** tsc, lint, test (297 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n\n## 2026-01-15: Milestone Countdown Feature\n\n**PRD ref:** Phase 1 Weeks 8-9, Section 5.3 (Milestone UI - Upcoming milestones with countdown)\n\n**Task:** Add countdown display to upcoming milestone cards\n\n**Decisions:**\n- Created getCountdownText() helper function for human-readable countdown\n- Calculates days between today and milestone date\n- Output: \"Today\" (0 days), \"Tomorrow\" (1 day), \"in N days\" (N>1), \"N days ago\" (past)\n- Countdown appended after date: \"15/01/2026 ¬∑ in 10 days\"\n- Completed milestones unchanged (show \"Celebrated: date\")\n- TDD approach: 3 tests written first\n\n**Files changed:**\n- app/(tabs)/milestones.tsx - Added getCountdownText() function, updated milestone date display\n- __tests__/app/tabs/milestones.test.tsx - Added 3 TDD tests for countdown feature\n\n**Verification:** tsc, lint, test (300 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n\n## 2026-01-15: Auth Token Persistence with expo-secure-store\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 1.2 (Token Storage)\n\n**Task:** Implement expo-secure-store for auth session persistence per PRD requirement\n\n**Decisions:**\n- Installed expo-secure-store for secure token storage (PRD Section 1.2)\n- Created StoredSession interface: user, hasCompletedOnboarding, deletionScheduledAt\n- AUTH_SESSION_KEY constant for storage key consistency\n- Session restored from SecureStore on app mount (restoreSession in useEffect)\n- signIn persists session immediately after setting user state\n- signOut clears SecureStore via deleteItemAsync\n- completeOnboarding updates stored session with onboarding flag\n- requestAccountDeletion/cancelAccountDeletion also persist deletion state\n- persistSession helper centralizes storage logic\n- TDD approach: 4 new tests for storage persistence\n\n**Files changed:**\n- contexts/auth-context.tsx - Added SecureStore import, StoredSession interface, persistSession helper, updated all auth methods to persist\n- __tests__/contexts/auth-context.test.tsx - Added expo-secure-store mock, 4 new persistence tests\n- package.json - Added expo-secure-store dependency\n\n**Verification:** tsc, lint, test (304 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n\n## 2026-01-15: Magic Link Sign-in UI\n\n**PRD ref:** Phase 1 Weeks 3-4, Section 1.1 (Authentication Methods)\n\n**Task:** Implement proper sign-in screen with magic link email input and OAuth buttons\n\n**Decisions:**\n- Replaced demo button with full sign-in UI per PRD Section 1.1\n- Magic link flow: email input ‚Üí \"Send Magic Link\" button ‚Üí success screen with \"Check your email\"\n- Email validation with regex, shows error for invalid format\n- Button disabled when email empty (visual opacity 0.5)\n- OAuth buttons: \"Continue with Google\", \"Continue with Apple\" (mock implementations)\n- 2-step flow: input step shows form, sent step shows confirmation message\n- Auto-sign-in after magic link sent (demo behavior until backend ready)\n- KeyboardAvoidingView + ScrollView for proper keyboard handling\n- Terms text at bottom per legal requirements\n- Theme system integration: dynamic colors for light/dark mode\n- TDD approach: 8 tests written first\n\n**Files changed:**\n- app/(auth)/sign-in.tsx - Full sign-in UI with email input, validation, OAuth buttons\n- __tests__/app/auth/sign-in.test.tsx - New: 8 TDD tests for sign-in screen\n\n**Verification:** tsc, lint, test (312 passed), build all pass. UI verified via Chrome MCP.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n\n## 2026-01-15: EAS Build Configuration Setup\n\n**PRD ref:** Phase 1 Week 14 (Launch - App Store + Play Store submission)\n\n**Task:** Set up EAS Build configuration for development, preview, and production builds\n\n**Decisions:**\n- Created eas.json with 3 build profiles: development, preview, production\n- development: simulator builds with dev client, mock API enabled\n- preview: internal distribution for testing, mock API enabled\n- production: auto-increment version, app-bundle for Android, mock API disabled\n- Submit config uses env vars for Apple credentials (APPLE_ID, ASC_APP_ID, APPLE_TEAM_ID)\n- Android submit uses Google service account JSON file\n- app.json updated with iOS bundleIdentifier and Android package: sg.littlejourney.app\n- Added iOS infoPlist with camera/photo library usage descriptions\n- Added Android permissions for camera and media access\n- App name changed to \"Little Journey\" (display name)\n- Added runtimeVersion policy: appVersion for EAS Update compatibility\n- Added EAS Update config with placeholder projectId\n- Added EAS CLI (eas-cli) as dev dependency\n- Added npm scripts: build:dev, build:preview, build:prod, submit:ios, submit:android, update\n\n**Files changed:**\n- eas.json - New: EAS Build configuration with 3 profiles + submit config\n- app.json - Added bundleIdentifier, package, permissions, infoPlist, runtimeVersion, updates config\n- package.json - Added eas-cli dev dependency, 6 new npm scripts for EAS\n\n**Verification:** tsc, lint, test (312 passed), build all pass.\n\n**Next:** Run `eas init` to get actual projectId, Cloudflare Workers backend setup, or Stripe SDK integration\n\n## 2026-01-15: Resend Invite Link Feature\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 6.4 (Link Management - Parent can resend link)\n\n**Task:** Add \"Resend\" action for pending family member invites per PRD requirement\n\n**Decisions:**\n- Added familyApi.resendInvite() method to API client (mock updates invitedAt timestamp)\n- Added useResendInvite() hook wrapping API call with cache invalidation\n- Added resendInvite to useFamilyMembersFlat hook for component consumption\n- Settings screen now shows \"Resend\" button next to pending family members only\n- Button uses PRIMARY_COLOR for visual consistency with other actions\n- Remove button still shown for all members (pending and accepted)\n- Buttons laid out horizontally with gap between Resend and Remove\n- TDD approach: 3 tests for family member management\n\n**Files changed:**\n- services/api-client.ts - Added resendInvite() method\n- hooks/use-family.ts - Added useResendInvite hook, updated useFamilyMembersFlat\n- app/(tabs)/settings.tsx - Added Resend button for pending members, new styles\n- __tests__/app/tabs/settings.test.tsx - Added 3 TDD tests for family member UI\n\n**Verification:** tsc, lint, test (315 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n\n## 2026-01-15: Photo Book Birthday Prompt\n\n**PRD ref:** Phase 1 Weeks 12-13 (Polish), Section 10.1 (Trigger - System prompt at child's first birthday)\n\n**Task:** Implement photo book birthday prompt notification when child turns 1 year old\n\n**Decisions:**\n- Added sendPhotoBookBirthdayPrompt(childName) method to NotificationContext\n- Notification title includes child name and \"birthday\", body prompts photo book creation\n- Notification data type: \"photo_book_prompt\" for future tap handling\n- Feed screen checks child.dateOfBirth on mount, sends notification if today is first birthday\n- Uses hasSentBirthdayPrompt ref to prevent duplicate notifications per session\n- Checks both nickname and name for notification title (nickname preferred if set)\n- TDD approach: 3 context tests + 2 integration tests\n\n**Files changed:**\n- contexts/notification-context.tsx - Added sendPhotoBookBirthdayPrompt method to interface and implementation\n- app/(tabs)/index.tsx - Added birthday check effect, added hasSentBirthdayPrompt ref\n- __tests__/contexts/notification-context.test.tsx - Added 3 TDD tests for birthday prompt\n- __tests__/app/tabs/feed.test.tsx - Added 2 integration tests for birthday prompt\n\n**Verification:** tsc, lint, test (320 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n\n## 2026-01-15: Entry Attribution Display (\"Posted by\")\n\n**PRD ref:** Phase 1 Weeks 5-7, Section 4.2 (Entry Card Display - \"Posted by\" attribution), Section 3.6 (Entry Ownership)\n\n**Task:** Implement \"Posted by\" attribution display on entry cards per PRD requirement\n\n**Decisions:**\n- Added `name` optional field to User interface for display name\n- Added `createdByName` field to Entry interface (denormalized for display efficiency)\n- EntryCard shows \"Posted by [name]\" between caption and date when available\n- Feed passes user.id and user.name (or email prefix fallback) when creating entries\n- Attribution styled with textSecondary color, 12px font size\n- Date and attribution in horizontal flex row layout\n- TDD approach: 3 tests for API entry attribution\n\n**Files changed:**\n- contexts/auth-context.tsx - Added name field to User interface\n- contexts/entry-context.tsx - Added createdByName field to Entry interface\n- app/(tabs)/index.tsx - Added useAuth, passed createdBy/createdByName in createEntry, EntryCard shows attribution\n- __tests__/app/tabs/feed.test.tsx - Added 3 TDD tests for entry attribution\n\n**Verification:** tsc, lint, test (323 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n\n## 2026-01-15: Family Activity Push Notification\n\n**PRD ref:** Phase 1 Weeks 10-11, Section 7.1 (Notification Types - Family Activity on comment/reaction)\n\n**Task:** Implement family activity push notifications for comments and reactions from family members\n\n**Decisions:**\n- Added sendFamilyActivityNotification(activityType, memberName, preview?) to NotificationContext\n- activityType: \"comment\" | \"reaction\" per PRD family activity triggers\n- Comment notifications show üí¨ emoji with member name and preview (truncated to 50 chars)\n- Reaction notifications show ‚ù§Ô∏è emoji with member name\n- Respects settings.familyActivity toggle - no notification if disabled\n- Notification data type: \"family_activity\" with activityType for tap handling\n- TDD approach: 5 tests written first\n\n**Files changed:**\n- contexts/notification-context.tsx - Added sendFamilyActivityNotification method to interface and implementation\n- __tests__/contexts/notification-context.test.tsx - Added 5 TDD tests for family activity notification\n\n**Verification:** tsc, lint, test (328 passed), build all pass.\n\n**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)\n",
    "structuredPatch": [
      {
        "oldStart": 1763,
        "oldLines": 3,
        "newStart": 1763,
        "newLines": 30,
        "lines": [
          " **Verification:** tsc, lint, test (328 passed), build all pass.",
          " ",
          " **Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)",
          "+",
          "+## 2026-01-15: Upload Rate Limiting",
          "+",
          "+**PRD ref:** Phase 1 Weeks 12-13, Section 13.2 (Rate Limiting)",
          "+",
          "+**Task:** Implement client-side upload rate limiting per PRD requirement (50/hour, 200/day)",
          "+",
          "+**Decisions:**",
          "+- Created useRateLimit hook using AsyncStorage for persistence",
          "+- UploadRecord type with timestamp for tracking upload history",
          "+- HOURLY_LIMIT = 50, DAILY_LIMIT = 200 per PRD Section 13.2",
          "+- canUpload boolean computed from current counts vs limits",
          "+- rateLimitMessage returns user-friendly message when limit reached",
          "+- recordUpload() adds timestamp and auto-cleans entries >24h old",
          "+- Integrated into Feed screen: blocks photo/video at type selection step",
          "+- Records upload on successful entry creation (media uploads only)",
          "+- TDD approach: 9 hook tests + 3 integration tests",
          "+",
          "+**Files changed:**",
          "+- hooks/use-rate-limit.ts - New: useRateLimit hook with canUpload, recordUpload, rateLimitMessage",
          "+- app/(tabs)/index.tsx - Integrated rate limit check in handleTypeSelect, recordUpload in handleSubmit",
          "+- __tests__/hooks/use-rate-limit.test.ts - New: 9 TDD tests for hook",
          "+- __tests__/app/tabs/feed.test.tsx - Added 3 integration tests for rate limiting",
          "+",
          "+**Verification:** tsc, lint, test (340 passed), build all pass.",
          "+",
          "+**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)"
        ]
      }
    ],
    "userModified": false,
    "replaceAll": false
  },
  "tool_use_id": "toolu_01P4KBxaMnHVVfn8rc6g826A"
}
