# Little Journey - Development Progress

## 2026-01-14: Core Tab Navigation Setup

**PRD ref:** Phase 1 Weeks 1-2 Foundation, Section 4.1 Primary View

**Task:** Set up 4-tab navigation structure (Feed, Milestones, Search, Settings)

**Decisions:**
- Used index.tsx as Feed tab (Expo Router convention for default route)
- Removed template explore.tsx
- Icons: house.fill (Feed), star.fill (Milestones), magnifyingglass (Search), gearshape.fill (Settings)
- headerShown: true for proper screen titles

**Files changed:**
- app/(tabs)/_layout.tsx - Updated with 4 tabs
- app/(tabs)/index.tsx - Feed screen (renamed from feed.tsx)
- app/(tabs)/milestones.tsx - New placeholder
- app/(tabs)/search.tsx - New placeholder
- app/(tabs)/settings.tsx - New placeholder
- Deleted: app/(tabs)/explore.tsx

**Verification:** tsc, lint, test, build all pass

**Next:** Authentication flow or onboarding screens per PRD Phase 1 Weeks 3-4

## 2026-01-15: Auth Context and Route Protection

**PRD ref:** Phase 1 Weeks 3-4, Section 1 (Auth & Onboarding)

**Task:** Set up auth architecture - context, hooks, route protection, sign-in screen

**Decisions:**
- Created AuthProvider + useAuth hook with mock signIn/signOut (ready for backend integration)
- Used Slot-based routing with useSegments for auth gating (Expo Router pattern)
- Auth screens in (auth) route group, tabs in (tabs) group
- Sign-in screen is placeholder with demo flow - will add magic link/OAuth later
- Primary button color hardcoded (#0a7ea4) to work in light/dark mode

**Files changed:**
- contexts/auth-context.tsx - New: AuthProvider, useAuth hook, User type
- app/_layout.tsx - Wrap with AuthProvider, add RootLayoutNav for auth routing
- app/(auth)/_layout.tsx - New: Auth route group layout
- app/(auth)/sign-in.tsx - New: Sign-in placeholder screen
- __tests__/contexts/auth-context.test.tsx - New: TDD tests for auth context

**Verification:** tsc, lint, test (9 passed), build all pass. UI verified via Chrome MCP.

**Next:** Guided onboarding flow (PRD Section 1.3) or child profile creation

## 2026-01-15: Onboarding Route Group and Flow

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 (Guided Onboarding Flow)

**Task:** Set up onboarding architecture - route group, routing logic, placeholder add-child screen

**Decisions:**
- Added hasCompletedOnboarding + completeOnboarding to auth context (mock, ready for backend)
- 3-way routing in root layout: auth -> onboarding -> tabs
- Onboarding screens in (onboarding) route group with Stack navigator
- headerBackVisible: false, gestureEnabled: false to prevent back navigation during onboarding
- add-child is first onboarding step (step 2 per PRD, step 1 sign-up already done)

**Files changed:**
- contexts/auth-context.tsx - Added hasCompletedOnboarding, completeOnboarding
- app/_layout.tsx - Updated RootLayoutNav with 3-way routing logic
- app/(onboarding)/_layout.tsx - New: Onboarding route group layout
- app/(onboarding)/add-child.tsx - New: Add child placeholder screen
- app/(auth)/sign-in.tsx - Removed manual router.replace (handled by root layout)
- __tests__/contexts/auth-context.test.tsx - Added 3 tests for onboarding state

**Verification:** tsc, lint, test (12 passed), build all pass. UI verified via Chrome MCP.

**Next:** Child form fields (name, DOB, photo) or remaining onboarding steps (culture, prompt time, invite)

## 2026-01-15: Add Child Form Implementation

**PRD ref:** Phase 1 Weeks 3-4, Section 2.1 (Child Profile)

**Task:** Implement Add Child form with name, DOB, nickname fields and validation

**Decisions:**
- Created ChildContext + useChild hook for child state management (TDD approach)
- Child type: name (required), dateOfBirth (ISO string, required), nickname (optional), photoUri (optional)
- Form validation: name required, DOB required, DOB cannot be future
- Used @react-native-community/datetimepicker for native date picking
- Continue button disabled until form valid (visual feedback via gray color)
- Date displayed in Singapore locale format (en-SG)
- KeyboardAvoidingView + ScrollView for proper keyboard handling

**Files changed:**
- contexts/child-context.tsx - New: ChildProvider, useChild hook, Child type
- app/_layout.tsx - Added ChildProvider wrapper
- app/(onboarding)/add-child.tsx - Full form implementation with validation
- __tests__/contexts/child-context.test.tsx - New: 5 TDD tests for child context

**Verification:** tsc, lint, test (17 passed), build all pass. UI verified via Chrome MCP.

**Next:** Remaining onboarding steps (culture selection, prompt time, invite family) or photo picker for child

## 2026-01-15: Cultural Tradition Selection Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 3 (Select cultural tradition)

**Task:** Implement cultural tradition selection as step 3 of onboarding flow

**Decisions:**
- Added CulturalTradition type: "chinese" | "malay" | "indian" | "none"
- Added culturalTradition optional field to Child interface
- Added updateChild method to ChildContext for partial updates
- Created select-culture.tsx with radio button selection UI
- add-child now navigates to select-culture instead of completing onboarding
- select-culture completes onboarding after selection
- Culture options show milestone examples (Full Month, Aqiqah, Annaprashan, etc.)

**Files changed:**
- contexts/child-context.tsx - Added CulturalTradition type, culturalTradition field, updateChild method
- app/(onboarding)/select-culture.tsx - New: Culture selection screen with radio options
- app/(onboarding)/_layout.tsx - Added select-culture Stack.Screen
- app/(onboarding)/add-child.tsx - Navigate to select-culture instead of completeOnboarding
- __tests__/contexts/child-context.test.tsx - Added 2 tests for culturalTradition and updateChild

**Verification:** tsc, lint, test (19 passed), build all pass. UI verified via Chrome MCP.

**Next:** Daily prompt time selection (step 4) or invite family member (step 5)

## 2026-01-15: Daily Prompt Time Selection Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 4 (Set daily prompt time)

**Task:** Implement daily prompt time selection as step 4 of onboarding flow

**Decisions:**
- Created UserPreferencesContext + useUserPreferences hook for user settings (TDD approach)
- dailyPromptTime stored as 24-hour string "HH:mm" (e.g., "20:00")
- Default time: 8:00 PM SGT per PRD
- Used @react-native-community/datetimepicker with 5-minute intervals
- Platform-specific display: iOS spinner, Android default picker
- Skip option available (completes onboarding without setting time)
- Continue saves time and completes onboarding
- select-culture now navigates to set-prompt-time instead of completing onboarding

**Files changed:**
- contexts/user-preferences-context.tsx - New: UserPreferencesProvider, useUserPreferences hook
- app/_layout.tsx - Added UserPreferencesProvider wrapper
- app/(onboarding)/set-prompt-time.tsx - New: Time picker screen with skip option
- app/(onboarding)/_layout.tsx - Added set-prompt-time Stack.Screen
- app/(onboarding)/select-culture.tsx - Navigate to set-prompt-time instead of completeOnboarding
- __tests__/contexts/user-preferences-context.test.tsx - New: 5 TDD tests for user preferences

**Verification:** tsc, lint, test (24 passed), build all pass. Route protection verified via Chrome MCP.

**Next:** Invite family member (step 5) or first entry prompt (step 6)

## 2026-01-15: Invite Family Member Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 5 (Invite first family member)

**Task:** Implement invite family member as step 5 of onboarding flow

**Decisions:**
- Created FamilyContext + useFamily hook for family member management (TDD approach)
- FamilyMember type: id, email, relationship, permissionLevel, status, invitedAt
- PermissionLevel: "view_only" | "view_interact" per PRD Section 6.3
- InviteStatus: "pending" | "accepted" | "expired"
- Form validation: valid email required, relationship required
- Permission defaults to "view_interact" (most useful for grandparents)
- Skip option completes onboarding without inviting
- set-prompt-time now navigates to invite-family instead of completing onboarding

**Files changed:**
- contexts/family-context.tsx - New: FamilyProvider, useFamily hook, types
- app/_layout.tsx - Added FamilyProvider wrapper
- app/(onboarding)/invite-family.tsx - New: Invite form with email, relationship, permission
- app/(onboarding)/_layout.tsx - Added invite-family Stack.Screen
- app/(onboarding)/set-prompt-time.tsx - Navigate to invite-family instead of completeOnboarding
- __tests__/contexts/family-context.test.tsx - New: 6 TDD tests for family context

**Verification:** tsc, lint, test (30 passed), build all pass.

**Next:** First entry prompt (step 6) or core Feed features (entries, photos)

## 2026-01-15: First Entry Prompt Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 6 (First entry prompt)

**Task:** Implement first entry prompt as final onboarding step (step 6)

**Decisions:**
- Installed expo-image-picker for gallery/camera access
- Screen prompts "Add your first moment!" with camera emoji icon
- "Choose from Gallery" button requests media library permission then launches picker
- Skip option ("I'll do this later") completes onboarding without adding photo
- If user selects photo, completes onboarding (entry creation deferred to Feed feature)
- invite-family now navigates to first-entry instead of completing onboarding

**Files changed:**
- app/(onboarding)/first-entry.tsx - New: First entry prompt with image picker
- app/(onboarding)/_layout.tsx - Added first-entry Stack.Screen
- app/(onboarding)/invite-family.tsx - Navigate to first-entry, removed useAuth import
- __tests__/app/onboarding/first-entry.test.tsx - New: 5 TDD tests for first-entry screen
- package.json - Added expo-image-picker dependency

**Verification:** tsc, lint, test (35 passed), build all pass.

**Next:** Core Feed features (entry creation, photo upload) per PRD Phase 1 Weeks 5-7

## 2026-01-15: Entry Context and Feed UI

**PRD ref:** Phase 1 Weeks 5-7, Section 3 (Entry Creation), Section 4 (Timeline & Feed)

**Task:** Implement entry types, context, and feed UI with entry creation modal

**Decisions:**
- Created EntryContext + useEntries hook for entry state management (TDD approach)
- Entry type: id, type (photo/video/text), mediaUris (carousel), caption, date, tags, timestamps
- Entries stored reverse chronological (newest first) per PRD Section 4.1
- Feed shows FlatList with EntryCard components, EmptyState when no entries
- Floating action button (+) opens entry creation modal
- 2-step creation flow: type selection -> caption/media
- Photo/video picker reuses expo-image-picker from onboarding
- Multiple photo selection supported for carousel entries
- Entry card shows image, video placeholder, caption, date, carousel indicator

**Files changed:**
- contexts/entry-context.tsx - New: EntryProvider, useEntries hook, Entry/EntryType types
- app/_layout.tsx - Added EntryProvider wrapper
- app/(tabs)/index.tsx - Full feed UI with entry cards, FAB, creation modal
- __tests__/contexts/entry-context.test.tsx - New: 8 TDD tests for entry context

**Verification:** tsc, lint, test (43 passed), build all pass.

**Next:** Pull-to-refresh, entry detail view, or photo carousel swipe per PRD Section 4

## 2026-01-15: Pull-to-Refresh for Feed

**PRD ref:** Phase 1 Weeks 5-7, Section 4.1 (Primary View: Feed - Pull-to-refresh)

**Task:** Add pull-to-refresh to Feed FlatList

**Decisions:**
- Used RefreshControl component with FlatList's refreshControl prop
- Added refreshing state + onRefresh callback with useCallback
- Simulated 1s refresh delay (placeholder for TanStack Query invalidation)
- tintColor/colors set to PRIMARY_COLOR for consistent branding

**Files changed:**
- app/(tabs)/index.tsx - Added RefreshControl, refreshing state, onRefresh handler

**Verification:** tsc, lint, test (43 passed), build all pass.

**Next:** Entry detail view, photo carousel swipe, or edit/delete entries per PRD Section 4

## 2026-01-15: Photo Carousel Component

**PRD ref:** Phase 1 Weeks 5-7, Section 4.3 (Photo Carousel)

**Task:** Implement swipeable photo carousel for multi-photo entries with dot indicators

**Decisions:**
- Created PhotoCarousel component with horizontal ScrollView + pagingEnabled
- Dot indicators shown only when images.length > 1
- Active dot opacity 1, inactive 0.4 for visual feedback
- onImagePress callback for future full-screen view integration
- Configurable aspectRatio prop (default 1:1 square)
- Used onScroll with scrollEventThrottle to track active index
- Removed old carouselIndicator text ("1/N") in favor of dots

**Files changed:**
- components/photo-carousel.tsx - New: PhotoCarousel with swipe + dots
- __tests__/components/photo-carousel.test.tsx - New: 5 TDD tests
- app/(tabs)/index.tsx - Integrated PhotoCarousel, removed cardImage/carouselIndicator styles

**Verification:** tsc, lint, test (48 passed), build all pass.

**Next:** Entry detail view (full-screen on tap) or edit/delete entries per PRD Section 3.6

## 2026-01-15: Entry Detail Screen (Full-Screen View)

**PRD ref:** Phase 1 Weeks 5-7, Section 4.3 (Photo Carousel - Full-screen view on tap)

**Task:** Implement full-screen entry detail view when tapping an entry in Feed

**Decisions:**
- Created dynamic route app/entry/[id].tsx for entry detail
- Full-screen black background with photo carousel for multi-photo entries
- Header overlay with back button (‚Üê) and image counter (1/N)
- Caption + date shown in semi-transparent overlay at bottom
- Used router.push for navigation, router.back for returning
- EntryCard now accepts onPress prop and is wrapped in Pressable
- PhotoCarousel onImagePress also triggers navigation to detail view

**Files changed:**
- app/entry/[id].tsx - New: Full-screen entry detail with image carousel
- app/(tabs)/index.tsx - Added router import, onPress to EntryCard
- __tests__/app/entry/entry-detail.test.tsx - New: 5 TDD tests for detail screen

**Verification:** tsc, lint, test (53 passed), build all pass.

**Next:** Edit/delete entries (PRD Section 3.6) or video playback (PRD Section 9.3)
