# Little Journey - Development Progress

## 2026-01-14: Core Tab Navigation Setup

**PRD ref:** Phase 1 Weeks 1-2 Foundation, Section 4.1 Primary View

**Task:** Set up 4-tab navigation structure (Feed, Milestones, Search, Settings)

**Decisions:**
- Used index.tsx as Feed tab (Expo Router convention for default route)
- Removed template explore.tsx
- Icons: house.fill (Feed), star.fill (Milestones), magnifyingglass (Search), gearshape.fill (Settings)
- headerShown: true for proper screen titles

**Files changed:**
- app/(tabs)/_layout.tsx - Updated with 4 tabs
- app/(tabs)/index.tsx - Feed screen (renamed from feed.tsx)
- app/(tabs)/milestones.tsx - New placeholder
- app/(tabs)/search.tsx - New placeholder
- app/(tabs)/settings.tsx - New placeholder
- Deleted: app/(tabs)/explore.tsx

**Verification:** tsc, lint, test, build all pass

**Next:** Authentication flow or onboarding screens per PRD Phase 1 Weeks 3-4

## 2026-01-15: Auth Context and Route Protection

**PRD ref:** Phase 1 Weeks 3-4, Section 1 (Auth & Onboarding)

**Task:** Set up auth architecture - context, hooks, route protection, sign-in screen

**Decisions:**
- Created AuthProvider + useAuth hook with mock signIn/signOut (ready for backend integration)
- Used Slot-based routing with useSegments for auth gating (Expo Router pattern)
- Auth screens in (auth) route group, tabs in (tabs) group
- Sign-in screen is placeholder with demo flow - will add magic link/OAuth later
- Primary button color hardcoded (#0a7ea4) to work in light/dark mode

**Files changed:**
- contexts/auth-context.tsx - New: AuthProvider, useAuth hook, User type
- app/_layout.tsx - Wrap with AuthProvider, add RootLayoutNav for auth routing
- app/(auth)/_layout.tsx - New: Auth route group layout
- app/(auth)/sign-in.tsx - New: Sign-in placeholder screen
- __tests__/contexts/auth-context.test.tsx - New: TDD tests for auth context

**Verification:** tsc, lint, test (9 passed), build all pass. UI verified via Chrome MCP.

**Next:** Guided onboarding flow (PRD Section 1.3) or child profile creation

## 2026-01-15: Onboarding Route Group and Flow

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 (Guided Onboarding Flow)

**Task:** Set up onboarding architecture - route group, routing logic, placeholder add-child screen

**Decisions:**
- Added hasCompletedOnboarding + completeOnboarding to auth context (mock, ready for backend)
- 3-way routing in root layout: auth -> onboarding -> tabs
- Onboarding screens in (onboarding) route group with Stack navigator
- headerBackVisible: false, gestureEnabled: false to prevent back navigation during onboarding
- add-child is first onboarding step (step 2 per PRD, step 1 sign-up already done)

**Files changed:**
- contexts/auth-context.tsx - Added hasCompletedOnboarding, completeOnboarding
- app/_layout.tsx - Updated RootLayoutNav with 3-way routing logic
- app/(onboarding)/_layout.tsx - New: Onboarding route group layout
- app/(onboarding)/add-child.tsx - New: Add child placeholder screen
- app/(auth)/sign-in.tsx - Removed manual router.replace (handled by root layout)
- __tests__/contexts/auth-context.test.tsx - Added 3 tests for onboarding state

**Verification:** tsc, lint, test (12 passed), build all pass. UI verified via Chrome MCP.

**Next:** Child form fields (name, DOB, photo) or remaining onboarding steps (culture, prompt time, invite)

## 2026-01-15: Add Child Form Implementation

**PRD ref:** Phase 1 Weeks 3-4, Section 2.1 (Child Profile)

**Task:** Implement Add Child form with name, DOB, nickname fields and validation

**Decisions:**
- Created ChildContext + useChild hook for child state management (TDD approach)
- Child type: name (required), dateOfBirth (ISO string, required), nickname (optional), photoUri (optional)
- Form validation: name required, DOB required, DOB cannot be future
- Used @react-native-community/datetimepicker for native date picking
- Continue button disabled until form valid (visual feedback via gray color)
- Date displayed in Singapore locale format (en-SG)
- KeyboardAvoidingView + ScrollView for proper keyboard handling

**Files changed:**
- contexts/child-context.tsx - New: ChildProvider, useChild hook, Child type
- app/_layout.tsx - Added ChildProvider wrapper
- app/(onboarding)/add-child.tsx - Full form implementation with validation
- __tests__/contexts/child-context.test.tsx - New: 5 TDD tests for child context

**Verification:** tsc, lint, test (17 passed), build all pass. UI verified via Chrome MCP.

**Next:** Remaining onboarding steps (culture selection, prompt time, invite family) or photo picker for child

## 2026-01-15: Cultural Tradition Selection Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 3 (Select cultural tradition)

**Task:** Implement cultural tradition selection as step 3 of onboarding flow

**Decisions:**
- Added CulturalTradition type: "chinese" | "malay" | "indian" | "none"
- Added culturalTradition optional field to Child interface
- Added updateChild method to ChildContext for partial updates
- Created select-culture.tsx with radio button selection UI
- add-child now navigates to select-culture instead of completing onboarding
- select-culture completes onboarding after selection
- Culture options show milestone examples (Full Month, Aqiqah, Annaprashan, etc.)

**Files changed:**
- contexts/child-context.tsx - Added CulturalTradition type, culturalTradition field, updateChild method
- app/(onboarding)/select-culture.tsx - New: Culture selection screen with radio options
- app/(onboarding)/_layout.tsx - Added select-culture Stack.Screen
- app/(onboarding)/add-child.tsx - Navigate to select-culture instead of completeOnboarding
- __tests__/contexts/child-context.test.tsx - Added 2 tests for culturalTradition and updateChild

**Verification:** tsc, lint, test (19 passed), build all pass. UI verified via Chrome MCP.

**Next:** Daily prompt time selection (step 4) or invite family member (step 5)

## 2026-01-15: Daily Prompt Time Selection Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 4 (Set daily prompt time)

**Task:** Implement daily prompt time selection as step 4 of onboarding flow

**Decisions:**
- Created UserPreferencesContext + useUserPreferences hook for user settings (TDD approach)
- dailyPromptTime stored as 24-hour string "HH:mm" (e.g., "20:00")
- Default time: 8:00 PM SGT per PRD
- Used @react-native-community/datetimepicker with 5-minute intervals
- Platform-specific display: iOS spinner, Android default picker
- Skip option available (completes onboarding without setting time)
- Continue saves time and completes onboarding
- select-culture now navigates to set-prompt-time instead of completing onboarding

**Files changed:**
- contexts/user-preferences-context.tsx - New: UserPreferencesProvider, useUserPreferences hook
- app/_layout.tsx - Added UserPreferencesProvider wrapper
- app/(onboarding)/set-prompt-time.tsx - New: Time picker screen with skip option
- app/(onboarding)/_layout.tsx - Added set-prompt-time Stack.Screen
- app/(onboarding)/select-culture.tsx - Navigate to set-prompt-time instead of completeOnboarding
- __tests__/contexts/user-preferences-context.test.tsx - New: 5 TDD tests for user preferences

**Verification:** tsc, lint, test (24 passed), build all pass. Route protection verified via Chrome MCP.

**Next:** Invite family member (step 5) or first entry prompt (step 6)

## 2026-01-15: Invite Family Member Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 5 (Invite first family member)

**Task:** Implement invite family member as step 5 of onboarding flow

**Decisions:**
- Created FamilyContext + useFamily hook for family member management (TDD approach)
- FamilyMember type: id, email, relationship, permissionLevel, status, invitedAt
- PermissionLevel: "view_only" | "view_interact" per PRD Section 6.3
- InviteStatus: "pending" | "accepted" | "expired"
- Form validation: valid email required, relationship required
- Permission defaults to "view_interact" (most useful for grandparents)
- Skip option completes onboarding without inviting
- set-prompt-time now navigates to invite-family instead of completing onboarding

**Files changed:**
- contexts/family-context.tsx - New: FamilyProvider, useFamily hook, types
- app/_layout.tsx - Added FamilyProvider wrapper
- app/(onboarding)/invite-family.tsx - New: Invite form with email, relationship, permission
- app/(onboarding)/_layout.tsx - Added invite-family Stack.Screen
- app/(onboarding)/set-prompt-time.tsx - Navigate to invite-family instead of completeOnboarding
- __tests__/contexts/family-context.test.tsx - New: 6 TDD tests for family context

**Verification:** tsc, lint, test (30 passed), build all pass.

**Next:** First entry prompt (step 6) or core Feed features (entries, photos)

## 2026-01-15: First Entry Prompt Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 6 (First entry prompt)

**Task:** Implement first entry prompt as final onboarding step (step 6)

**Decisions:**
- Installed expo-image-picker for gallery/camera access
- Screen prompts "Add your first moment!" with camera emoji icon
- "Choose from Gallery" button requests media library permission then launches picker
- Skip option ("I'll do this later") completes onboarding without adding photo
- If user selects photo, completes onboarding (entry creation deferred to Feed feature)
- invite-family now navigates to first-entry instead of completing onboarding

**Files changed:**
- app/(onboarding)/first-entry.tsx - New: First entry prompt with image picker
- app/(onboarding)/_layout.tsx - Added first-entry Stack.Screen
- app/(onboarding)/invite-family.tsx - Navigate to first-entry, removed useAuth import
- __tests__/app/onboarding/first-entry.test.tsx - New: 5 TDD tests for first-entry screen
- package.json - Added expo-image-picker dependency

**Verification:** tsc, lint, test (35 passed), build all pass.

**Next:** Core Feed features (entry creation, photo upload) per PRD Phase 1 Weeks 5-7

## 2026-01-15: Entry Context and Feed UI

**PRD ref:** Phase 1 Weeks 5-7, Section 3 (Entry Creation), Section 4 (Timeline & Feed)

**Task:** Implement entry types, context, and feed UI with entry creation modal

**Decisions:**
- Created EntryContext + useEntries hook for entry state management (TDD approach)
- Entry type: id, type (photo/video/text), mediaUris (carousel), caption, date, tags, timestamps
- Entries stored reverse chronological (newest first) per PRD Section 4.1
- Feed shows FlatList with EntryCard components, EmptyState when no entries
- Floating action button (+) opens entry creation modal
- 2-step creation flow: type selection -> caption/media
- Photo/video picker reuses expo-image-picker from onboarding
- Multiple photo selection supported for carousel entries
- Entry card shows image, video placeholder, caption, date, carousel indicator

**Files changed:**
- contexts/entry-context.tsx - New: EntryProvider, useEntries hook, Entry/EntryType types
- app/_layout.tsx - Added EntryProvider wrapper
- app/(tabs)/index.tsx - Full feed UI with entry cards, FAB, creation modal
- __tests__/contexts/entry-context.test.tsx - New: 8 TDD tests for entry context

**Verification:** tsc, lint, test (43 passed), build all pass.

**Next:** Pull-to-refresh, entry detail view, or photo carousel swipe per PRD Section 4

## 2026-01-15: Pull-to-Refresh for Feed

**PRD ref:** Phase 1 Weeks 5-7, Section 4.1 (Primary View: Feed - Pull-to-refresh)

**Task:** Add pull-to-refresh to Feed FlatList

**Decisions:**
- Used RefreshControl component with FlatList's refreshControl prop
- Added refreshing state + onRefresh callback with useCallback
- Simulated 1s refresh delay (placeholder for TanStack Query invalidation)
- tintColor/colors set to PRIMARY_COLOR for consistent branding

**Files changed:**
- app/(tabs)/index.tsx - Added RefreshControl, refreshing state, onRefresh handler

**Verification:** tsc, lint, test (43 passed), build all pass.

**Next:** Entry detail view, photo carousel swipe, or edit/delete entries per PRD Section 4

## 2026-01-15: Photo Carousel Component

**PRD ref:** Phase 1 Weeks 5-7, Section 4.3 (Photo Carousel)

**Task:** Implement swipeable photo carousel for multi-photo entries with dot indicators

**Decisions:**
- Created PhotoCarousel component with horizontal ScrollView + pagingEnabled
- Dot indicators shown only when images.length > 1
- Active dot opacity 1, inactive 0.4 for visual feedback
- onImagePress callback for future full-screen view integration
- Configurable aspectRatio prop (default 1:1 square)
- Used onScroll with scrollEventThrottle to track active index
- Removed old carouselIndicator text ("1/N") in favor of dots

**Files changed:**
- components/photo-carousel.tsx - New: PhotoCarousel with swipe + dots
- __tests__/components/photo-carousel.test.tsx - New: 5 TDD tests
- app/(tabs)/index.tsx - Integrated PhotoCarousel, removed cardImage/carouselIndicator styles

**Verification:** tsc, lint, test (48 passed), build all pass.

**Next:** Entry detail view (full-screen on tap) or edit/delete entries per PRD Section 3.6

## 2026-01-15: Entry Detail Screen (Full-Screen View)

**PRD ref:** Phase 1 Weeks 5-7, Section 4.3 (Photo Carousel - Full-screen view on tap)

**Task:** Implement full-screen entry detail view when tapping an entry in Feed

**Decisions:**
- Created dynamic route app/entry/[id].tsx for entry detail
- Full-screen black background with photo carousel for multi-photo entries
- Header overlay with back button (‚Üê) and image counter (1/N)
- Caption + date shown in semi-transparent overlay at bottom
- Used router.push for navigation, router.back for returning
- EntryCard now accepts onPress prop and is wrapped in Pressable
- PhotoCarousel onImagePress also triggers navigation to detail view

**Files changed:**
- app/entry/[id].tsx - New: Full-screen entry detail with image carousel
- app/(tabs)/index.tsx - Added router import, onPress to EntryCard
- __tests__/app/entry/entry-detail.test.tsx - New: 5 TDD tests for detail screen

**Verification:** tsc, lint, test (53 passed), build all pass.

**Next:** Edit/delete entries (PRD Section 3.6) or video playback (PRD Section 9.3)

## 2026-01-15: Entry Edit/Delete UI

**PRD ref:** Phase 1 Weeks 5-7, Section 3.6 (Entry Ownership & Editing)

**Task:** Add edit/delete actions to entry detail screen

**Decisions:**
- EntryContext already had updateEntry/deleteEntry methods (implemented earlier)
- Added options button (‚ãÆ) to entry detail header next to back button
- Used Modal with two states: "options" menu and "confirmDelete" confirmation
- iOS-style dark menu with Edit and Delete options
- Delete shows confirmation dialog with red "Delete Entry" button
- On delete: calls deleteEntry(id) then router.back()
- Edit is placeholder (TODO: implement edit modal/screen)

**Files changed:**
- app/entry/[id].tsx - Added options button, modal with edit/delete, delete confirmation
- __tests__/app/entry/entry-detail.test.tsx - Added 4 tests for options menu and delete flow

**Verification:** tsc, lint, test (57 passed), build all pass.

**Next:** Entry edit modal/screen or video playback (PRD Section 9.3)

## 2026-01-15: Entry Edit Modal

**PRD ref:** Phase 1 Weeks 5-7, Section 3.6 (Entry Ownership & Editing)

**Task:** Implement edit modal for editing entry caption

**Decisions:**
- Added "edit" state to MenuState type (was: closed/options/confirmDelete)
- Edit modal slides up from bottom (iOS sheet pattern)
- Pre-fills caption from current entry on open
- Save button calls updateEntry(id, { caption }) and closes modal
- Cancel button closes modal without saving
- KeyboardAvoidingView handles keyboard on iOS/Android
- Multiline TextInput with 500 char limit for caption

**Files changed:**
- app/entry/[id].tsx - Added edit modal UI, editCaption state, save/cancel handlers
- __tests__/app/entry/entry-detail.test.tsx - Added 4 tests for edit modal flow

**Verification:** tsc, lint, test (61 passed), build all pass.

**Next:** Video playback (PRD Section 9.3) or search/milestones features

## 2026-01-15: Milestones Feature - Context and Tab UI

**PRD ref:** Phase 1 Weeks 8-9, Section 5 (Milestones)

**Task:** Implement MilestoneContext and Milestones tab with templates and UI

**Decisions:**
- Created MilestoneContext + useMilestones hook for milestone state management (TDD approach)
- Milestone type: id, templateId, childId, milestoneDate, celebrationDate, customTitle/Description, isCompleted
- MILESTONE_TEMPLATES constant with PRD Section 5.1 cultural milestones:
  - Chinese: Full Month (Êª°Êúà), 100 Days (ÁôæÊó•), Zhua Zhou (ÊäìÂë®), First Lunar New Year
  - Malay: Aqiqah, Cukur Jambul, First Hari Raya
  - Indian: Naming Ceremony, Annaprashan, First Deepavali
  - Universal: First smile/laugh/steps/words/tooth/haircut/school
- Templates filtered by child's cultural tradition + universal
- daysFromBirth auto-calculates milestone date from child DOB
- Milestones tab: empty state, upcoming/completed sections, FAB
- Two modals: template selection (bottom sheet), custom milestone (full screen)
- Custom milestone form: title, description, date picker

**Files changed:**
- contexts/milestone-context.tsx - New: MilestoneProvider, useMilestones, types, MILESTONE_TEMPLATES
- app/_layout.tsx - Added MilestoneProvider wrapper
- app/(tabs)/milestones.tsx - Full milestone UI with sections, modals, template list
- __tests__/contexts/milestone-context.test.tsx - New: 7 TDD tests for milestone context

**Verification:** tsc, lint, test (68 passed), build all pass.

**Next:** Milestone completion flow, milestone detail view, or PRD Section 8 (Search)

## 2026-01-15: Milestone Completion Flow

**PRD ref:** Phase 1 Weeks 8-9, Section 5.2 (Dual Date System), Section 5.3 (Milestone UI)

**Task:** Implement milestone completion modal - mark milestones as completed with celebration date and notes

**Decisions:**
- Added "complete" to ModalState type for completion modal
- Milestone cards now tappable (wrapped in Pressable) to open completion modal
- Completion modal shows: milestone title, celebration date picker, notes input
- completeMilestone and deleteMilestone from context now used in UI
- Delete option available in completion modal (red outline button)
- Celebration date defaults to today (can be changed)
- Notes are optional

**Files changed:**
- app/(tabs)/milestones.tsx - Added completion modal, tappable cards, completion/delete handlers, new styles
- __tests__/app/tabs/milestones.test.tsx - New: 5 TDD tests for milestone screen + completion flow

**Verification:** tsc, lint, test (73 passed), build all pass.

**Next:** Search feature (PRD Section 8) or video playback (PRD Section 9.3)

## 2026-01-15: Search Feature - UI and Local Filtering

**PRD ref:** Phase 1 Weeks 8-9, Section 8 (Search & Discovery)

**Task:** Implement Search tab UI with text search and type filtering

**Decisions:**
- Search filters entries by caption text and tags (local filtering, AI/Vectorize deferred)
- Filter chips: All, Photos, Videos, Text (type-based filtering)
- Empty state with search icon when no query entered
- "No Results" state when search has no matches
- SearchResultCard shows thumbnail, caption, date, tags (max 3)
- Tapping result navigates to entry detail view (/entry/[id])
- useMemo for filtered entries to optimize re-renders

**Files changed:**
- app/(tabs)/search.tsx - Full search UI with input, filter chips, results list
- __tests__/app/tabs/search.test.tsx - New: 6 TDD tests for search functionality

**Verification:** tsc, lint, test (79 passed), build all pass.

**Next:** Video playback (PRD Section 9.3) or push notifications (PRD Section 7)

## 2026-01-15: Video Playback with expo-av

**PRD ref:** Phase 1 Weeks 5-7, Section 9.3 (Video Playback)

**Task:** Implement video playback for video entries using expo-av

**Decisions:**
- Installed expo-av for Video component (note: deprecated in SDK 54, will migrate to expo-video later)
- Created VideoPlayer component with play/pause overlay controls
- VideoPlayer replaces placeholder üé¨ emoji in Feed EntryCard
- Entry Detail shows full-screen video player for video entries
- Auto-loops videos, tap to toggle play/pause
- ResizeMode.CONTAIN for proper aspect ratio
- TDD approach: wrote tests first with expo-av mocks

**Files changed:**
- components/video-player.tsx - New: VideoPlayer with expo-av Video, play/pause controls
- app/(tabs)/index.tsx - Integrated VideoPlayer in EntryCard, removed videoPlaceholder styles
- app/entry/[id].tsx - Added VideoPlayer for video entries, conditional rendering photo vs video
- __tests__/components/video-player.test.tsx - New: 5 TDD tests for VideoPlayer
- __tests__/app/entry/entry-detail.test.tsx - Added expo-av mock
- package.json - Added expo-av dependency

**Verification:** tsc, lint, test (84 passed), build all pass.

**Next:** Push notifications (PRD Section 7) or Settings screen UI

## 2026-01-15: Push Notifications Context

**PRD ref:** Phase 1 Weeks 10-11, Section 7 (Notifications)

**Task:** Implement NotificationContext for push notification settings and scheduling

**Decisions:**
- Created NotificationContext + useNotifications hook (TDD approach)
- NotificationSettings type with 5 toggles per PRD Section 7.1: dailyPrompt, memories, milestoneReminder, familyActivity, storageWarning
- All default to true (on) per PRD
- Permission status: granted/denied/undetermined
- requestPermissions() gets expo push token and sets up Android channel
- scheduleDailyPrompt(time) cancels existing then schedules daily notification at specified time
- cancelDailyPrompt() cancels all scheduled notifications
- Uses Notifications.SchedulableTriggerInputTypes.DAILY for repeating daily trigger
- Listeners set up for notification received and response handling

**Files changed:**
- contexts/notification-context.tsx - New: NotificationProvider, useNotifications, NotificationSettings type
- app/_layout.tsx - Added NotificationProvider wrapper
- __tests__/contexts/notification-context.test.tsx - New: 7 TDD tests for notification context
- package.json - Added expo-notifications, expo-device dependencies

**Verification:** tsc, lint, test (91 passed), build all pass.

**Next:** Settings screen UI with notification toggles or family invitation flow

## 2026-01-15: Settings Screen UI

**PRD ref:** Phase 1 Weeks 10-11, Section 7.4 (Notification Settings), Section 6.1 (Invitation Flow)

**Task:** Implement Settings screen with notification toggles, family member management, sign-out

**Decisions:**
- 3 sections: Notifications, Family, Account (iOS Settings app pattern)
- Notification toggles: Daily Prompts, On This Day Memories, Milestone Reminders, Family Activity
- Permission banner shown when notifications not granted (tappable to request)
- Invite Family modal: email, relationship, permission level (view_interact/view_only)
- Family members displayed in list with Remove option
- Sign Out with Alert confirmation (destructive style)
- ScrollView for content, KeyboardAvoidingView in modal

**Files changed:**
- app/(tabs)/settings.tsx - Full settings UI with toggles, family list, invite modal, sign out
- __tests__/app/tabs/settings.test.tsx - New: 5 TDD tests for settings screen

**Verification:** tsc, lint, test (96 passed), build all pass.

**Next:** Remaining Phase 1 Week 12-13 items (Stripe payments, storage limits, polish) or Week 10-11 daily prompt scheduling integration

## 2026-01-15: Daily Prompt Notification Integration

**PRD ref:** Phase 1 Weeks 10-11, Section 7.2 (Implementation), Section 7.3 (Smart Frequency)

**Task:** Integrate daily prompt scheduling with user preferences and notification toggle

**Decisions:**
- Settings screen now shows "Reminder Time" row with current time or "Not set"
- Time picker modal for changing prompt time (reuses DateTimePicker from onboarding)
- When dailyPrompt toggle changes: schedules notification if ON + time set, cancels if OFF
- Onboarding set-prompt-time now requests permissions and schedules notification on Continue
- formatDisplayTime, timeStringToDate, dateToTimeString helpers for time conversion
- Schedule only when permissions granted (handles denied gracefully)

**Files changed:**
- app/(tabs)/settings.tsx - Added time picker modal, Reminder Time row, toggle schedules/cancels
- app/(onboarding)/set-prompt-time.tsx - Integrated requestPermissions + scheduleDailyPrompt
- __tests__/app/tabs/settings.test.tsx - Added 2 TDD tests for Reminder Time display

**Verification:** tsc, lint, test (98 passed), build all pass.

**Next:** Remaining Phase 1 Week 12-13 items (Stripe payments, storage limits, polish) or Photo for child profile

## 2026-01-15: Storage Context and Tier Limits

**PRD ref:** Phase 1 Weeks 12-13, Section 9.1 (Video Tier Limits), Section 12.1 (Tier Structure)

**Task:** Implement StorageContext for tracking storage usage and enforcing tier limits

**Decisions:**
- Created StorageContext + useStorage hook for storage management (TDD approach)
- SubscriptionTier type: "free" | "standard" | "premium"
- TIER_LIMITS constant: free=500MB, standard=10GB, premium=50GB per PRD
- VIDEO_DURATION_LIMITS: free=0, standard=2min, premium=10min per PRD Section 9.1
- usagePercent calculated as Math.round((usedBytes/limitBytes)*100)
- canUpload(bytes) checks if addition would exceed limit
- canUploadVideo(seconds) checks tier video permissions
- addUsage/removeUsage for tracking media uploads/deletes

**Files changed:**
- contexts/storage-context.tsx - New: StorageProvider, useStorage, TIER_LIMITS, VIDEO_DURATION_LIMITS
- app/_layout.tsx - Added StorageProvider wrapper
- __tests__/contexts/storage-context.test.tsx - New: 7 TDD tests for storage context

**Verification:** tsc, lint, test (105 passed), build all pass.

**Next:** Integrate storage tracking with entry creation or Settings screen storage display

## 2026-01-15: Storage Integration with Entry Creation + Settings Display

**PRD ref:** Phase 1 Weeks 12-13, Section 9.1 (Video Tier Limits), Section 12.1 (Tier Structure)

**Task:** Integrate storage limits with entry creation flow and display storage in Settings

**Decisions:**
- Feed screen now checks storage limits before allowing photo/video uploads
- Video button shows "Video Not Available" alert on free tier (no video allowed)
- Video uploads check duration limit: standard=2min, premium=10min
- Photo/video uploads check total file size against storage limit
- File sizes tracked from ImagePicker assets and added to storage usage on submit
- Settings screen shows new Storage section with:
  - Plan name (Free/Standard/Premium)
  - Usage bar with color: green (<80%), yellow (80-90%), red (>90%)
  - Usage text: "X B of Y MB" and "N% used"
  - Upgrade prompt on free tier

**Files changed:**
- app/(tabs)/index.tsx - Added useStorage hook, storage/video checks in handleTypeSelect, track usage in handleSubmit
- app/(tabs)/settings.tsx - Added Storage section with progress bar, tier display, upgrade prompt
- __tests__/app/tabs/feed.test.tsx - New: 6 TDD tests for storage validation
- __tests__/app/tabs/settings.test.tsx - Added StorageProvider, 2 tests for storage section

**Verification:** tsc, lint, test (113 passed), build all pass.

**Next:** Stripe payments integration (PRD Section 12.2) or UI polish

## 2026-01-15: Data Export Feature

**PRD ref:** Phase 1 Weeks 12-13, Section 11.1 (Data Export)

**Task:** Implement data export functionality - "Download all memories" per PRD

**Decisions:**
- Created ExportContext + useExport hook for export functionality (TDD approach)
- ExportData type contains: exportDate, version, child, entries, milestones
- Uses expo-file-system new File API (Paths.document, File.write)
- Uses expo-sharing for native share sheet integration
- Export generates JSON file named little-journey-export-{date}.json
- Added "Data & Privacy" section to Settings per PRD Section 11
- Button shows "Exporting..." with disabled state during export
- lastExportDate displayed after successful export

**Files changed:**
- contexts/export-context.tsx - New: ExportProvider, useExport, ExportData type
- app/_layout.tsx - Added ExportProvider wrapper
- app/(tabs)/settings.tsx - Added Data & Privacy section with export button
- __tests__/contexts/export-context.test.tsx - New: 6 TDD tests for export context
- __tests__/app/tabs/settings.test.tsx - Added ExportProvider, 2 tests for export UI
- package.json - Added expo-file-system, expo-sharing dependencies

**Verification:** tsc, lint, test (121 passed), build all pass.

**Next:** Account deletion (PRD Section 11.2) or Stripe payments (PRD Section 12.2)

## 2026-01-15: Account Deletion Feature

**PRD ref:** Phase 1 Weeks 12-13, Section 11.2 (Account Deletion)

**Task:** Implement account deletion with 30-day grace period per PRD

**Decisions:**
- Added deletionScheduledAt, requestAccountDeletion, cancelAccountDeletion to AuthContext
- requestAccountDeletion sets deletion date 30 days in future (grace period per PRD)
- cancelAccountDeletion clears scheduled deletion
- signOut clears deletion state
- Settings shows "Delete Account" button opening modal with confirmation
- User must type "DELETE" to confirm (PRD requirement)
- Modal shows warning list of data to be deleted and 30-day grace period info
- When deletion scheduled: shows yellow banner with date and "Cancel Deletion" button
- Delete button hidden when deletion already scheduled (replaced by cancel banner)

**Files changed:**
- contexts/auth-context.tsx - Added deletionScheduledAt state, requestAccountDeletion/cancelAccountDeletion methods
- app/(tabs)/settings.tsx - Added delete account modal, confirmation flow, scheduled deletion UI
- __tests__/contexts/auth-context.test.tsx - Added 4 TDD tests for deletion state
- __tests__/app/tabs/settings.test.tsx - Added 2 tests for delete account UI

**Verification:** tsc, lint, test (127 passed), build all pass.

**Next:** Stripe payments integration (PRD Section 12.2) or UI polish

## 2026-01-15: Subscription Context and Upgrade Flow

**PRD ref:** Phase 1 Weeks 12-13, Section 12 (Monetization)

**Task:** Implement subscription/payment infrastructure and upgrade UI per PRD 12.1-12.3

**Decisions:**
- Created SubscriptionContext + useSubscription hook for subscription state management (TDD approach)
- PLAN_DETAILS constant with PRD prices: Standard $4.99/mo ($39.99/yr), Premium $9.99/mo ($79.99/yr)
- BillingCycle type: "monthly" | "yearly"
- subscribe() method handles plan subscription (mock, ready for Stripe integration)
- cancelSubscription() marks subscription for cancellation (access until period ends per PRD 12.3)
- restoreSubscription() unmarks cancelled subscription
- Added Subscription section to Settings with plan display, cancel/restore buttons
- Subscription modal: billing cycle toggle, plan cards with features, subscribe button
- Storage context setTier synced with subscription changes
- Upgrade prompt in Storage section now opens subscription modal

**Files changed:**
- contexts/subscription-context.tsx - New: SubscriptionProvider, useSubscription, PLAN_DETAILS, types
- app/_layout.tsx - Added SubscriptionProvider wrapper
- app/(tabs)/settings.tsx - Added subscription section, upgrade modal, cancel/restore flow
- __tests__/contexts/subscription-context.test.tsx - New: 10 TDD tests for subscription context
- __tests__/app/tabs/settings.test.tsx - Added SubscriptionProvider, updated tests

**Verification:** tsc, lint, test (136 passed), build all pass.

**Next:** UI polish or integrate with actual Stripe SDK

## 2026-01-15: "On This Day" Memories Feature

**PRD ref:** Phase 1 Weeks 10-11, Section 4.5 ("On This Day" Memories)

**Task:** Implement "On This Day" memory card in Feed showing entries from same day in previous years

**Decisions:**
- Added getOnThisDayEntries() to EntryContext - filters entries by same month/day in previous years
- OnThisDayCard component shows golden-bordered card with sparkle icon
- Displays up to 3 memory thumbnails horizontally
- Each thumbnail shows "X years ago" label
- Tapping memory navigates to entry detail view
- Card only renders when memories exist (returns null otherwise)
- FlatList uses ListHeaderComponent for card (shows above Feed entries)
- Empty state logic updated: shows empty state only when no entries AND no memories

**Files changed:**
- contexts/entry-context.tsx - Added getOnThisDayEntries() method to context
- app/(tabs)/index.tsx - Added OnThisDayCard component, integrated in Feed, added styles
- __tests__/app/tabs/feed.test.tsx - Added 4 TDD tests for "On This Day" logic

**Verification:** tsc, lint, test (140 passed), build all pass.

**Next:** Photo book export (PRD Section 10) or UI polish

## 2026-01-15: Child Profile Photo Picker

**PRD ref:** Phase 1 Weeks 3-4, Section 2.1 (Child Profile - Photo optional field)

**Task:** Add photo picker to add-child onboarding screen for child profile photo

**Decisions:**
- Reused expo-image-picker pattern from first-entry.tsx
- Circular photo button (100x100) with dashed border, centered above form fields
- allowsEditing: true with 1:1 aspect ratio for profile-appropriate cropping
- Placeholder shows camera emoji + "Add Photo" text
- photoUri stored in child context and passed to setChild on Continue
- TDD approach: wrote 5 tests before implementation

**Files changed:**
- app/(onboarding)/add-child.tsx - Added photo picker UI, handlePickPhoto, photoUri state
- __tests__/app/onboarding/add-child.test.tsx - New: 5 TDD tests for photo picker

**Verification:** tsc, lint, test (145 passed), build all pass.

**Next:** Photo book export (PRD Section 10) or Settings child profile edit

## 2026-01-15: Child Profile Edit in Settings

**PRD ref:** Phase 1 Weeks 12-13 (Polish), Section 2.1 (Child Profile)

**Task:** Add child profile display and edit capability to Settings screen

**Decisions:**
- Added Child Profile section between Notifications and Family sections
- Profile shows: photo (or placeholder), name, nickname, DOB, cultural tradition
- Edit button opens modal with full profile editing (reuses onboarding patterns)
- Edit modal includes: photo picker, name, nickname, DOB picker, cultural tradition selector
- Used updateChild from ChildContext for partial updates
- Empty state shows "No child profile added" when no child exists
- TDD approach: 5 new tests added to existing settings.test.tsx

**Files changed:**
- app/(tabs)/settings.tsx - Added child profile section, edit modal, handlers, styles
- __tests__/app/tabs/settings.test.tsx - Added 5 TDD tests for child profile, plus test helpers

**Verification:** tsc, lint, test (150 passed), build all pass.

**Next:** Photo book export (PRD Section 10) or UI polish

## 2026-01-15: Photo Book Export Feature

**PRD ref:** Phase 1 Weeks 12-13 (Polish), Section 10 (Photo Book Export)

**Task:** Implement photo book generation and PDF export (premium feature)

**Decisions:**
- Created PhotoBookContext + usePhotoBook hook for photo book state management (TDD approach)
- PhotoBookPage type: title, photo, milestone, blank page types
- Auto-generates pages from milestone entries + regular photo entries
- Milestones within 3 days of entry date get associated as milestone pages
- Title page auto-generated with child name and birth date
- Pages can be reordered, removed, and captions edited
- canExportPdf checks subscription tier (premium/standard only per PRD 10.3)
- Photo Book screen: preview with page cards, edit/remove actions, regenerate option
- PageCard component shows page number, image, caption, milestone badge
- Export button shows "Premium" badge if user on free tier
- Photo Book section added to Settings with "Create Photo Book" button

**Files changed:**
- contexts/photo-book-context.tsx - New: PhotoBookProvider, usePhotoBook, types
- app/_layout.tsx - Added PhotoBookProvider wrapper
- app/photo-book.tsx - New: Full photo book preview with page list, edit modal
- app/(tabs)/settings.tsx - Added Photo Book section with navigation button
- __tests__/contexts/photo-book-context.test.tsx - New: 7 TDD tests for photo book context

**Verification:** tsc, lint, test (157 passed), build all pass.

**Next:** UI polish, dark mode improvements, or actual PDF generation implementation

## 2026-01-15: UI Polish - Theme System Extension

**PRD ref:** Phase 1 Weeks 12-13 (Polish)

**Task:** Extend theme system with comprehensive colors, update Feed screen to use theme colors

**Decisions:**
- Extended constants/theme.ts with comprehensive color palette:
  - PRIMARY_COLOR exported constant (replaces local definitions)
  - Colors.light/dark: textSecondary, textMuted, backgroundSecondary, backgroundTertiary, border, borderLight, inputBorder, placeholder, card, cardBorder, overlay, overlayLight
  - SemanticColors: success, warning, error, info, gold (and light variants)
  - Spacing scale: xs(4), sm(8), md(12), lg(16), xl(24), xxl(32)
  - Shadows presets: small, medium, large
- Feed screen (index.tsx) updated to use theme colors:
  - Import PRIMARY_COLOR, Colors, SemanticColors, Shadows from theme
  - Modal, header, type options now use colors.background/border/backgroundSecondary
  - Caption input uses colors.inputBorder, colors.placeholder, colors.text
  - EntryCard uses colors.backgroundSecondary
  - OnThisDayCard uses SemanticColors.goldLight, colors.backgroundTertiary
  - FAB uses Shadows.large instead of inline shadow styles
- Removed hardcoded colors: #fff, #ccc, #ddd, #999, rgba(128,128,128,0.1), etc.

**Files changed:**
- constants/theme.ts - Extended with PRIMARY_COLOR, textSecondary/muted, backgroundSecondary/tertiary, border colors, SemanticColors, Spacing, Shadows
- app/(tabs)/index.tsx - Updated to use theme imports and theme-aware styles

**Verification:** tsc, lint, test (157 passed), build all pass.

**Next:** Continue UI polish for other screens (milestones, search, settings, entry detail)

## 2026-01-15: UI Polish - Milestones Screen Theme Integration

**PRD ref:** Phase 1 Weeks 12-13 (Polish)

**Task:** Apply theme system to milestones.tsx screen

**Decisions:**
- Added useColorScheme hook + Colors/SemanticColors/Shadows/Spacing imports
- Dynamic colors via colors = Colors[colorScheme] pattern
- Milestone cards: dynamic card/cardBorder colors, Shadows.small
- Completed badge: SemanticColors.success for green
- Modal overlays: colors.overlay, colors.background, colors.border
- Template items: colors.backgroundSecondary
- Form inputs: colors.inputBorder, colors.placeholder, colors.text
- Section titles, descriptions: colors.textSecondary, colors.textMuted
- Delete button: SemanticColors.error for red
- FAB: Shadows.large instead of inline shadow
- Replaced hardcoded padding/margin with Spacing constants
- submitButtonDisabled: opacity: 0.5 instead of hardcoded #ccc

**Files changed:**
- app/(tabs)/milestones.tsx - Full theme integration with dynamic colors and Spacing

**Verification:** tsc, lint, test (157 passed), build all pass.

**Next:** Continue UI polish for search.tsx, settings.tsx, entry detail screens

## 2026-01-15: UI Polish - Search Screen Theme Integration

**PRD ref:** Phase 1 Weeks 12-13 (Polish)

**Task:** Apply theme system to search.tsx screen

**Decisions:**
- Added useColorScheme hook + Colors/Spacing/Shadows imports from theme
- Removed local PRIMARY_COLOR definition, use imported constant
- Dynamic colors via colors = Colors[colorScheme] pattern
- FilterChip: dynamic backgroundColor (backgroundTertiary), textSecondary color
- SearchResultCard: dynamic backgroundSecondary, Shadows.small for elevation
- Video/text placeholders: dynamic backgroundTertiary
- Search input: colors.background, colors.text, colors.inputBorder, colors.placeholder
- Result date: colors.textSecondary instead of opacity hack
- Empty state text: colors.textMuted
- Replaced hardcoded padding/margin with Spacing constants

**Files changed:**
- app/(tabs)/search.tsx - Full theme integration with dynamic colors and Spacing

**Verification:** tsc, lint, test (157 passed), build all pass.

**Next:** Continue UI polish for settings.tsx, entry detail screens

## 2026-01-15: UI Polish - Settings Screen Theme Integration

**PRD ref:** Phase 1 Weeks 12-13 (Polish)

**Task:** Apply theme system to settings.tsx screen

**Decisions:**
- Added useColorScheme hook + Colors/SemanticColors imports from theme
- Removed local PRIMARY_COLOR definition, use imported constant
- Dynamic colors via colors = Colors[colorScheme] pattern
- All sections: dynamic card/backgroundSecondary for light/dark mode
- Notification toggles: colors.border for track off color
- Setting rows: dynamic text/textSecondary colors
- Permission banners: SemanticColors.warningLight/warningText
- Family members: dynamic border/text colors, SemanticColors.error for remove
- Storage progress bar: SemanticColors.error/warning for threshold colors
- Account section: SemanticColors.error for sign out and delete buttons
- All modals: dynamic backgroundSecondary/card/border colors
- Form inputs: dynamic backgroundColor/color/borderColor/placeholderTextColor
- Subscription modal: dynamic billing toggle, plan cards with theme colors
- Edit child modal: dynamic photo placeholder, form inputs, culture options

**Files changed:**
- app/(tabs)/settings.tsx - Full theme integration with dynamic colors

**Verification:** tsc, lint, test (157 passed), build all pass.

**Next:** Continue UI polish for entry detail screens

## 2026-01-15: UI Polish - Entry Detail Screen Theme Integration

**PRD ref:** Phase 1 Weeks 12-13 (Polish)

**Task:** Apply theme system to entry detail screen (entry/[id].tsx)

**Decisions:**
- Added ViewerColors to theme.ts for full-screen media viewer context
- ViewerColors intentionally dark (black bg for media viewing) - not light/dark mode dependent
- ViewerColors includes: background, overlay, overlayStrong, text, textMuted, textSubtle, textPlaceholder, modalBackground, modalBorder, inputBackground, buttonBackground
- Entry detail uses ViewerColors, PRIMARY_COLOR, SemanticColors, Spacing from theme
- All hardcoded colors replaced: #000, #fff, rgba values, #1c1c1e, #ff453a
- Modals (options, delete confirm, edit): ViewerColors.modalBackground/modalBorder
- Delete button: SemanticColors.error
- Edit modal: PRIMARY_COLOR for cancel/save buttons, ViewerColors for inputs
- Spacing constants for padding/margins throughout

**Files changed:**
- constants/theme.ts - Added ViewerColors export for full-screen viewer context
- app/entry/[id].tsx - Full theme integration with ViewerColors and Spacing

**Verification:** tsc, lint, test (157 passed), build all pass.

**Next:** UI polish for onboarding screens or photo book screen

## 2026-01-15: UI Polish - Onboarding Screens Theme Integration

**PRD ref:** Phase 1 Weeks 12-13 (Polish)

**Task:** Apply theme system to all 5 onboarding screens

**Decisions:**
- All screens now use useColorScheme hook + Colors/Spacing imports from theme
- Removed local PRIMARY_COLOR definitions, use imported constant
- Dynamic colors via colors = Colors[colorScheme] pattern for light/dark support
- add-child.tsx: inputs use colors.background/inputBorder/text/placeholder, photo placeholder uses backgroundSecondary, errors use SemanticColors.error
- select-culture.tsx: option cards use colors.border/background, descriptions use colors.textSecondary
- set-prompt-time.tsx: info box uses colors.backgroundSecondary, info text uses colors.textSecondary
- invite-family.tsx: inputs/permission options use dynamic colors, info box themed
- first-entry.tsx: uses Spacing constants, buttonDisabled uses opacity:0.5
- All hardcoded colors replaced: #ccc, #999, #fff, #000, rgba(128,128,128,0.1), #dc2626, #f5f5f5, #666
- Spacing constants replace hardcoded padding/margin values throughout

**Files changed:**
- app/(onboarding)/add-child.tsx - Full theme integration
- app/(onboarding)/select-culture.tsx - Full theme integration
- app/(onboarding)/set-prompt-time.tsx - Full theme integration
- app/(onboarding)/invite-family.tsx - Full theme integration
- app/(onboarding)/first-entry.tsx - Full theme integration

**Verification:** tsc, lint, test (157 passed), build all pass.

**Next:** UI polish for photo book screen or sign-in screen

## 2026-01-15: UI Polish - Sign-in and Photo Book Screen Theme Integration

**PRD ref:** Phase 1 Weeks 12-13 (Polish)

**Task:** Apply theme system to sign-in and photo-book screens

**Decisions:**
- sign-in.tsx: Removed local PRIMARY_COLOR, use imported constant from theme
- sign-in.tsx: Added useColorScheme hook for dynamic colors
- sign-in.tsx: Subtitle uses colors.textSecondary, hint uses colors.textMuted
- sign-in.tsx: Replaced opacity hacks with semantic color tokens
- sign-in.tsx: Used Spacing constants for padding/margins
- photo-book.tsx: Added useColorScheme hook + Colors/SemanticColors/Shadows/Spacing imports
- photo-book.tsx: PageCard component now accepts colors prop for dynamic theming
- photo-book.tsx: All containers/modals use dynamic colors.background/backgroundSecondary
- photo-book.tsx: PageCard uses Shadows.medium instead of inline shadow styles
- photo-book.tsx: Milestone badge uses SemanticColors.gold, remove button uses SemanticColors.error
- photo-book.tsx: Export button disabled state uses opacity:0.5 instead of hardcoded #ccc
- photo-book.tsx: All inputs use colors.inputBorder/placeholder/text
- photo-book.tsx: Replaced all hardcoded padding/margin with Spacing constants

**Files changed:**
- app/(auth)/sign-in.tsx - Full theme integration
- app/photo-book.tsx - Full theme integration with dynamic colors and Spacing

**Verification:** tsc, lint, test (157 passed), build all pass.

**Next:** All UI screens themed. Remaining items: actual Stripe SDK integration, PDF generation, or backend API integration.

## 2026-01-15: EXIF Date Extraction for Photo Entries

**PRD ref:** Phase 1 Weeks 5-7, Section 3.4 (EXIF Date Detection)

**Task:** Implement EXIF date extraction to auto-fill entry date from photo metadata

**Decisions:**
- Created utils/exif-date.ts with extractDateFromExif() function
- ExifData type supports DateTimeOriginal, DateTimeDigitized, DateTime fields
- Priority order: DateTimeOriginal > DateTimeDigitized > DateTime (per EXIF spec)
- Handles both EXIF format "YYYY:MM:DD HH:mm:ss" and ISO format
- Returns null for invalid/missing dates (graceful fallback to today)
- Added exif: true option to ImagePicker.launchImageLibraryAsync for photos
- Entry creation now extracts date from first selected photo's EXIF
- Added date picker row to caption step so user can override date
- Date picker limits maximumDate to today (no future dates)
- TDD approach: 10 unit tests for EXIF parsing

**Files changed:**
- utils/exif-date.ts - New: extractDateFromExif function, ExifData type
- app/(tabs)/index.tsx - Added EXIF extraction, entryDate state, date picker UI
- __tests__/utils/exif-date.test.ts - New: 10 TDD tests for EXIF date parsing

**Verification:** tsc, lint, test (167 passed), build all pass.

**Next:** Backend API integration, Stripe SDK, or PDF generation

## 2026-01-15: Draft Auto-Save Feature

**PRD ref:** Phase 1 Weeks 5-7, Section 3.5 (Draft Auto-Save)

**Task:** Implement draft auto-save for incomplete entry creation

**Decisions:**
- Created useDraft hook using @react-native-async-storage/async-storage for persistence
- Draft type: type, mediaUris, mediaSizes, caption, date, savedAt timestamp
- Single draft per user stored at key "@littlejourney:draft"
- Auto-saves when modal open AND type selected (prevents saving empty drafts)
- Resume prompt shown on app open when draft exists (Alert with Resume/Discard)
- Draft cleared on successful entry post
- Used useRef to prevent multiple prompts during same session
- TDD approach: 8 tests for hook + 3 integration tests for Feed

**Files changed:**
- hooks/use-draft.ts - New: useDraft hook with save/load/clear, Draft type
- app/(tabs)/index.tsx - Integrated useDraft, auto-save effect, resume prompt effect
- __tests__/hooks/use-draft.test.ts - New: 8 TDD tests for hook
- __tests__/app/tabs/feed.test.tsx - Added 3 integration tests for draft feature
- package.json - Added @react-native-async-storage/async-storage dependency

**Verification:** tsc, lint, test (178 passed), build all pass.

**Next:** Backend API integration, Stripe SDK, or PDF generation

## 2026-01-15: Entry Tags Feature

**PRD ref:** Phase 1 Weeks 5-7, Section 3.1 (Custom tags optional), Section 3.2 step 6 (Add tags)

**Task:** Implement tag input UI for entry creation per PRD

**Decisions:**
- Tags stored as string[] in Entry (already supported by context)
- Tag input appears between date picker and Post button in caption step
- Tags displayed as removable chips with √ó button
- Tag input field: type tag and press Enter to add
- Tags auto-lowercase, duplicates prevented
- Tags included in draft auto-save (added tags field to Draft interface)
- Tags restored when resuming draft
- TDD approach: 3 tests for tag CRUD in entry context

**Files changed:**
- hooks/use-draft.ts - Added tags?: string[] field to Draft interface
- app/(tabs)/index.tsx - Added tags/tagInput state, tag input UI, updated draft save/resume, updated handleSubmit
- __tests__/app/tabs/feed.test.tsx - Added 3 TDD tests for entry tags

**Verification:** tsc, lint, test (181 passed), build all pass.

**Next:** Backend API integration, Stripe SDK, or PDF generation

## 2026-01-15: Photo Book PDF Export

**PRD ref:** Phase 1 Weeks 12-13, Section 10.3 (Export - PDF download)

**Task:** Implement actual PDF generation for photo book export (was placeholder)

**Decisions:**
- Installed expo-print for HTML-to-PDF conversion
- Generated HTML includes: title page, milestone pages, photo pages
- Each page styled with CSS: title with gradient, photos with shadows, milestone badges
- escapeHtml() prevents XSS in user content (captions, titles)
- formatDate() displays dates in Singapore locale (en-SG)
- PDF shared via expo-sharing with mimeType: application/pdf
- Premium check (canExportPdf) enforced before generation
- Empty pages check added (no export if pages.length === 0)
- TDD approach: 5 tests for PDF export flow

**Files changed:**
- contexts/photo-book-context.tsx - Added expo-print/sharing imports, generatePhotoBookHtml helper, updated exportPdf with actual implementation
- __tests__/contexts/photo-book-context.test.tsx - Added 5 TDD tests for PDF export
- package.json - Added expo-print dependency

**Verification:** tsc, lint, test (186 passed), build all pass.

**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)

## 2026-01-15: Smart Notification Frequency

**PRD ref:** Phase 1 Weeks 10-11, Section 7.3 (Smart Frequency)

**Task:** Implement smart notification frequency that adapts based on user engagement

**Decisions:**
- PromptFrequency type: "daily" | "every_2_days" | "weekly"
- Default frequency is "daily" per PRD
- Tracks consecutiveIgnoredDays counter
- recordIgnoredPrompt(): increments counter, updates frequency
- recordEntryPosted(): resets counter to 0, frequency to "daily"
- Frequency thresholds per PRD: 3+ days ‚Üí every_2_days, 7+ days ‚Üí weekly
- getScheduleInterval(): returns 1 (daily), 2 (every_2_days), or 7 (weekly)
- Helper functions calculateFrequency() and getIntervalFromFrequency()
- TDD approach: 5 new tests for smart frequency logic

**Files changed:**
- contexts/notification-context.tsx - Added PromptFrequency type, state, methods
- __tests__/contexts/notification-context.test.tsx - Added 5 TDD tests for smart frequency

**Verification:** tsc, lint, test (191 passed), build all pass.

**Next:** Integrate smart frequency with notification scheduling, Backend API, Stripe SDK, or Web Viewer (Phase 2)

## 2026-01-15: Smart Notification Frequency Integration

**PRD ref:** Phase 1 Weeks 10-11, Section 7.3 (Smart Frequency)

**Task:** Integrate smart frequency with notification scheduling and entry creation

**Decisions:**
- scheduleDailyPrompt now uses promptFrequency to determine interval
- DAILY trigger used when frequency=daily (interval=1)
- TIME_INTERVAL trigger with repeats:true for every_2_days (2 days) and weekly (7 days)
- TIME_INTERVAL doesn't support specific time of day - fires at interval after scheduling
- recordEntryPosted() called in Feed handleSubmit after entry added
- Resets frequency to daily when user posts entry (per PRD: "Resets to daily after user posts")

**Files changed:**
- contexts/notification-context.tsx - Updated scheduleDailyPrompt to use frequency interval, added promptFrequency dependency
- app/(tabs)/index.tsx - Added useNotifications import, call recordEntryPosted in handleSubmit
- __tests__/contexts/notification-context.test.tsx - Added test for interval-based scheduling, updated mock with TIME_INTERVAL
- __tests__/app/tabs/feed.test.tsx - Added mocks for expo-notifications/device, test for smart frequency integration

**Verification:** tsc, lint, test (193 passed), build all pass.

**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)

## 2026-01-15: On This Day Memories Push Notification

**PRD ref:** Phase 1 Weeks 10-11, Section 4.5 (On This Day - Push notification when memories exist)

**Task:** Implement push notification for "On This Day" memories per PRD requirement

**Decisions:**
- Added sendMemoriesNotification(count) method to NotificationContext
- Sends immediate notification (trigger: null) when memories exist
- Respects settings.memories toggle - no notification if disabled
- Uses singular/plural forms: "1 memory from previous year" vs "N memories from previous years"
- Notification data type: "memories" for future tap handling
- Feed screen sends notification once per session using hasSentMemoriesNotification ref
- Notification sent when onThisDayMemories.length > 0 and setting enabled
- TDD approach: 5 new tests for notification sending logic

**Files changed:**
- contexts/notification-context.tsx - Added sendMemoriesNotification method to interface and implementation
- app/(tabs)/index.tsx - Added effect to send memories notification on Feed mount
- __tests__/contexts/notification-context.test.tsx - Added 5 TDD tests for memories notification

**Verification:** tsc, lint, test (198 passed), build all pass.

**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)

## 2026-01-15: Milestone Reminder Push Notifications

**PRD ref:** Phase 1 Weeks 10-11, Section 7.1 (Notification Types - Milestone Reminder)

**Task:** Implement milestone reminder push notifications that fire X days before milestone date

**Decisions:**
- Added scheduleMilestoneReminder(milestoneId, title, milestoneDate, daysBefore) to NotificationContext
- Uses TIME_INTERVAL trigger with calculated seconds until reminder date
- Notification identifier: "milestone-reminder-{milestoneId}" for targeted cancellation
- cancelMilestoneReminder(milestoneId) cancels specific milestone notification
- Respects settings.milestoneReminder toggle - skips if disabled
- Does not schedule if trigger date (milestoneDate - daysBefore) is in past
- Message: "üéâ {title} is coming up!" + "{N} day(s) until this special milestone"
- Notification data includes type: "milestone_reminder" and milestoneId for tap handling
- TDD approach: 5 new tests for milestone reminder logic

**Files changed:**
- contexts/notification-context.tsx - Added scheduleMilestoneReminder, cancelMilestoneReminder methods
- __tests__/contexts/notification-context.test.tsx - Added 5 TDD tests, added cancelScheduledNotificationAsync mock

**Verification:** tsc, lint, test (203 passed), build all pass.

**Next:** Integrate milestone reminder with MilestoneContext addMilestone, Backend API, or Web Viewer (Phase 2)

## 2026-01-15: Milestone Reminder Notification Integration

**PRD ref:** Phase 1 Weeks 10-11, Section 7.1 (Milestone Reminder integration with MilestoneContext)

**Task:** Integrate milestone reminder scheduling with milestone add/complete/delete in milestones.tsx

**Decisions:**
- Integration happens at UI level (milestones.tsx) where both contexts are available
- MilestoneContext.addMilestone now returns the created Milestone (was void)
- handleAddFromTemplate: calls scheduleMilestoneReminder after addMilestone
- handleAddCustom: calls scheduleMilestoneReminder with custom title after addMilestone
- handleCompleteMilestone: calls cancelMilestoneReminder when milestone completed
- handleDeleteMilestone: calls cancelMilestoneReminder when milestone deleted
- Default REMINDER_DAYS_BEFORE = 7 (reminder 7 days before milestone)
- Handlers now async to await notification scheduling

**Files changed:**
- contexts/milestone-context.tsx - addMilestone now returns Milestone instead of void
- app/(tabs)/milestones.tsx - Added useNotifications, integrated schedule/cancel reminders in handlers
- __tests__/app/tabs/milestones.test.tsx - Added 4 TDD tests for reminder integration, added notification mocks

**Verification:** tsc, lint, test (207 passed), build all pass.

**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)

## 2026-01-15: Storage Warning Push Notifications

**PRD ref:** Phase 1 Weeks 10-11, Section 7.1 (Notification Types - Storage Warning at 80%, 90%, 100%)

**Task:** Implement storage warning push notifications that trigger when crossing storage thresholds

**Decisions:**
- Added sendStorageWarningNotification(usagePercent) to NotificationContext
- Thresholds: 80% (warning), 90% (critical), 100% (full) per PRD Section 7.1
- Storage warning is "locked on" per PRD - ignores storageWarning setting (always sends)
- Different messages for each threshold: 80%/90% = filling up, 100% = full + upgrade prompt
- Notification data type: "storage_warning" with threshold for tap handling
- Integration in Feed handleSubmit: calculates before/after percentages, sends notification on threshold crossing
- Only first threshold crossed triggers notification (prevents multiple for single upload)
- TDD approach: 6 context tests + 3 integration tests

**Files changed:**
- contexts/notification-context.tsx - Added sendStorageWarningNotification method
- app/(tabs)/index.tsx - Added threshold crossing detection in handleSubmit after addUsage
- __tests__/contexts/notification-context.test.tsx - Added 6 TDD tests for storage warning
- __tests__/app/tabs/feed.test.tsx - Added 3 integration tests for storage warning notifications

**Verification:** tsc, lint, test (216 passed), build all pass.

**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)

## 2026-01-15: Photo Book PDF Export Integration

**PRD ref:** Phase 1 Weeks 12-13, Section 10.3 (Export - PDF download)

**Task:** Connect photo-book.tsx export button to context's exportPdf method (was TODO placeholder)

**Decisions:**
- Photo-book context already had full exportPdf implementation (expo-print + expo-sharing)
- photo-book.tsx screen was not using context's exportPdf - had TODO placeholder showing "Coming Soon"
- Added exportPdf to usePhotoBook destructure
- Updated handleExport to call context's exportPdf() instead of showing placeholder alert
- TDD approach: wrote screen tests first to verify integration

**Files changed:**
- app/photo-book.tsx - Added exportPdf to destructure, updated handleExport to call it
- __tests__/app/photo-book.test.tsx - New: 4 TDD tests for photo-book screen

**Verification:** tsc, lint, test (220 passed), build all pass.

**Next:** Backend API integration, Stripe SDK, or Web Viewer (Phase 2)

## 2026-01-15: TanStack Query Foundation + API Client Abstraction

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state), API Layer preparation

**Task:** Set up TanStack Query infrastructure and API client abstraction layer

**Decisions:**
- Installed @tanstack/react-query for server state management per PRD tech stack
- Created QueryProvider wrapping entire app with configured QueryClient
- QueryClient defaults: 5min staleTime, 30min gcTime, 1 retry, refetchOnWindowFocus disabled (mobile)
- Created services/api-client.ts with typed API abstractions for all domain entities
- API client supports mock mode (default) and real backend mode via EXPO_PUBLIC_USE_MOCK_API env
- Mock implementations use in-memory storage with simulated network delay
- Four API modules: entryApi, childApi, familyApi, milestoneApi
- Generic ApiResult<T> union type for typed success/error handling
- PaginatedResponse<T> with cursor-based pagination support
- isApiError() type guard for result discrimination
- clearAllMockData() helper for test isolation
- TDD approach: 4 provider tests + 17 API client tests

**Files changed:**
- package.json - Added @tanstack/react-query dependency
- providers/query-provider.tsx - New: QueryProvider with configured QueryClient
- services/api-client.ts - New: Typed API client with mock/real implementations
- app/_layout.tsx - Added QueryProvider wrapper (outermost provider)
- __tests__/providers/query-provider.test.tsx - New: 4 TDD tests
- __tests__/services/api-client.test.ts - New: 17 TDD tests for all API operations

**Verification:** tsc, lint, test (241 passed), build all pass.

**Next:** Migrate contexts to use TanStack Query hooks, actual Stripe SDK integration, or Cloudflare Workers backend

## 2026-01-15: TanStack Query Hooks for Entries

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Create TanStack Query hooks to wrap entryApi, first step in migrating from context-based state

**Decisions:**
- Created use-entries.ts with 5 hooks: useEntries, useEntry, useCreateEntry, useUpdateEntry, useDeleteEntry
- entryKeys factory for consistent cache key management (all, lists, list, details, detail)
- useEntries supports GetEntriesParams for pagination
- useEntry has enabled: !!id to skip fetch when ID undefined
- Mutations invalidate relevant queries for automatic cache sync
- useUpdateEntry also sets detail cache directly for instant UI update
- useDeleteEntry removes detail from cache on success
- TDD approach: 7 tests covering all hooks

**Files changed:**
- hooks/use-entries.ts - New: TanStack Query hooks for entry CRUD operations
- __tests__/hooks/use-entries.test.ts - New: 7 TDD tests for all entry hooks

**Verification:** tsc, lint, test (248 passed), build all pass.

**Next:** Create similar hooks for child/family/milestone APIs, or integrate hooks with Feed screen to replace EntryContext usage

## 2026-01-15: TanStack Query Hooks for Child, Family, Milestone APIs

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Complete TanStack Query hook layer for remaining domain entities

**Decisions:**
- Created use-children.ts with 3 hooks: useChildren, useCreateChild, useUpdateChild
- Created use-family.ts with 3 hooks: useFamilyMembers, useInviteFamilyMember, useRemoveFamilyMember
- Created use-milestones.ts with 4 hooks: useMilestones, useCreateMilestone, useCompleteMilestone, useDeleteMilestone
- Same pattern as use-entries.ts: queryKeys factory, cache invalidation on mutations
- useMilestones doesn't need pagination (milestones per child are limited)
- useUpdateChild handles optional ID field from API (id?: string)
- useCompleteMilestone updates detail cache + invalidates list for instant UI
- TDD approach: 14 tests total (3 child + 3 family + 8 milestone)

**Files changed:**
- hooks/use-children.ts - New: TanStack Query hooks for child CRUD
- hooks/use-family.ts - New: TanStack Query hooks for family invites/removal
- hooks/use-milestones.ts - New: TanStack Query hooks for milestone CRUD
- __tests__/hooks/use-children.test.ts - New: 3 TDD tests
- __tests__/hooks/use-family.test.ts - New: 3 TDD tests
- __tests__/hooks/use-milestones.test.ts - New: 8 TDD tests

**Verification:** tsc, lint, test (262 passed), build all pass.

**Next:** Integrate hooks with screens to replace context usage, or Cloudflare Workers backend setup

## 2026-01-15: Camera Capture for Entry Creation

**PRD ref:** Phase 1 Weeks 5-7, Section 3.2 step 3 (Select from gallery or capture new), Section 3.3 (Secondary: Camera capture)

**Task:** Add camera capture option as secondary source for photo/video entries

**Decisions:**
- Added "source" step between type selection and caption in creation flow
- MediaSource type: "gallery" | "camera" for source selection
- Source step shows two options: Gallery (primary per PRD) and Camera (secondary)
- Uses ImagePicker.launchCameraAsync for camera capture
- Uses ImagePicker.requestCameraPermissionsAsync for camera permission
- Refactored handleTypeSelect to set step to "source" for photo/video (text skips to caption)
- Created separate handlers: handleSourceSelect, handleVideoSource, handlePhotoSource
- Created reusable asset processors: processVideoAsset, processPhotoAssets
- Camera capture also supports EXIF extraction for photos
- TDD approach: 3 tests for camera mock setup

**Files changed:**
- app/(tabs)/index.tsx - Added source selection step, refactored media flow handlers, added sourceOptions styles
- __tests__/app/tabs/feed.test.tsx - Added 3 camera tests, added expo-image-picker mock with camera support

**Verification:** tsc, lint, test (265 passed), build all pass.

**Next:** Cloudflare Workers backend setup, or additional UI polish

## 2026-01-15: TanStack Query useEntriesFlat Hook

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Add useEntriesFlat hook to enable Feed screen migration from EntryContext

**Decisions:**
- Created useEntriesFlat hook that wraps useEntries with convenience features
- Flattens paginated API response to simple Entry[] array
- Includes getOnThisDayEntries() computed from entries (same logic as EntryContext)
- Returns loading/error/success states + refetch capability
- Maintains same API shape as EntryContext for easy migration
- TDD approach: 3 new tests for flat hook (total 10 use-entries tests)

**Files changed:**
- hooks/use-entries.ts - Added useEntriesFlat hook with entries array + getOnThisDayEntries
- __tests__/hooks/use-entries.test.ts - Added 3 TDD tests for useEntriesFlat

**Verification:** tsc, lint, test (268 passed), build all pass.

**Next:** Integrate useEntriesFlat + useCreateEntry with Feed screen to replace EntryContext usage

## 2026-01-15: Feed Screen TanStack Query Migration

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Migrate Feed screen from EntryContext to TanStack Query hooks

**Decisions:**
- Replaced useEntries (context) with useEntriesFlat + useCreateEntry (TanStack Query hooks)
- useEntriesFlat provides: entries array, getOnThisDayEntries(), refetch, isFetching
- useCreateEntry.mutate() replaces addEntry() with onSuccess callback for side effects
- Removed local refreshing state - now uses isFetching from TanStack Query
- Pull-to-refresh now calls refetch() which invalidates and refetches from API
- Storage tracking, notification frequency reset, draft clear moved to onSuccess callback
- EntryContext still exists for type exports (Entry, EntryType, NewEntry)

**Files changed:**
- app/(tabs)/index.tsx - Replaced context with TanStack Query hooks, updated handlers
- __tests__/app/tabs/feed.test.tsx - Added 3 TDD integration tests for TanStack Query

**Verification:** tsc, lint, test (271 passed), build all pass.

**Next:** Continue backend API integration, remaining screens migration, or Cloudflare Workers setup

## 2026-01-15: Milestones Screen TanStack Query Migration

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Migrate Milestones screen from MilestoneContext to TanStack Query hooks

**Decisions:**
- Created useMilestonesFlat hook similar to useEntriesFlat for easier consumption
- useMilestonesFlat provides: milestones, upcomingMilestones, completedMilestones, refetch, loading states
- Replaced useMilestones (context) with useMilestonesFlat + useCreateMilestone + useCompleteMilestone + useDeleteMilestone
- Mutation handlers use onSuccess callbacks for notification scheduling/cancellation (PRD 7.1)
- Updated test wrapper from MilestoneProvider to QueryClientProvider
- Tests use milestoneApi.createMilestone() directly instead of WithMilestone helper component
- MilestoneContext still exists for type exports (Milestone, MilestoneTemplate, MILESTONE_TEMPLATES)

**Files changed:**
- hooks/use-milestones.ts - Added useMilestonesFlat hook
- app/(tabs)/milestones.tsx - Replaced context with TanStack Query hooks, updated handlers
- __tests__/hooks/use-milestones.test.ts - Added 3 TDD tests for useMilestonesFlat
- __tests__/app/tabs/milestones.test.tsx - Updated to use QueryClientProvider, use addTestMilestone helper

**Verification:** tsc, lint, test (274 passed), build all pass.

**Next:** Continue remaining screens migration (Search, Settings) or Cloudflare Workers backend setup

## 2026-01-15: Search Screen TanStack Query Migration

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Migrate Search screen from EntryContext to TanStack Query hooks

**Decisions:**
- Replaced useEntries (context) with useEntriesFlat (TanStack Query hook)
- useEntriesFlat provides entries array for client-side filtering
- Search filtering logic unchanged (caption + tags text search)
- Type filter logic unchanged (all/photo/video/text)
- Tests updated from EntryProvider to QueryClientProvider wrapper
- Tests use entryApi.createEntry() directly for setup instead of context helper
- Added 2 new tests: loading state, tag search

**Files changed:**
- app/(tabs)/search.tsx - Replaced context with useEntriesFlat hook
- __tests__/app/tabs/search.test.tsx - Updated to use QueryClientProvider, added 2 tests

**Verification:** tsc, lint, test (276 passed), build all pass.

**Next:** Settings screen TanStack Query migration (family, child hooks) or Cloudflare Workers backend setup

## 2026-01-15: Settings Screen TanStack Query Migration

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Migrate Settings screen from context-based state to TanStack Query hooks

**Decisions:**
- Created useChildFlat hook wrapping useChildren + useUpdateChild with convenience features
- useChildFlat returns first child (MVP single-child support) or null if none exists
- Created useFamilyMembersFlat hook wrapping useFamilyMembers + mutations
- useFamilyMembersFlat returns familyMembers array with inviteFamilyMember/removeFamilyMember helpers
- Settings screen now uses useChildFlat and useFamilyMembersFlat from hooks instead of contexts
- ChildContext and FamilyContext still exist for type exports (backward compatibility)
- Tests updated to use QueryClientProvider wrapper and childApi.createChild for setup
- TDD approach: 6 new tests for flat hooks + 2 new tests for settings

**Files changed:**
- hooks/use-children.ts - Added useChildFlat hook
- hooks/use-family.ts - Added useFamilyMembersFlat hook
- app/(tabs)/settings.tsx - Replaced context imports with TanStack Query hooks
- __tests__/hooks/use-children.test.ts - Added 3 tests for useChildFlat
- __tests__/hooks/use-family.test.ts - Added 3 tests for useFamilyMembersFlat
- __tests__/app/tabs/settings.test.tsx - Updated to QueryClientProvider, use API for test data

**Verification:** tsc, lint, test (284 passed), build all pass.

**Next:** Cloudflare Workers backend setup or additional screens migration (onboarding screens)

## 2026-01-15: Onboarding Screens TanStack Query Migration

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Migrate onboarding screens from context-based state to TanStack Query hooks

**Decisions:**
- add-child.tsx: replaced useChild().setChild with useCreateChild mutation
- select-culture.tsx: replaced useChild().updateChild with useChildFlat + useUpdateChild mutation
- invite-family.tsx: replaced useFamily().inviteFamilyMember with useInviteFamilyMember mutation
- All mutations use onSuccess callback for navigation after successful API call
- Tests updated to use QueryClientProvider wrapper and callback-style router mocks
- Type exports still come from contexts (backward compatibility)

**Files changed:**
- app/(onboarding)/add-child.tsx - useCreateChild mutation replaces context setChild
- app/(onboarding)/select-culture.tsx - useChildFlat + useUpdateChild replaces context updateChild
- app/(onboarding)/invite-family.tsx - useInviteFamilyMember replaces context inviteFamilyMember
- __tests__/app/onboarding/add-child.test.tsx - Updated with QueryClientProvider, 3 new TanStack Query tests

**Verification:** tsc, lint, test (287 passed), build all pass.

**Next:** Cloudflare Workers backend setup or Stripe SDK integration

## 2026-01-15: Milestones Screen TanStack Query Child Hook Fix

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Fix milestones.tsx to use useChildFlat hook from TanStack Query instead of useChild context, and use actual child.id instead of hardcoded "child-1"

**Decisions:**
- Replaced useChild (context) import with useChildFlat (TanStack Query hook)
- Changed child guard from `if (!child)` to `if (!child?.id)` for API requirement
- Removed hardcoded "child-1" values, now uses child.id from API response
- Updated test wrapper to remove ChildProvider, use QueryClientProvider only
- Tests now create child via childApi.createChild before rendering
- Test helper createTestChild returns `{ id: string }` for guaranteed ID type
- Tests wait for cultural templates (e.g., "Full Month" for Chinese) to confirm child loaded

**Files changed:**
- app/(tabs)/milestones.tsx - useChildFlat replaces useChild, child.id replaces "child-1"
- __tests__/app/tabs/milestones.test.tsx - Updated test wrapper, createTestChild helper, all tests use API child

**Verification:** tsc, lint, test (288 passed), build all pass.

**Next:** Cloudflare Workers backend setup or Stripe SDK integration

## 2026-01-15: Entry Detail Screen TanStack Query Migration

**PRD ref:** Phase 1 Technical Architecture (TanStack Query for server state)

**Task:** Migrate entry detail screen from EntryContext to TanStack Query hooks

**Decisions:**
- Replaced useEntries (context) with useEntry, useUpdateEntry, useDeleteEntry (TanStack Query hooks)
- useEntry provides: data (entry), isLoading, isError states
- Added loading state with ActivityIndicator while fetching
- Mutations use onSuccess callbacks for navigation/modal state changes
- useEffect syncs editCaption state with entry when entry loads
- EntryContext no longer imported - types still available from contexts
- Tests updated to use QueryClientProvider wrapper and entryApi for setup
- Added 2 new TanStack Query integration tests

**Files changed:**
- app/entry/[id].tsx - Replaced context with TanStack Query hooks, added loading state
- __tests__/app/entry/entry-detail.test.tsx - Updated to QueryClientProvider, createTestEntry helper

**Verification:** tsc, lint, test (290 passed), build all pass.

**Next:** Cloudflare Workers backend setup or Stripe SDK integration

## 2026-01-15: Feed Infinite Scroll Implementation

**PRD ref:** Phase 1 Weeks 5-7, Section 4.1 (Infinite scroll with pagination)

**Task:** Implement infinite scroll for Feed using TanStack Query's useInfiniteQuery

**Decisions:**
- Created useInfiniteEntries hook using TanStack Query's useInfiniteQuery
- Uses cursor-based pagination from API client (cursor, hasMore fields)
- getNextPageParam returns cursor when hasMore=true, undefined otherwise
- Flattens all pages into single entries array via flatMap
- Feed screen updated: useEntriesFlat -> useInfiniteEntries
- FlatList onEndReached triggers fetchNextPage when hasNextPage && !isFetchingNextPage
- onEndReachedThreshold=0.5 (fetch when 50% from bottom)
- LoadingFooter component shows ActivityIndicator during page load
- RefreshControl refreshing excludes isFetchingNextPage to avoid spinner during pagination
- Default page limit: 20 entries per page

**Files changed:**
- hooks/use-entries.ts - Added useInfiniteEntries hook with useInfiniteQuery
- app/(tabs)/index.tsx - Updated to useInfiniteEntries, added onEndReached/ListFooterComponent/loadingFooter styles
- __tests__/hooks/use-entries.test.ts - Added 4 TDD tests for useInfiniteEntries
- __tests__/app/tabs/feed.test.tsx - Added 3 TDD tests for infinite scroll integration

**Verification:** tsc, lint, test (297 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: Milestone Countdown Feature

**PRD ref:** Phase 1 Weeks 8-9, Section 5.3 (Milestone UI - Upcoming milestones with countdown)

**Task:** Add countdown display to upcoming milestone cards

**Decisions:**
- Created getCountdownText() helper function for human-readable countdown
- Calculates days between today and milestone date
- Output: "Today" (0 days), "Tomorrow" (1 day), "in N days" (N>1), "N days ago" (past)
- Countdown appended after date: "15/01/2026 ¬∑ in 10 days"
- Completed milestones unchanged (show "Celebrated: date")
- TDD approach: 3 tests written first

**Files changed:**
- app/(tabs)/milestones.tsx - Added getCountdownText() function, updated milestone date display
- __tests__/app/tabs/milestones.test.tsx - Added 3 TDD tests for countdown feature

**Verification:** tsc, lint, test (300 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: Auth Token Persistence with expo-secure-store

**PRD ref:** Phase 1 Weeks 3-4, Section 1.2 (Token Storage)

**Task:** Implement expo-secure-store for auth session persistence per PRD requirement

**Decisions:**
- Installed expo-secure-store for secure token storage (PRD Section 1.2)
- Created StoredSession interface: user, hasCompletedOnboarding, deletionScheduledAt
- AUTH_SESSION_KEY constant for storage key consistency
- Session restored from SecureStore on app mount (restoreSession in useEffect)
- signIn persists session immediately after setting user state
- signOut clears SecureStore via deleteItemAsync
- completeOnboarding updates stored session with onboarding flag
- requestAccountDeletion/cancelAccountDeletion also persist deletion state
- persistSession helper centralizes storage logic
- TDD approach: 4 new tests for storage persistence

**Files changed:**
- contexts/auth-context.tsx - Added SecureStore import, StoredSession interface, persistSession helper, updated all auth methods to persist
- __tests__/contexts/auth-context.test.tsx - Added expo-secure-store mock, 4 new persistence tests
- package.json - Added expo-secure-store dependency

**Verification:** tsc, lint, test (304 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: Magic Link Sign-in UI

**PRD ref:** Phase 1 Weeks 3-4, Section 1.1 (Authentication Methods)

**Task:** Implement proper sign-in screen with magic link email input and OAuth buttons

**Decisions:**
- Replaced demo button with full sign-in UI per PRD Section 1.1
- Magic link flow: email input ‚Üí "Send Magic Link" button ‚Üí success screen with "Check your email"
- Email validation with regex, shows error for invalid format
- Button disabled when email empty (visual opacity 0.5)
- OAuth buttons: "Continue with Google", "Continue with Apple" (mock implementations)
- 2-step flow: input step shows form, sent step shows confirmation message
- Auto-sign-in after magic link sent (demo behavior until backend ready)
- KeyboardAvoidingView + ScrollView for proper keyboard handling
- Terms text at bottom per legal requirements
- Theme system integration: dynamic colors for light/dark mode
- TDD approach: 8 tests written first

**Files changed:**
- app/(auth)/sign-in.tsx - Full sign-in UI with email input, validation, OAuth buttons
- __tests__/app/auth/sign-in.test.tsx - New: 8 TDD tests for sign-in screen

**Verification:** tsc, lint, test (312 passed), build all pass. UI verified via Chrome MCP.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: EAS Build Configuration Setup

**PRD ref:** Phase 1 Week 14 (Launch - App Store + Play Store submission)

**Task:** Set up EAS Build configuration for development, preview, and production builds

**Decisions:**
- Created eas.json with 3 build profiles: development, preview, production
- development: simulator builds with dev client, mock API enabled
- preview: internal distribution for testing, mock API enabled
- production: auto-increment version, app-bundle for Android, mock API disabled
- Submit config uses env vars for Apple credentials (APPLE_ID, ASC_APP_ID, APPLE_TEAM_ID)
- Android submit uses Google service account JSON file
- app.json updated with iOS bundleIdentifier and Android package: sg.littlejourney.app
- Added iOS infoPlist with camera/photo library usage descriptions
- Added Android permissions for camera and media access
- App name changed to "Little Journey" (display name)
- Added runtimeVersion policy: appVersion for EAS Update compatibility
- Added EAS Update config with placeholder projectId
- Added EAS CLI (eas-cli) as dev dependency
- Added npm scripts: build:dev, build:preview, build:prod, submit:ios, submit:android, update

**Files changed:**
- eas.json - New: EAS Build configuration with 3 profiles + submit config
- app.json - Added bundleIdentifier, package, permissions, infoPlist, runtimeVersion, updates config
- package.json - Added eas-cli dev dependency, 6 new npm scripts for EAS

**Verification:** tsc, lint, test (312 passed), build all pass.

**Next:** Run `eas init` to get actual projectId, Cloudflare Workers backend setup, or Stripe SDK integration

## 2026-01-15: Resend Invite Link Feature

**PRD ref:** Phase 1 Weeks 10-11, Section 6.4 (Link Management - Parent can resend link)

**Task:** Add "Resend" action for pending family member invites per PRD requirement

**Decisions:**
- Added familyApi.resendInvite() method to API client (mock updates invitedAt timestamp)
- Added useResendInvite() hook wrapping API call with cache invalidation
- Added resendInvite to useFamilyMembersFlat hook for component consumption
- Settings screen now shows "Resend" button next to pending family members only
- Button uses PRIMARY_COLOR for visual consistency with other actions
- Remove button still shown for all members (pending and accepted)
- Buttons laid out horizontally with gap between Resend and Remove
- TDD approach: 3 tests for family member management

**Files changed:**
- services/api-client.ts - Added resendInvite() method
- hooks/use-family.ts - Added useResendInvite hook, updated useFamilyMembersFlat
- app/(tabs)/settings.tsx - Added Resend button for pending members, new styles
- __tests__/app/tabs/settings.test.tsx - Added 3 TDD tests for family member UI

**Verification:** tsc, lint, test (315 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: Photo Book Birthday Prompt

**PRD ref:** Phase 1 Weeks 12-13 (Polish), Section 10.1 (Trigger - System prompt at child's first birthday)

**Task:** Implement photo book birthday prompt notification when child turns 1 year old

**Decisions:**
- Added sendPhotoBookBirthdayPrompt(childName) method to NotificationContext
- Notification title includes child name and "birthday", body prompts photo book creation
- Notification data type: "photo_book_prompt" for future tap handling
- Feed screen checks child.dateOfBirth on mount, sends notification if today is first birthday
- Uses hasSentBirthdayPrompt ref to prevent duplicate notifications per session
- Checks both nickname and name for notification title (nickname preferred if set)
- TDD approach: 3 context tests + 2 integration tests

**Files changed:**
- contexts/notification-context.tsx - Added sendPhotoBookBirthdayPrompt method to interface and implementation
- app/(tabs)/index.tsx - Added birthday check effect, added hasSentBirthdayPrompt ref
- __tests__/contexts/notification-context.test.tsx - Added 3 TDD tests for birthday prompt
- __tests__/app/tabs/feed.test.tsx - Added 2 integration tests for birthday prompt

**Verification:** tsc, lint, test (320 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: Entry Attribution Display ("Posted by")

**PRD ref:** Phase 1 Weeks 5-7, Section 4.2 (Entry Card Display - "Posted by" attribution), Section 3.6 (Entry Ownership)

**Task:** Implement "Posted by" attribution display on entry cards per PRD requirement

**Decisions:**
- Added `name` optional field to User interface for display name
- Added `createdByName` field to Entry interface (denormalized for display efficiency)
- EntryCard shows "Posted by [name]" between caption and date when available
- Feed passes user.id and user.name (or email prefix fallback) when creating entries
- Attribution styled with textSecondary color, 12px font size
- Date and attribution in horizontal flex row layout
- TDD approach: 3 tests for API entry attribution

**Files changed:**
- contexts/auth-context.tsx - Added name field to User interface
- contexts/entry-context.tsx - Added createdByName field to Entry interface
- app/(tabs)/index.tsx - Added useAuth, passed createdBy/createdByName in createEntry, EntryCard shows attribution
- __tests__/app/tabs/feed.test.tsx - Added 3 TDD tests for entry attribution

**Verification:** tsc, lint, test (323 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: Family Activity Push Notification

**PRD ref:** Phase 1 Weeks 10-11, Section 7.1 (Notification Types - Family Activity on comment/reaction)

**Task:** Implement family activity push notifications for comments and reactions from family members

**Decisions:**
- Added sendFamilyActivityNotification(activityType, memberName, preview?) to NotificationContext
- activityType: "comment" | "reaction" per PRD family activity triggers
- Comment notifications show üí¨ emoji with member name and preview (truncated to 50 chars)
- Reaction notifications show ‚ù§Ô∏è emoji with member name
- Respects settings.familyActivity toggle - no notification if disabled
- Notification data type: "family_activity" with activityType for tap handling
- TDD approach: 5 tests written first

**Files changed:**
- contexts/notification-context.tsx - Added sendFamilyActivityNotification method to interface and implementation
- __tests__/contexts/notification-context.test.tsx - Added 5 TDD tests for family activity notification

**Verification:** tsc, lint, test (328 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: Upload Rate Limiting

**PRD ref:** Phase 1 Weeks 12-13, Section 13.2 (Rate Limiting)

**Task:** Implement client-side upload rate limiting per PRD requirement (50/hour, 200/day)

**Decisions:**
- Created useRateLimit hook using AsyncStorage for persistence
- UploadRecord type with timestamp for tracking upload history
- HOURLY_LIMIT = 50, DAILY_LIMIT = 200 per PRD Section 13.2
- canUpload boolean computed from current counts vs limits
- rateLimitMessage returns user-friendly message when limit reached
- recordUpload() adds timestamp and auto-cleans entries >24h old
- Integrated into Feed screen: blocks photo/video at type selection step
- Records upload on successful entry creation (media uploads only)
- TDD approach: 9 hook tests + 3 integration tests

**Files changed:**
- hooks/use-rate-limit.ts - New: useRateLimit hook with canUpload, recordUpload, rateLimitMessage
- app/(tabs)/index.tsx - Integrated rate limit check in handleTypeSelect, recordUpload in handleSubmit
- __tests__/hooks/use-rate-limit.test.ts - New: 9 TDD tests for hook
- __tests__/app/tabs/feed.test.tsx - Added 3 integration tests for rate limiting

**Verification:** tsc, lint, test (340 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: Auth API and Token Management

**PRD ref:** Phase 1, Section 1.2 (Token Storage), API Layer architecture

**Task:** Implement auth token management for API client integration readiness

**Decisions:**
- Created services/auth-api.ts for auth token handling (PRD Section 1.2)
- In-memory token (currentToken) for synchronous access in API calls
- SecureStore persistence for token survival across app restarts
- getAuthHeaders() returns Authorization header or empty object
- authApi includes: signIn, signOut, getCurrentUser, requestMagicLink, verifyMagicLink
- Mock mode auto-stores token on sign in, clears on sign out
- Updated api-client.ts to spread getAuthHeaders() into all fetch calls
- All 4 APIs (entry, child, family, milestone) now include auth headers
- TDD approach: 11 new tests for auth-api

**Files changed:**
- services/auth-api.ts - New: Token management + auth API endpoints
- services/api-client.ts - Added getAuthHeaders import, spread auth headers in all fetch calls
- __tests__/services/auth-api.test.ts - New: 11 TDD tests

**Verification:** tsc, lint, test (351 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: Privacy Policy and Terms of Service Links

**PRD ref:** Section 17 (Legal & Compliance), LEGAL-001, LEGAL-002

**Task:** Add Privacy Policy and Terms of Service links to Settings screen

**Decisions:**
- Added expo-linking import for opening external URLs
- Created Legal section between Data & Privacy and Account sections
- Privacy Policy link opens https://littlejourney.sg/privacy-policy
- Terms of Service link opens https://littlejourney.sg/terms-of-service
- Consistent styling with other settings rows (flexbox, arrow indicator)
- Dynamic colors using theme system for light/dark mode support
- TDD approach: 5 tests for Legal section (render + tap handling)

**Files changed:**
- app/(tabs)/settings.tsx - Added expo-linking import, Legal section with links, styles
- __tests__/app/tabs/settings.test.tsx - Added expo-linking mock, 5 TDD tests for Legal section

**Verification:** tsc, lint, test (356 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-15: PRD Items Status Sync

**PRD ref:** All categories - Progress tracking sync

**Task:** Update prd-items.json to reflect actual implementation status based on progress.txt

**Decisions:**
- Reviewed progress.txt to identify all implemented features
- Updated 71 items from `passes: false` to `passes: true`
- Total now passing: 73 (was 2)
- Items marked passing: AUTH-004/005, ONBOARD-001-006, CHILD-001-003, ENTRY-001-016, FEED-001-008, MILESTONE-001-008, SHARE-001/008/009, NOTIF-001-008, SEARCH-001/004/006, VIDEO-003, EXPORT-001-004, DATA-001-004, PAY-001/005/007, MOBILE-002-004
- Items remaining false: features requiring backend (OAuth, Web Viewer), payment integrations (Stripe, PayNow, GrabPay), semantic search (AI), offline handling, analytics

**Files changed:**
- prd-items.json - Updated 71 items to passes: true

**Verification:** tsc, lint, test (356 passed), build all pass.

**Next:** Cloudflare Workers backend setup, Stripe SDK integration, or Web Viewer (Phase 2)

## 2026-01-16: Single Child Limit (MVP) - CHILD-004

**PRD ref:** Phase 1, Section 2 (Child Management), CHILD-004

**Task:** Implement single child limit UI enforcement for MVP per PRD requirement

**Decisions:**
- Added "Add Child" button to Child Profile section in Settings
- When no child exists: button shown with alert directing to onboarding
- When child exists: button shows "Add Another Child (Coming Soon)" with disabled state
- Tapping disabled button shows MVP limit alert explaining single-child limitation
- Button uses accessibilityState.disabled for proper accessibility
- Fixed pre-existing flaky milestone countdown tests (timezone issues)
- TDD approach: 3 new tests for single child limit feature

**Files changed:**
- app/(tabs)/settings.tsx - Added Add Child button with MVP limit enforcement, styles
- __tests__/app/tabs/settings.test.tsx - Added 3 TDD tests for CHILD-004
- __tests__/app/tabs/milestones.test.tsx - Fixed flaky countdown tests (timezone issues)
- prd-items.json - Updated CHILD-004 to passes: true

**Verification:** tsc, lint, test (359 passed), build all pass.

**Next:** Continue remaining PRD items: backend integration, Stripe SDK, or Web Viewer (Phase 2)

## 2026-01-16: Date Range Filter for Search (SEARCH-003)

**PRD ref:** Phase 1, Section 8 (Search & Discovery), SEARCH-003

**Task:** Implement date range filter for Search screen per PRD requirement

**Decisions:**
- Added DateRange interface (year + month) for month-based filtering
- Added month selector modal with scrollable list of last 24 months
- Filter chip shows "Date Range" when no filter, "Jan 2025" format when active
- Filtering logic checks entry.date against selected year/month
- Modal has Apply (sets filter) and Clear (removes filter) buttons
- Month options generated dynamically via generateMonthOptions()
- isInDateRange() helper compares entry date to selected month
- TDD approach: 4 new tests for date range filter

**Files changed:**
- app/(tabs)/search.tsx - Added DateRange state, modal UI, filter integration, styles
- __tests__/app/tabs/search.test.tsx - Added 4 TDD tests for date range filter
- prd-items.json - Updated SEARCH-003 to passes: true

**Verification:** tsc, lint, test (363 passed), build all pass.

**Next:** Continue remaining PRD items: SEARCH-005 (milestone filter), FEEDBACK-001, or backend integration

## 2026-01-16: Milestone Filter for Search (SEARCH-005)

**PRD ref:** Phase 1, Section 8 (Search & Discovery), SEARCH-005

**Task:** Implement milestone filter for Search screen per PRD requirement

**Decisions:**
- Added `milestoneId` optional field to Entry interface to link entries to milestones
- Added "Milestones" filter chip to search screen filter row
- When Milestones filter active, only entries with milestoneId are shown
- Milestones filter toggles on/off (independent of type filter)
- Filter row now uses horizontal ScrollView for overflow handling
- SearchResultCard shows ‚≠ê indicator next to caption for milestone entries
- Combines with existing filters (type, date range, search query)
- TDD approach: 4 new tests for milestone filter functionality

**Files changed:**
- contexts/entry-context.tsx - Added milestoneId field to Entry interface
- app/(tabs)/search.tsx - Added MilestoneFilter type, milestoneFilter state, filter chip, milestone badge on result cards
- __tests__/app/tabs/search.test.tsx - Added 4 TDD tests for milestone filter
- prd-items.json - Updated SEARCH-005 to passes: true

**Verification:** tsc, lint, test (367 passed), build all pass.

**Next:** Continue remaining PRD items: FEEDBACK-001 (in-app feedback), or backend integration

## 2026-01-16: In-App Feedback Feature (FEEDBACK-001)

**PRD ref:** Phase 1, Section 16 (User Feedback), FEEDBACK-001

**Task:** Implement in-app feedback submission feature per PRD requirement

**Decisions:**
- Added "Feedback" section to Settings between Legal and Account sections
- Feedback button opens modal with multiline text input
- Submit button disabled until user enters text (validation)
- On submit: logs feedback, shows thank you Alert, closes modal
- Handler ready for backend API integration (console.log placeholder)
- Modal follows existing settings modal patterns (pageSheet, KeyboardAvoidingView)
- TDD approach: 5 new tests for feedback UI and submission flow

**Files changed:**
- app/(tabs)/settings.tsx - Added feedback modal state, feedbackText state, handleSubmitFeedback handler, Feedback section UI, feedback modal UI, styles
- __tests__/app/tabs/settings.test.tsx - Added 5 TDD tests for FEEDBACK-001
- prd-items.json - Updated FEEDBACK-001 to passes: true

**Verification:** tsc, lint, test (372 passed), build all pass.

**Next:** Continue remaining PRD items: backend integration (AUTH, SHARE, VIDEO, PAY), analytics, or Web Viewer (Phase 2)

## 2026-01-16: Edit Other Parent's Entry (ENTRY-013)

**PRD ref:** Phase 1, Section 3.6 (Entry Ownership), ENTRY-013

**Task:** Implement ability for any parent to edit any entry with "Edited by" attribution

**Decisions:**
- Added updatedByName field to Entry interface for "Edited by" display name
- Entry detail shows "Edited by [Name]" when updatedBy differs from createdBy
- Styled as italic text next to date with dot separator
- handleSaveEdit passes current user id and display name to mutation
- User display name derived from: user.name > email prefix > "Unknown User"
- Any parent can edit any entry (no ownership restrictions per PRD)
- TDD approach: 3 new tests for "Edited by" indicator logic

**Files changed:**
- contexts/entry-context.tsx - Added updatedByName field to Entry interface
- app/entry/[id].tsx - Added useAuth, "Edited by" indicator UI, metaRow/editedBy styles, pass user info in handleSaveEdit
- __tests__/app/entry/entry-detail.test.tsx - Added AuthProvider wrapper, expo-secure-store mock, 3 TDD tests for ENTRY-013
- prd-items.json - Updated ENTRY-013 to passes: true

**Verification:** tsc, lint, test (375 passed), build all pass.

**Next:** Continue remaining PRD items: backend integration (AUTH, SHARE, VIDEO, PAY), analytics, or Web Viewer (Phase 2)

## 2026-01-16: Background/Foreground Transition (MOBILE-005)

**PRD ref:** Phase 1, Section 14 (Mobile Experience), MOBILE-005

**Task:** Implement proper app state handling for background/foreground transitions

**Decisions:**
- Created useAppState hook to track AppState changes (active, background, inactive)
- Hook provides onForeground and onBackground callbacks for state transitions
- onForeground only triggers when returning from background (not from inactive)
- Created AppStateProvider that integrates with TanStack Query
- Provider invalidates stale queries when app returns from foreground
- This ensures data refresh after returning from background
- Expo Router already preserves navigation state across background transitions
- TDD approach: 7 new tests for useAppState hook

**Files changed:**
- hooks/use-app-state.ts - New hook for tracking app state transitions
- providers/app-state-provider.tsx - New provider integrating with QueryClient
- app/_layout.tsx - Added AppStateProvider to provider tree
- __tests__/hooks/use-app-state.test.ts - 7 TDD tests for MOBILE-005
- prd-items.json - Updated MOBILE-005 to passes: true

**Verification:** tsc, lint, test (382 passed), build all pass.

**Next:** Continue remaining PRD items: backend integration (AUTH, SHARE, VIDEO, PAY), MOBILE-006 (offline), analytics

## 2026-01-16: Offline Handling (MOBILE-006)

**PRD ref:** Phase 1, Section 14 (Mobile Experience), MOBILE-006

**Task:** Implement graceful offline handling with cached data display and offline banner

**Decisions:**
- Installed @react-native-community/netinfo for cross-platform network status detection
- Created useNetworkStatus hook to track online/offline state with callbacks
- Created OfflineBanner component displayed globally when offline
- Banner shows "You are offline" title + "Viewing cached data" subtitle
- Banner styled with warning colors (orange bg, dark text) for visibility
- Uses useSafeAreaInsets for proper positioning below status bar
- Integrated OfflineBanner in RootLayoutNav for global visibility
- TanStack Query's cache already provides offline data access (no changes needed)
- Added react-native-safe-area-context mock to jest.setup.js
- TDD approach: 7 tests for useNetworkStatus hook, 4 tests for OfflineBanner component

**Files changed:**
- package.json - Added @react-native-community/netinfo dependency
- hooks/use-network-status.ts - New hook for network status tracking
- components/offline-banner.tsx - New component for offline notification banner
- app/_layout.tsx - Integrated OfflineBanner in root layout
- jest.setup.js - Added react-native-safe-area-context mock
- __tests__/hooks/use-network-status.test.ts - 7 TDD tests for hook
- __tests__/components/offline-banner.test.tsx - 4 TDD tests for banner component
- prd-items.json - Updated MOBILE-006 to passes: true

**Verification:** tsc, lint, test (393 passed), build all pass.

**Next:** Continue remaining PRD items: backend integration (AUTH, SHARE, VIDEO, PAY), MOBILE-001 (app launch perf), analytics

## 2026-01-16: Sentry Error Tracking (ANALYTICS-002)

**PRD ref:** Phase 1, Section 18 (Analytics), ANALYTICS-002

**Task:** Implement Sentry error tracking for capturing errors with context and stack traces

**Decisions:**
- Installed @sentry/react-native for React Native error tracking
- Created services/sentry.ts with typed API: initSentry, captureError, setUserContext, clearUserContext, addBreadcrumb, captureMessage
- Sentry DSN loaded from: Constants.expoConfig.extra.sentryDsn OR EXPO_PUBLIC_SENTRY_DSN env var
- initSentry() called at module level in _layout.tsx (earliest possible)
- enableInDev option allows testing in development (disabled by default)
- User context auto-set on auth state change via RootLayoutNav effect
- Navigation breadcrumbs auto-added when route segments change
- Added @sentry/react-native/expo plugin to app.json for native integration
- TDD approach: 13 tests for Sentry service

**Files changed:**
- package.json - Added @sentry/react-native dependency
- services/sentry.ts - New: Sentry initialization and error tracking API
- app/_layout.tsx - Integrated Sentry init, user context sync, navigation breadcrumbs
- app.json - Added @sentry/react-native/expo plugin with org/project config
- __tests__/services/sentry.test.ts - New: 13 TDD tests for Sentry service
- prd-items.json - Updated ANALYTICS-002 to passes: true

**Verification:** tsc, lint, test (406 passed), build all pass.

**Next:** Continue remaining PRD items: ANALYTICS-001 (PostHog events), MOBILE-001 (app launch perf), backend integration

## 2026-01-16: PostHog Analytics Integration (ANALYTICS-001)

**PRD ref:** Phase 1, Section 18 (Analytics), ANALYTICS-001

**Task:** Implement PostHog analytics for core event tracking per PRD requirement

**Decisions:**
- Installed posthog-react-native for React Native event tracking
- Created services/analytics.ts with typed API similar to Sentry service pattern
- AnalyticsEvent enum for type-safe event names: signup_completed, entry_created, etc.
- initAnalytics() called at module level in _layout.tsx (earliest possible)
- PostHog API key loaded from: Constants.expoConfig.extra.posthogApiKey OR EXPO_PUBLIC_POSTHOG_API_KEY env var
- enableInDev option allows testing in development (disabled by default)
- identifyUser() called on auth state change for user identification
- resetUser() called on logout to clear PostHog session
- trackScreenView() called on navigation segment change for automatic screen tracking
- signup_completed tracked in sign-in.tsx after magic link/OAuth sign-in
- entry_created tracked in Feed handleSubmit with properties: type, hasCaption, hasMedia, tagCount
- PostHogEventProperties type from @posthog/core for type-safe properties
- TDD approach: 13 tests for analytics service

**Files changed:**
- package.json - Added posthog-react-native dependency
- services/analytics.ts - New: PostHog initialization and event tracking API
- app/_layout.tsx - Integrated analytics init, identifyUser/resetUser on auth, trackScreenView on navigation
- app/(auth)/sign-in.tsx - Track signup_completed on sign-in
- app/(tabs)/index.tsx - Track entry_created in handleSubmit onSuccess
- __tests__/services/analytics.test.ts - New: 13 TDD tests for analytics service
- prd-items.json - Updated ANALYTICS-001 to passes: true

**Verification:** tsc, lint, test (419 passed), build all pass.

**Next:** Continue remaining PRD items: MOBILE-001 (app launch perf), backend integration (AUTH, SHARE, VIDEO, PAY), Web Viewer (Phase 2)

## 2026-01-16: App Launch Performance Optimization (MOBILE-001)

**PRD ref:** Phase 1, Section 14 (Mobile Experience), MOBILE-001

**Task:** Optimize app launch to be usable within 3 seconds per PRD requirement

**Decisions:**
- Removed 4 migrated context providers no longer needed: ChildProvider, EntryProvider, FamilyProvider, MilestoneProvider
- These contexts were migrated to TanStack Query hooks but providers were still being rendered
- Reduced provider nesting from 14 levels to 10 levels
- Deferred Sentry and PostHog initialization to after first render using requestAnimationFrame
- Previous: initSentry/initAnalytics called at module load (blocking)
- Now: called in useEffect after initial render (non-blocking)
- Migrated Feed screen's useChild from context to useChildFlat TanStack Query hook

**Files changed:**
- app/_layout.tsx - Removed 4 unused context providers, deferred analytics init to useEffect
- app/(tabs)/index.tsx - Replaced useChild context with useChildFlat hook
- prd-items.json - Updated MOBILE-001 to passes: true

**Verification:** tsc, lint, test (419 passed), build all pass.

**Next:** Continue remaining PRD items: backend integration (AUTH, SHARE, VIDEO, PAY), Web Viewer (Phase 2)


## 2026-01-16: Search Relevance Ordering (SEARCH-007)

**PRD ref:** Phase 1, Section 9 (Search & Discovery), SEARCH-007

**Task:** Implement relevance-ordered search results per PRD requirement

**Decisions:**
- Created utils/search-relevance.ts with scoring algorithm
- Scoring weights: exact caption match (100), caption start (50), word boundary (30), caption contains (15), tag exact (20), tag contains (10)
- sortByRelevance() filters entries with zero relevance and sorts by score descending
- Stable sort: maintains original order for equal scores
- Integrated into search.tsx filteredEntries useMemo - replaces simple filter with relevance sort
- TDD approach: 17 tests for search-relevance utility, 2 integration tests in search.test.tsx

**Files changed:**
- utils/search-relevance.ts - New: relevance scoring algorithm and sortByRelevance function
- app/(tabs)/search.tsx - Integrated sortByRelevance into filteredEntries logic
- __tests__/utils/search-relevance.test.ts - New: 17 TDD tests for relevance scoring
- __tests__/app/tabs/search.test.tsx - Added 2 integration tests for relevance ordering
- prd-items.json - Updated SEARCH-007 to passes: true

**Verification:** tsc, lint, test (438 passed), build all pass.

**Next:** Continue remaining PRD items: backend integration (AUTH, SHARE, VIDEO, PAY), SEARCH-002 (semantic search), Web Viewer (Phase 2)

## 2026-01-16: Google OAuth Authentication (AUTH-002)

**PRD ref:** Phase 1, Section 1 (Authentication), AUTH-002

**Task:** Implement Google OAuth authentication using expo-auth-session

**Decisions:**
- Installed expo-auth-session and expo-crypto for OAuth flow
- Created hooks/use-google-auth.ts with full OAuth flow using expo-auth-session/providers/google
- Hook returns signIn function, isLoading state, and error state
- onSuccess callback receives GoogleAuthResult with accessToken, idToken, etc.
- onError callback for error handling
- Uses makeRedirectUri with scheme "littlejourney" and path "oauth"
- Fetches user info from Google's userinfo endpoint after successful OAuth
- Integrated into sign-in.tsx - replaced mock OAuth with real Google sign-in flow
- Added ActivityIndicator for loading state on Google button
- Combined loading state (anyLoading) for disabling all inputs during OAuth
- TDD approach: 12 tests for use-google-auth hook

**Files changed:**
- package.json - Added expo-auth-session, expo-crypto dependencies
- hooks/use-google-auth.ts - New: Google OAuth hook using expo-auth-session
- app/(auth)/sign-in.tsx - Integrated useGoogleAuth hook, fetch Google user info
- __tests__/hooks/use-google-auth.test.ts - New: 12 TDD tests for OAuth hook
- __tests__/app/auth/sign-in.test.tsx - Added mocks for expo-auth-session
- prd-items.json - Updated AUTH-002 to passes: true

**Verification:** tsc, lint, test (450 passed), build all pass.

**Next:** Continue remaining PRD items: AUTH-003 (Apple Sign-In), AUTH-001 (magic link - requires backend), backend integration (SHARE, VIDEO, PAY), Web Viewer (Phase 2)


## 2026-01-16: Apple Sign-In Authentication (AUTH-003)

**PRD ref:** Phase 1, Section 1 (Authentication), AUTH-003

**Task:** Implement Apple Sign-In authentication using expo-apple-authentication

**Decisions:**
- Installed expo-apple-authentication for native iOS Apple Sign-In
- Created hooks/use-apple-auth.ts following same pattern as useGoogleAuth
- Hook returns signIn function, isLoading, error, and isAvailable states
- isAvailable check runs on mount - only true on iOS 13+ with Apple Sign-In support
- Requests FULL_NAME and EMAIL scopes per Apple guidelines
- Handles user cancellation gracefully (not treated as error)
- Apple only provides email on first sign-in - uses privaterelay fallback email for Hide My Email
- Button conditionally rendered when appleAvailable is true (iOS only)
- ActivityIndicator shows loading state during sign-in flow
- TDD approach: 12 tests for use-apple-auth hook

**Files changed:**
- package.json - Added expo-apple-authentication dependency
- hooks/use-apple-auth.ts - New: Apple Sign-In hook using expo-apple-authentication
- app/(auth)/sign-in.tsx - Integrated useAppleAuth hook, conditional button render
- __tests__/hooks/use-apple-auth.test.ts - New: 12 TDD tests for Apple auth hook
- __tests__/app/auth/sign-in.test.tsx - Added expo-apple-authentication mock, updated Apple test
- prd-items.json - Updated AUTH-003 to passes: true

**Verification:** tsc, lint, test (462 passed), build all pass.

**Next:** Continue remaining PRD items: AUTH-001 (magic link - requires backend), backend integration (SHARE, VIDEO, PAY), Web Viewer (Phase 2)


## 2026-01-16: Email Magic Link Authentication (AUTH-001)

**PRD ref:** Phase 1, Section 1 (Authentication), AUTH-001

**Task:** Implement email magic link authentication with deep link handling

**Decisions:**
- Created hooks/use-magic-link-auth.ts - handles sending magic links and deep link verification
- Hook uses expo-linking to listen for littlejourney://verify?token=xxx URLs
- Integrates with authApi.requestMagicLink() and authApi.verifyMagicLink() from services/auth-api.ts
- Updated sign-in.tsx to use the new hook instead of mock implementation
- Hook provides: sendMagicLink(), isLoading, isSent, error, reset() states
- onSuccess callback for auth completion, onError for failures
- Deep link listener registered on mount, checks initial URL for cold start scenario
- TDD approach: 16 tests for useMagicLinkAuth hook

**Files changed:**
- hooks/use-magic-link-auth.ts - New: magic link auth hook with deep link handling
- app/(auth)/sign-in.tsx - Integrated useMagicLinkAuth hook, removed mock implementation
- __tests__/hooks/use-magic-link-auth.test.ts - New: 16 TDD tests for hook
- __tests__/app/auth/sign-in.test.tsx - Added expo-linking mock
- prd-items.json - Updated AUTH-001 to passes: true

**Verification:** tsc, lint, test (478 passed), build all pass.

**Next:** Continue remaining PRD items: SHARE-002-010 (family sharing), SEARCH-002 (semantic search), VIDEO-001-002 (Cloudflare Stream), PAY items, Web Viewer (Phase 2)

## 2026-01-16: Comments and Reactions Infrastructure (SHARE-006, SHARE-010)

**PRD ref:** Phase 1, Section 6 (Family Sharing), SHARE-006, SHARE-010

**Task:** Implement comments and reactions data model, API, hooks, and UI for entries

**Decisions:**
- Added Comment and Reaction types to api-client.ts
- Comment: id, entryId, text, authorId, authorName, createdAt
- Reaction: id, entryId, emoji, userId, userName, createdAt
- commentApi provides: getComments, createComment, deleteComment, getReactions, addReaction, removeReaction, getCommentCount, getReactionCount
- Duplicate reaction prevention (same user + emoji)
- Created use-comments.ts with TanStack Query hooks: useComments, useCreateComment, useDeleteComment, useReactions, useAddReaction, useRemoveReaction
- Entry detail screen shows engagement row: reaction count (‚ù§Ô∏è) + comment count (üí¨)
- Tapping engagement row opens comments modal
- Comments modal shows: reactions summary, comments list with delete buttons
- Parents can delete any comment (PRD SHARE-010)
- Delete confirmation overlay with cancel/confirm buttons
- TDD approach: 17 API tests + 8 hook tests

**Files changed:**
- services/api-client.ts - Added Comment, Reaction types, CreateCommentRequest, AddReactionRequest interfaces, commentApi with CRUD operations
- hooks/use-comments.ts - New: TanStack Query hooks for comments and reactions
- app/entry/[id].tsx - Added engagement row, comments modal, delete comment flow
- __tests__/services/comment-api.test.ts - New: 17 TDD tests for API
- __tests__/hooks/use-comments.test.tsx - New: 8 TDD tests for hooks

**Verification:** tsc, lint, test (503 passed), build all pass.

**Next:** Continue remaining PRD items: SHARE-002-007 (Web Viewer dependent), SEARCH-002 (AI semantic search), VIDEO-001-002 (Cloudflare Stream), PAY items

## 2026-01-16: Stripe Payment Integration (PAY-002)

**PRD ref:** Phase 1, Section 12 (Subscription), PAY-002 (Credit card via Stripe)

**Task:** Implement Stripe payment sheet integration for subscription purchases

**Decisions:**
- Created platform-specific files (.native.ts, .web.ts) to handle web bundling
- Stripe React Native SDK only available on native (iOS/Android)
- Web stub returns "not supported" error
- Payment flow: fetch payment intent -> init sheet -> present sheet
- Mock mode returns simulated payment intents for development
- Hook provides: processPayment(plan, cycle), isLoading, error, clearError, isAvailable
- Settings screen integrates payment flow before updating subscription
- Free plan bypasses payment (returns true immediately)
- User cancellation returns false without setting error state
- TDD approach: 17 service tests + 10 hook tests

**Files changed:**
- services/stripe.ts - Re-export from platform-specific
- services/stripe.native.ts - Native Stripe SDK implementation
- services/stripe.web.ts - Web stub (not supported)
- hooks/use-stripe-payment.ts - Re-export from platform-specific
- hooks/use-stripe-payment.native.ts - Payment hook with useStripe()
- hooks/use-stripe-payment.web.ts - Web stub (always unavailable)
- providers/stripe-provider.tsx - Re-export from platform-specific
- providers/stripe-provider.native.tsx - StripeProvider wrapper + context
- providers/stripe-provider.web.tsx - Web stub (pass-through)
- app/_layout.tsx - Added StripeProvider to provider tree
- app/(tabs)/settings.tsx - Integrated useStripePayment for subscription flow
- jest.setup.js - Added @stripe/stripe-react-native global mock
- __tests__/services/stripe.test.ts - 17 TDD tests for service
- __tests__/hooks/use-stripe-payment.test.ts - 10 TDD tests for hook
- prd-items.json - Updated PAY-002 to passes: true

**Verification:** tsc, lint, test (530 passed), build all pass.

**Next:** Continue remaining PRD items: PAY-003 (Apple Pay), PAY-004 (Google Pay), PAY-006 (receipts), PAY-008 (Cloudflare Worker)

## 2026-01-16: View-only Permission Enforcement (SHARE-005)

**PRD ref:** Phase 1, Section 6 (Family Sharing), SHARE-005

**Task:** Implement view-only permission enforcement for family members

**Decisions:**
- Created ViewerContext to track current viewer type (parent vs family) and permission level
- ViewerType: 'parent' (full access) or 'family' (permission-based access)
- PermissionLevel: 'view_only' (can only view) or 'view_interact' (can comment/react)
- Parents always have canEdit, canDelete, canComment, canReact = true
- Family view_interact: canComment/canReact = true, canEdit/canDelete = false
- Family view_only: all permissions = false (PRD SHARE-005 requirement)
- Entry detail screen conditionally renders:
  - Options button (edit/delete) only for parents
  - View-only badge for family members with view_only permission
  - Comments button disabled (with opacity) for view_only family members
- TDD approach: 23 context tests + 7 entry detail permission tests

**Files changed:**
- contexts/viewer-context.tsx - New: ViewerContext with permission tracking
- app/_layout.tsx - Added ViewerProvider to provider tree
- app/entry/[id].tsx - Added permission-based UI rendering
- __tests__/contexts/viewer-context.test.tsx - New: 23 TDD tests
- __tests__/app/entry/entry-detail.test.tsx - Added 7 SHARE-005 tests
- prd-items.json - Updated SHARE-005 to passes: true

**Verification:** tsc, lint, test (560 passed), build all pass.

**Next:** Continue remaining PRD items: SHARE-002-004 (magic link Web Viewer), SHARE-007 (family activity), SEARCH-002 (AI semantic search), VIDEO-001-002 (Cloudflare Stream), PAY items

