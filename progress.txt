# Little Journey - Development Progress

## 2026-01-14: Core Tab Navigation Setup

**PRD ref:** Phase 1 Weeks 1-2 Foundation, Section 4.1 Primary View

**Task:** Set up 4-tab navigation structure (Feed, Milestones, Search, Settings)

**Decisions:**
- Used index.tsx as Feed tab (Expo Router convention for default route)
- Removed template explore.tsx
- Icons: house.fill (Feed), star.fill (Milestones), magnifyingglass (Search), gearshape.fill (Settings)
- headerShown: true for proper screen titles

**Files changed:**
- app/(tabs)/_layout.tsx - Updated with 4 tabs
- app/(tabs)/index.tsx - Feed screen (renamed from feed.tsx)
- app/(tabs)/milestones.tsx - New placeholder
- app/(tabs)/search.tsx - New placeholder
- app/(tabs)/settings.tsx - New placeholder
- Deleted: app/(tabs)/explore.tsx

**Verification:** tsc, lint, test, build all pass

**Next:** Authentication flow or onboarding screens per PRD Phase 1 Weeks 3-4

## 2026-01-15: Auth Context and Route Protection

**PRD ref:** Phase 1 Weeks 3-4, Section 1 (Auth & Onboarding)

**Task:** Set up auth architecture - context, hooks, route protection, sign-in screen

**Decisions:**
- Created AuthProvider + useAuth hook with mock signIn/signOut (ready for backend integration)
- Used Slot-based routing with useSegments for auth gating (Expo Router pattern)
- Auth screens in (auth) route group, tabs in (tabs) group
- Sign-in screen is placeholder with demo flow - will add magic link/OAuth later
- Primary button color hardcoded (#0a7ea4) to work in light/dark mode

**Files changed:**
- contexts/auth-context.tsx - New: AuthProvider, useAuth hook, User type
- app/_layout.tsx - Wrap with AuthProvider, add RootLayoutNav for auth routing
- app/(auth)/_layout.tsx - New: Auth route group layout
- app/(auth)/sign-in.tsx - New: Sign-in placeholder screen
- __tests__/contexts/auth-context.test.tsx - New: TDD tests for auth context

**Verification:** tsc, lint, test (9 passed), build all pass. UI verified via Chrome MCP.

**Next:** Guided onboarding flow (PRD Section 1.3) or child profile creation

## 2026-01-15: Onboarding Route Group and Flow

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 (Guided Onboarding Flow)

**Task:** Set up onboarding architecture - route group, routing logic, placeholder add-child screen

**Decisions:**
- Added hasCompletedOnboarding + completeOnboarding to auth context (mock, ready for backend)
- 3-way routing in root layout: auth -> onboarding -> tabs
- Onboarding screens in (onboarding) route group with Stack navigator
- headerBackVisible: false, gestureEnabled: false to prevent back navigation during onboarding
- add-child is first onboarding step (step 2 per PRD, step 1 sign-up already done)

**Files changed:**
- contexts/auth-context.tsx - Added hasCompletedOnboarding, completeOnboarding
- app/_layout.tsx - Updated RootLayoutNav with 3-way routing logic
- app/(onboarding)/_layout.tsx - New: Onboarding route group layout
- app/(onboarding)/add-child.tsx - New: Add child placeholder screen
- app/(auth)/sign-in.tsx - Removed manual router.replace (handled by root layout)
- __tests__/contexts/auth-context.test.tsx - Added 3 tests for onboarding state

**Verification:** tsc, lint, test (12 passed), build all pass. UI verified via Chrome MCP.

**Next:** Child form fields (name, DOB, photo) or remaining onboarding steps (culture, prompt time, invite)

## 2026-01-15: Add Child Form Implementation

**PRD ref:** Phase 1 Weeks 3-4, Section 2.1 (Child Profile)

**Task:** Implement Add Child form with name, DOB, nickname fields and validation

**Decisions:**
- Created ChildContext + useChild hook for child state management (TDD approach)
- Child type: name (required), dateOfBirth (ISO string, required), nickname (optional), photoUri (optional)
- Form validation: name required, DOB required, DOB cannot be future
- Used @react-native-community/datetimepicker for native date picking
- Continue button disabled until form valid (visual feedback via gray color)
- Date displayed in Singapore locale format (en-SG)
- KeyboardAvoidingView + ScrollView for proper keyboard handling

**Files changed:**
- contexts/child-context.tsx - New: ChildProvider, useChild hook, Child type
- app/_layout.tsx - Added ChildProvider wrapper
- app/(onboarding)/add-child.tsx - Full form implementation with validation
- __tests__/contexts/child-context.test.tsx - New: 5 TDD tests for child context

**Verification:** tsc, lint, test (17 passed), build all pass. UI verified via Chrome MCP.

**Next:** Remaining onboarding steps (culture selection, prompt time, invite family) or photo picker for child

## 2026-01-15: Cultural Tradition Selection Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 3 (Select cultural tradition)

**Task:** Implement cultural tradition selection as step 3 of onboarding flow

**Decisions:**
- Added CulturalTradition type: "chinese" | "malay" | "indian" | "none"
- Added culturalTradition optional field to Child interface
- Added updateChild method to ChildContext for partial updates
- Created select-culture.tsx with radio button selection UI
- add-child now navigates to select-culture instead of completing onboarding
- select-culture completes onboarding after selection
- Culture options show milestone examples (Full Month, Aqiqah, Annaprashan, etc.)

**Files changed:**
- contexts/child-context.tsx - Added CulturalTradition type, culturalTradition field, updateChild method
- app/(onboarding)/select-culture.tsx - New: Culture selection screen with radio options
- app/(onboarding)/_layout.tsx - Added select-culture Stack.Screen
- app/(onboarding)/add-child.tsx - Navigate to select-culture instead of completeOnboarding
- __tests__/contexts/child-context.test.tsx - Added 2 tests for culturalTradition and updateChild

**Verification:** tsc, lint, test (19 passed), build all pass. UI verified via Chrome MCP.

**Next:** Daily prompt time selection (step 4) or invite family member (step 5)

## 2026-01-15: Daily Prompt Time Selection Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 4 (Set daily prompt time)

**Task:** Implement daily prompt time selection as step 4 of onboarding flow

**Decisions:**
- Created UserPreferencesContext + useUserPreferences hook for user settings (TDD approach)
- dailyPromptTime stored as 24-hour string "HH:mm" (e.g., "20:00")
- Default time: 8:00 PM SGT per PRD
- Used @react-native-community/datetimepicker with 5-minute intervals
- Platform-specific display: iOS spinner, Android default picker
- Skip option available (completes onboarding without setting time)
- Continue saves time and completes onboarding
- select-culture now navigates to set-prompt-time instead of completing onboarding

**Files changed:**
- contexts/user-preferences-context.tsx - New: UserPreferencesProvider, useUserPreferences hook
- app/_layout.tsx - Added UserPreferencesProvider wrapper
- app/(onboarding)/set-prompt-time.tsx - New: Time picker screen with skip option
- app/(onboarding)/_layout.tsx - Added set-prompt-time Stack.Screen
- app/(onboarding)/select-culture.tsx - Navigate to set-prompt-time instead of completeOnboarding
- __tests__/contexts/user-preferences-context.test.tsx - New: 5 TDD tests for user preferences

**Verification:** tsc, lint, test (24 passed), build all pass. Route protection verified via Chrome MCP.

**Next:** Invite family member (step 5) or first entry prompt (step 6)

## 2026-01-15: Invite Family Member Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 5 (Invite first family member)

**Task:** Implement invite family member as step 5 of onboarding flow

**Decisions:**
- Created FamilyContext + useFamily hook for family member management (TDD approach)
- FamilyMember type: id, email, relationship, permissionLevel, status, invitedAt
- PermissionLevel: "view_only" | "view_interact" per PRD Section 6.3
- InviteStatus: "pending" | "accepted" | "expired"
- Form validation: valid email required, relationship required
- Permission defaults to "view_interact" (most useful for grandparents)
- Skip option completes onboarding without inviting
- set-prompt-time now navigates to invite-family instead of completing onboarding

**Files changed:**
- contexts/family-context.tsx - New: FamilyProvider, useFamily hook, types
- app/_layout.tsx - Added FamilyProvider wrapper
- app/(onboarding)/invite-family.tsx - New: Invite form with email, relationship, permission
- app/(onboarding)/_layout.tsx - Added invite-family Stack.Screen
- app/(onboarding)/set-prompt-time.tsx - Navigate to invite-family instead of completeOnboarding
- __tests__/contexts/family-context.test.tsx - New: 6 TDD tests for family context

**Verification:** tsc, lint, test (30 passed), build all pass.

**Next:** First entry prompt (step 6) or core Feed features (entries, photos)

## 2026-01-15: First Entry Prompt Screen

**PRD ref:** Phase 1 Weeks 3-4, Section 1.3 Step 6 (First entry prompt)

**Task:** Implement first entry prompt as final onboarding step (step 6)

**Decisions:**
- Installed expo-image-picker for gallery/camera access
- Screen prompts "Add your first moment!" with camera emoji icon
- "Choose from Gallery" button requests media library permission then launches picker
- Skip option ("I'll do this later") completes onboarding without adding photo
- If user selects photo, completes onboarding (entry creation deferred to Feed feature)
- invite-family now navigates to first-entry instead of completing onboarding

**Files changed:**
- app/(onboarding)/first-entry.tsx - New: First entry prompt with image picker
- app/(onboarding)/_layout.tsx - Added first-entry Stack.Screen
- app/(onboarding)/invite-family.tsx - Navigate to first-entry, removed useAuth import
- __tests__/app/onboarding/first-entry.test.tsx - New: 5 TDD tests for first-entry screen
- package.json - Added expo-image-picker dependency

**Verification:** tsc, lint, test (35 passed), build all pass.

**Next:** Core Feed features (entry creation, photo upload) per PRD Phase 1 Weeks 5-7

## 2026-01-15: Entry Context and Feed UI

**PRD ref:** Phase 1 Weeks 5-7, Section 3 (Entry Creation), Section 4 (Timeline & Feed)

**Task:** Implement entry types, context, and feed UI with entry creation modal

**Decisions:**
- Created EntryContext + useEntries hook for entry state management (TDD approach)
- Entry type: id, type (photo/video/text), mediaUris (carousel), caption, date, tags, timestamps
- Entries stored reverse chronological (newest first) per PRD Section 4.1
- Feed shows FlatList with EntryCard components, EmptyState when no entries
- Floating action button (+) opens entry creation modal
- 2-step creation flow: type selection -> caption/media
- Photo/video picker reuses expo-image-picker from onboarding
- Multiple photo selection supported for carousel entries
- Entry card shows image, video placeholder, caption, date, carousel indicator

**Files changed:**
- contexts/entry-context.tsx - New: EntryProvider, useEntries hook, Entry/EntryType types
- app/_layout.tsx - Added EntryProvider wrapper
- app/(tabs)/index.tsx - Full feed UI with entry cards, FAB, creation modal
- __tests__/contexts/entry-context.test.tsx - New: 8 TDD tests for entry context

**Verification:** tsc, lint, test (43 passed), build all pass.

**Next:** Pull-to-refresh, entry detail view, or photo carousel swipe per PRD Section 4

## 2026-01-15: Pull-to-Refresh for Feed

**PRD ref:** Phase 1 Weeks 5-7, Section 4.1 (Primary View: Feed - Pull-to-refresh)

**Task:** Add pull-to-refresh to Feed FlatList

**Decisions:**
- Used RefreshControl component with FlatList's refreshControl prop
- Added refreshing state + onRefresh callback with useCallback
- Simulated 1s refresh delay (placeholder for TanStack Query invalidation)
- tintColor/colors set to PRIMARY_COLOR for consistent branding

**Files changed:**
- app/(tabs)/index.tsx - Added RefreshControl, refreshing state, onRefresh handler

**Verification:** tsc, lint, test (43 passed), build all pass.

**Next:** Entry detail view, photo carousel swipe, or edit/delete entries per PRD Section 4

## 2026-01-15: Photo Carousel Component

**PRD ref:** Phase 1 Weeks 5-7, Section 4.3 (Photo Carousel)

**Task:** Implement swipeable photo carousel for multi-photo entries with dot indicators

**Decisions:**
- Created PhotoCarousel component with horizontal ScrollView + pagingEnabled
- Dot indicators shown only when images.length > 1
- Active dot opacity 1, inactive 0.4 for visual feedback
- onImagePress callback for future full-screen view integration
- Configurable aspectRatio prop (default 1:1 square)
- Used onScroll with scrollEventThrottle to track active index
- Removed old carouselIndicator text ("1/N") in favor of dots

**Files changed:**
- components/photo-carousel.tsx - New: PhotoCarousel with swipe + dots
- __tests__/components/photo-carousel.test.tsx - New: 5 TDD tests
- app/(tabs)/index.tsx - Integrated PhotoCarousel, removed cardImage/carouselIndicator styles

**Verification:** tsc, lint, test (48 passed), build all pass.

**Next:** Entry detail view (full-screen on tap) or edit/delete entries per PRD Section 3.6

## 2026-01-15: Entry Detail Screen (Full-Screen View)

**PRD ref:** Phase 1 Weeks 5-7, Section 4.3 (Photo Carousel - Full-screen view on tap)

**Task:** Implement full-screen entry detail view when tapping an entry in Feed

**Decisions:**
- Created dynamic route app/entry/[id].tsx for entry detail
- Full-screen black background with photo carousel for multi-photo entries
- Header overlay with back button (‚Üê) and image counter (1/N)
- Caption + date shown in semi-transparent overlay at bottom
- Used router.push for navigation, router.back for returning
- EntryCard now accepts onPress prop and is wrapped in Pressable
- PhotoCarousel onImagePress also triggers navigation to detail view

**Files changed:**
- app/entry/[id].tsx - New: Full-screen entry detail with image carousel
- app/(tabs)/index.tsx - Added router import, onPress to EntryCard
- __tests__/app/entry/entry-detail.test.tsx - New: 5 TDD tests for detail screen

**Verification:** tsc, lint, test (53 passed), build all pass.

**Next:** Edit/delete entries (PRD Section 3.6) or video playback (PRD Section 9.3)

## 2026-01-15: Entry Edit/Delete UI

**PRD ref:** Phase 1 Weeks 5-7, Section 3.6 (Entry Ownership & Editing)

**Task:** Add edit/delete actions to entry detail screen

**Decisions:**
- EntryContext already had updateEntry/deleteEntry methods (implemented earlier)
- Added options button (‚ãÆ) to entry detail header next to back button
- Used Modal with two states: "options" menu and "confirmDelete" confirmation
- iOS-style dark menu with Edit and Delete options
- Delete shows confirmation dialog with red "Delete Entry" button
- On delete: calls deleteEntry(id) then router.back()
- Edit is placeholder (TODO: implement edit modal/screen)

**Files changed:**
- app/entry/[id].tsx - Added options button, modal with edit/delete, delete confirmation
- __tests__/app/entry/entry-detail.test.tsx - Added 4 tests for options menu and delete flow

**Verification:** tsc, lint, test (57 passed), build all pass.

**Next:** Entry edit modal/screen or video playback (PRD Section 9.3)

## 2026-01-15: Entry Edit Modal

**PRD ref:** Phase 1 Weeks 5-7, Section 3.6 (Entry Ownership & Editing)

**Task:** Implement edit modal for editing entry caption

**Decisions:**
- Added "edit" state to MenuState type (was: closed/options/confirmDelete)
- Edit modal slides up from bottom (iOS sheet pattern)
- Pre-fills caption from current entry on open
- Save button calls updateEntry(id, { caption }) and closes modal
- Cancel button closes modal without saving
- KeyboardAvoidingView handles keyboard on iOS/Android
- Multiline TextInput with 500 char limit for caption

**Files changed:**
- app/entry/[id].tsx - Added edit modal UI, editCaption state, save/cancel handlers
- __tests__/app/entry/entry-detail.test.tsx - Added 4 tests for edit modal flow

**Verification:** tsc, lint, test (61 passed), build all pass.

**Next:** Video playback (PRD Section 9.3) or search/milestones features

## 2026-01-15: Milestones Feature - Context and Tab UI

**PRD ref:** Phase 1 Weeks 8-9, Section 5 (Milestones)

**Task:** Implement MilestoneContext and Milestones tab with templates and UI

**Decisions:**
- Created MilestoneContext + useMilestones hook for milestone state management (TDD approach)
- Milestone type: id, templateId, childId, milestoneDate, celebrationDate, customTitle/Description, isCompleted
- MILESTONE_TEMPLATES constant with PRD Section 5.1 cultural milestones:
  - Chinese: Full Month (Êª°Êúà), 100 Days (ÁôæÊó•), Zhua Zhou (ÊäìÂë®), First Lunar New Year
  - Malay: Aqiqah, Cukur Jambul, First Hari Raya
  - Indian: Naming Ceremony, Annaprashan, First Deepavali
  - Universal: First smile/laugh/steps/words/tooth/haircut/school
- Templates filtered by child's cultural tradition + universal
- daysFromBirth auto-calculates milestone date from child DOB
- Milestones tab: empty state, upcoming/completed sections, FAB
- Two modals: template selection (bottom sheet), custom milestone (full screen)
- Custom milestone form: title, description, date picker

**Files changed:**
- contexts/milestone-context.tsx - New: MilestoneProvider, useMilestones, types, MILESTONE_TEMPLATES
- app/_layout.tsx - Added MilestoneProvider wrapper
- app/(tabs)/milestones.tsx - Full milestone UI with sections, modals, template list
- __tests__/contexts/milestone-context.test.tsx - New: 7 TDD tests for milestone context

**Verification:** tsc, lint, test (68 passed), build all pass.

**Next:** Milestone completion flow, milestone detail view, or PRD Section 8 (Search)

## 2026-01-15: Milestone Completion Flow

**PRD ref:** Phase 1 Weeks 8-9, Section 5.2 (Dual Date System), Section 5.3 (Milestone UI)

**Task:** Implement milestone completion modal - mark milestones as completed with celebration date and notes

**Decisions:**
- Added "complete" to ModalState type for completion modal
- Milestone cards now tappable (wrapped in Pressable) to open completion modal
- Completion modal shows: milestone title, celebration date picker, notes input
- completeMilestone and deleteMilestone from context now used in UI
- Delete option available in completion modal (red outline button)
- Celebration date defaults to today (can be changed)
- Notes are optional

**Files changed:**
- app/(tabs)/milestones.tsx - Added completion modal, tappable cards, completion/delete handlers, new styles
- __tests__/app/tabs/milestones.test.tsx - New: 5 TDD tests for milestone screen + completion flow

**Verification:** tsc, lint, test (73 passed), build all pass.

**Next:** Search feature (PRD Section 8) or video playback (PRD Section 9.3)

## 2026-01-15: Search Feature - UI and Local Filtering

**PRD ref:** Phase 1 Weeks 8-9, Section 8 (Search & Discovery)

**Task:** Implement Search tab UI with text search and type filtering

**Decisions:**
- Search filters entries by caption text and tags (local filtering, AI/Vectorize deferred)
- Filter chips: All, Photos, Videos, Text (type-based filtering)
- Empty state with search icon when no query entered
- "No Results" state when search has no matches
- SearchResultCard shows thumbnail, caption, date, tags (max 3)
- Tapping result navigates to entry detail view (/entry/[id])
- useMemo for filtered entries to optimize re-renders

**Files changed:**
- app/(tabs)/search.tsx - Full search UI with input, filter chips, results list
- __tests__/app/tabs/search.test.tsx - New: 6 TDD tests for search functionality

**Verification:** tsc, lint, test (79 passed), build all pass.

**Next:** Video playback (PRD Section 9.3) or push notifications (PRD Section 7)

## 2026-01-15: Video Playback with expo-av

**PRD ref:** Phase 1 Weeks 5-7, Section 9.3 (Video Playback)

**Task:** Implement video playback for video entries using expo-av

**Decisions:**
- Installed expo-av for Video component (note: deprecated in SDK 54, will migrate to expo-video later)
- Created VideoPlayer component with play/pause overlay controls
- VideoPlayer replaces placeholder üé¨ emoji in Feed EntryCard
- Entry Detail shows full-screen video player for video entries
- Auto-loops videos, tap to toggle play/pause
- ResizeMode.CONTAIN for proper aspect ratio
- TDD approach: wrote tests first with expo-av mocks

**Files changed:**
- components/video-player.tsx - New: VideoPlayer with expo-av Video, play/pause controls
- app/(tabs)/index.tsx - Integrated VideoPlayer in EntryCard, removed videoPlaceholder styles
- app/entry/[id].tsx - Added VideoPlayer for video entries, conditional rendering photo vs video
- __tests__/components/video-player.test.tsx - New: 5 TDD tests for VideoPlayer
- __tests__/app/entry/entry-detail.test.tsx - Added expo-av mock
- package.json - Added expo-av dependency

**Verification:** tsc, lint, test (84 passed), build all pass.

**Next:** Push notifications (PRD Section 7) or Settings screen UI

## 2026-01-15: Push Notifications Context

**PRD ref:** Phase 1 Weeks 10-11, Section 7 (Notifications)

**Task:** Implement NotificationContext for push notification settings and scheduling

**Decisions:**
- Created NotificationContext + useNotifications hook (TDD approach)
- NotificationSettings type with 5 toggles per PRD Section 7.1: dailyPrompt, memories, milestoneReminder, familyActivity, storageWarning
- All default to true (on) per PRD
- Permission status: granted/denied/undetermined
- requestPermissions() gets expo push token and sets up Android channel
- scheduleDailyPrompt(time) cancels existing then schedules daily notification at specified time
- cancelDailyPrompt() cancels all scheduled notifications
- Uses Notifications.SchedulableTriggerInputTypes.DAILY for repeating daily trigger
- Listeners set up for notification received and response handling

**Files changed:**
- contexts/notification-context.tsx - New: NotificationProvider, useNotifications, NotificationSettings type
- app/_layout.tsx - Added NotificationProvider wrapper
- __tests__/contexts/notification-context.test.tsx - New: 7 TDD tests for notification context
- package.json - Added expo-notifications, expo-device dependencies

**Verification:** tsc, lint, test (91 passed), build all pass.

**Next:** Settings screen UI with notification toggles or family invitation flow

## 2026-01-15: Settings Screen UI

**PRD ref:** Phase 1 Weeks 10-11, Section 7.4 (Notification Settings), Section 6.1 (Invitation Flow)

**Task:** Implement Settings screen with notification toggles, family member management, sign-out

**Decisions:**
- 3 sections: Notifications, Family, Account (iOS Settings app pattern)
- Notification toggles: Daily Prompts, On This Day Memories, Milestone Reminders, Family Activity
- Permission banner shown when notifications not granted (tappable to request)
- Invite Family modal: email, relationship, permission level (view_interact/view_only)
- Family members displayed in list with Remove option
- Sign Out with Alert confirmation (destructive style)
- ScrollView for content, KeyboardAvoidingView in modal

**Files changed:**
- app/(tabs)/settings.tsx - Full settings UI with toggles, family list, invite modal, sign out
- __tests__/app/tabs/settings.test.tsx - New: 5 TDD tests for settings screen

**Verification:** tsc, lint, test (96 passed), build all pass.

**Next:** Remaining Phase 1 Week 12-13 items (Stripe payments, storage limits, polish) or Week 10-11 daily prompt scheduling integration

## 2026-01-15: Daily Prompt Notification Integration

**PRD ref:** Phase 1 Weeks 10-11, Section 7.2 (Implementation), Section 7.3 (Smart Frequency)

**Task:** Integrate daily prompt scheduling with user preferences and notification toggle

**Decisions:**
- Settings screen now shows "Reminder Time" row with current time or "Not set"
- Time picker modal for changing prompt time (reuses DateTimePicker from onboarding)
- When dailyPrompt toggle changes: schedules notification if ON + time set, cancels if OFF
- Onboarding set-prompt-time now requests permissions and schedules notification on Continue
- formatDisplayTime, timeStringToDate, dateToTimeString helpers for time conversion
- Schedule only when permissions granted (handles denied gracefully)

**Files changed:**
- app/(tabs)/settings.tsx - Added time picker modal, Reminder Time row, toggle schedules/cancels
- app/(onboarding)/set-prompt-time.tsx - Integrated requestPermissions + scheduleDailyPrompt
- __tests__/app/tabs/settings.test.tsx - Added 2 TDD tests for Reminder Time display

**Verification:** tsc, lint, test (98 passed), build all pass.

**Next:** Remaining Phase 1 Week 12-13 items (Stripe payments, storage limits, polish) or Photo for child profile

## 2026-01-15: Storage Context and Tier Limits

**PRD ref:** Phase 1 Weeks 12-13, Section 9.1 (Video Tier Limits), Section 12.1 (Tier Structure)

**Task:** Implement StorageContext for tracking storage usage and enforcing tier limits

**Decisions:**
- Created StorageContext + useStorage hook for storage management (TDD approach)
- SubscriptionTier type: "free" | "standard" | "premium"
- TIER_LIMITS constant: free=500MB, standard=10GB, premium=50GB per PRD
- VIDEO_DURATION_LIMITS: free=0, standard=2min, premium=10min per PRD Section 9.1
- usagePercent calculated as Math.round((usedBytes/limitBytes)*100)
- canUpload(bytes) checks if addition would exceed limit
- canUploadVideo(seconds) checks tier video permissions
- addUsage/removeUsage for tracking media uploads/deletes

**Files changed:**
- contexts/storage-context.tsx - New: StorageProvider, useStorage, TIER_LIMITS, VIDEO_DURATION_LIMITS
- app/_layout.tsx - Added StorageProvider wrapper
- __tests__/contexts/storage-context.test.tsx - New: 7 TDD tests for storage context

**Verification:** tsc, lint, test (105 passed), build all pass.

**Next:** Integrate storage tracking with entry creation or Settings screen storage display

## 2026-01-15: Storage Integration with Entry Creation + Settings Display

**PRD ref:** Phase 1 Weeks 12-13, Section 9.1 (Video Tier Limits), Section 12.1 (Tier Structure)

**Task:** Integrate storage limits with entry creation flow and display storage in Settings

**Decisions:**
- Feed screen now checks storage limits before allowing photo/video uploads
- Video button shows "Video Not Available" alert on free tier (no video allowed)
- Video uploads check duration limit: standard=2min, premium=10min
- Photo/video uploads check total file size against storage limit
- File sizes tracked from ImagePicker assets and added to storage usage on submit
- Settings screen shows new Storage section with:
  - Plan name (Free/Standard/Premium)
  - Usage bar with color: green (<80%), yellow (80-90%), red (>90%)
  - Usage text: "X B of Y MB" and "N% used"
  - Upgrade prompt on free tier

**Files changed:**
- app/(tabs)/index.tsx - Added useStorage hook, storage/video checks in handleTypeSelect, track usage in handleSubmit
- app/(tabs)/settings.tsx - Added Storage section with progress bar, tier display, upgrade prompt
- __tests__/app/tabs/feed.test.tsx - New: 6 TDD tests for storage validation
- __tests__/app/tabs/settings.test.tsx - Added StorageProvider, 2 tests for storage section

**Verification:** tsc, lint, test (113 passed), build all pass.

**Next:** Stripe payments integration (PRD Section 12.2) or UI polish

## 2026-01-15: Data Export Feature

**PRD ref:** Phase 1 Weeks 12-13, Section 11.1 (Data Export)

**Task:** Implement data export functionality - "Download all memories" per PRD

**Decisions:**
- Created ExportContext + useExport hook for export functionality (TDD approach)
- ExportData type contains: exportDate, version, child, entries, milestones
- Uses expo-file-system new File API (Paths.document, File.write)
- Uses expo-sharing for native share sheet integration
- Export generates JSON file named little-journey-export-{date}.json
- Added "Data & Privacy" section to Settings per PRD Section 11
- Button shows "Exporting..." with disabled state during export
- lastExportDate displayed after successful export

**Files changed:**
- contexts/export-context.tsx - New: ExportProvider, useExport, ExportData type
- app/_layout.tsx - Added ExportProvider wrapper
- app/(tabs)/settings.tsx - Added Data & Privacy section with export button
- __tests__/contexts/export-context.test.tsx - New: 6 TDD tests for export context
- __tests__/app/tabs/settings.test.tsx - Added ExportProvider, 2 tests for export UI
- package.json - Added expo-file-system, expo-sharing dependencies

**Verification:** tsc, lint, test (121 passed), build all pass.

**Next:** Account deletion (PRD Section 11.2) or Stripe payments (PRD Section 12.2)

## 2026-01-15: Account Deletion Feature

**PRD ref:** Phase 1 Weeks 12-13, Section 11.2 (Account Deletion)

**Task:** Implement account deletion with 30-day grace period per PRD

**Decisions:**
- Added deletionScheduledAt, requestAccountDeletion, cancelAccountDeletion to AuthContext
- requestAccountDeletion sets deletion date 30 days in future (grace period per PRD)
- cancelAccountDeletion clears scheduled deletion
- signOut clears deletion state
- Settings shows "Delete Account" button opening modal with confirmation
- User must type "DELETE" to confirm (PRD requirement)
- Modal shows warning list of data to be deleted and 30-day grace period info
- When deletion scheduled: shows yellow banner with date and "Cancel Deletion" button
- Delete button hidden when deletion already scheduled (replaced by cancel banner)

**Files changed:**
- contexts/auth-context.tsx - Added deletionScheduledAt state, requestAccountDeletion/cancelAccountDeletion methods
- app/(tabs)/settings.tsx - Added delete account modal, confirmation flow, scheduled deletion UI
- __tests__/contexts/auth-context.test.tsx - Added 4 TDD tests for deletion state
- __tests__/app/tabs/settings.test.tsx - Added 2 tests for delete account UI

**Verification:** tsc, lint, test (127 passed), build all pass.

**Next:** Stripe payments integration (PRD Section 12.2) or UI polish

## 2026-01-15: Subscription Context and Upgrade Flow

**PRD ref:** Phase 1 Weeks 12-13, Section 12 (Monetization)

**Task:** Implement subscription/payment infrastructure and upgrade UI per PRD 12.1-12.3

**Decisions:**
- Created SubscriptionContext + useSubscription hook for subscription state management (TDD approach)
- PLAN_DETAILS constant with PRD prices: Standard $4.99/mo ($39.99/yr), Premium $9.99/mo ($79.99/yr)
- BillingCycle type: "monthly" | "yearly"
- subscribe() method handles plan subscription (mock, ready for Stripe integration)
- cancelSubscription() marks subscription for cancellation (access until period ends per PRD 12.3)
- restoreSubscription() unmarks cancelled subscription
- Added Subscription section to Settings with plan display, cancel/restore buttons
- Subscription modal: billing cycle toggle, plan cards with features, subscribe button
- Storage context setTier synced with subscription changes
- Upgrade prompt in Storage section now opens subscription modal

**Files changed:**
- contexts/subscription-context.tsx - New: SubscriptionProvider, useSubscription, PLAN_DETAILS, types
- app/_layout.tsx - Added SubscriptionProvider wrapper
- app/(tabs)/settings.tsx - Added subscription section, upgrade modal, cancel/restore flow
- __tests__/contexts/subscription-context.test.tsx - New: 10 TDD tests for subscription context
- __tests__/app/tabs/settings.test.tsx - Added SubscriptionProvider, updated tests

**Verification:** tsc, lint, test (136 passed), build all pass.

**Next:** UI polish or integrate with actual Stripe SDK

## 2026-01-15: "On This Day" Memories Feature

**PRD ref:** Phase 1 Weeks 10-11, Section 4.5 ("On This Day" Memories)

**Task:** Implement "On This Day" memory card in Feed showing entries from same day in previous years

**Decisions:**
- Added getOnThisDayEntries() to EntryContext - filters entries by same month/day in previous years
- OnThisDayCard component shows golden-bordered card with sparkle icon
- Displays up to 3 memory thumbnails horizontally
- Each thumbnail shows "X years ago" label
- Tapping memory navigates to entry detail view
- Card only renders when memories exist (returns null otherwise)
- FlatList uses ListHeaderComponent for card (shows above Feed entries)
- Empty state logic updated: shows empty state only when no entries AND no memories

**Files changed:**
- contexts/entry-context.tsx - Added getOnThisDayEntries() method to context
- app/(tabs)/index.tsx - Added OnThisDayCard component, integrated in Feed, added styles
- __tests__/app/tabs/feed.test.tsx - Added 4 TDD tests for "On This Day" logic

**Verification:** tsc, lint, test (140 passed), build all pass.

**Next:** Photo book export (PRD Section 10) or UI polish

## 2026-01-15: Child Profile Photo Picker

**PRD ref:** Phase 1 Weeks 3-4, Section 2.1 (Child Profile - Photo optional field)

**Task:** Add photo picker to add-child onboarding screen for child profile photo

**Decisions:**
- Reused expo-image-picker pattern from first-entry.tsx
- Circular photo button (100x100) with dashed border, centered above form fields
- allowsEditing: true with 1:1 aspect ratio for profile-appropriate cropping
- Placeholder shows camera emoji + "Add Photo" text
- photoUri stored in child context and passed to setChild on Continue
- TDD approach: wrote 5 tests before implementation

**Files changed:**
- app/(onboarding)/add-child.tsx - Added photo picker UI, handlePickPhoto, photoUri state
- __tests__/app/onboarding/add-child.test.tsx - New: 5 TDD tests for photo picker

**Verification:** tsc, lint, test (145 passed), build all pass.

**Next:** Photo book export (PRD Section 10) or Settings child profile edit

## 2026-01-15: Child Profile Edit in Settings

**PRD ref:** Phase 1 Weeks 12-13 (Polish), Section 2.1 (Child Profile)

**Task:** Add child profile display and edit capability to Settings screen

**Decisions:**
- Added Child Profile section between Notifications and Family sections
- Profile shows: photo (or placeholder), name, nickname, DOB, cultural tradition
- Edit button opens modal with full profile editing (reuses onboarding patterns)
- Edit modal includes: photo picker, name, nickname, DOB picker, cultural tradition selector
- Used updateChild from ChildContext for partial updates
- Empty state shows "No child profile added" when no child exists
- TDD approach: 5 new tests added to existing settings.test.tsx

**Files changed:**
- app/(tabs)/settings.tsx - Added child profile section, edit modal, handlers, styles
- __tests__/app/tabs/settings.test.tsx - Added 5 TDD tests for child profile, plus test helpers

**Verification:** tsc, lint, test (150 passed), build all pass.

**Next:** Photo book export (PRD Section 10) or UI polish
